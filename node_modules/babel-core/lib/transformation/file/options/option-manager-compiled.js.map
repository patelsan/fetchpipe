{"version":3,"sources":["option-manager.js"],"names":[],"mappings":"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","file":"option-manager-compiled.js","sourcesContent":["\"use strict\";\n\nexports.__esModule = true;\n// istanbul ignore next\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { \"default\": obj }; }\n\n// istanbul ignore next\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar _index = require(\"./index\");\n\nvar _json5 = require(\"json5\");\n\nvar _json52 = _interopRequireDefault(_json5);\n\nvar _pathIsAbsolute = require(\"path-is-absolute\");\n\nvar _pathIsAbsolute2 = _interopRequireDefault(_pathIsAbsolute);\n\nvar _pathExists = require(\"path-exists\");\n\nvar _pathExists2 = _interopRequireDefault(_pathExists);\n\nvar _lodashLangClone = require(\"lodash/lang/clone\");\n\nvar _lodashLangClone2 = _interopRequireDefault(_lodashLangClone);\n\nvar _helpersMerge = require(\"../../../helpers/merge\");\n\nvar _helpersMerge2 = _interopRequireDefault(_helpersMerge);\n\nvar _config = require(\"./config\");\n\nvar _config2 = _interopRequireDefault(_config);\n\nvar _path = require(\"path\");\n\nvar _path2 = _interopRequireDefault(_path);\n\nvar _fs = require(\"fs\");\n\nvar _fs2 = _interopRequireDefault(_fs);\n\nvar existsCache = {};\nvar jsonCache = {};\n\nvar BABELIGNORE_FILENAME = \".babelignore\";\nvar BABELRC_FILENAME = \".babelrc\";\nvar PACKAGE_FILENAME = \"package.json\";\n\nfunction exists(filename) {\n  var cached = existsCache[filename];\n  if (cached != null) {\n    return cached;\n  } else {\n    return existsCache[filename] = _pathExists2[\"default\"].sync(filename);\n  }\n}\n\nvar OptionManager = (function () {\n  function OptionManager(log, pipeline) {\n    _classCallCheck(this, OptionManager);\n\n    this.resolvedConfigs = [];\n    this.options = OptionManager.createBareOptions();\n    this.pipeline = pipeline;\n    this.log = log;\n  }\n\n  /**\n   * [Please add a description.]\n   */\n\n  OptionManager.createBareOptions = function createBareOptions() {\n    var opts = {};\n\n    for (var key in _config2[\"default\"]) {\n      var opt = _config2[\"default\"][key];\n      opts[key] = _lodashLangClone2[\"default\"](opt[\"default\"]);\n    }\n\n    return opts;\n  };\n\n  /**\n   * [Please add a description.]\n   */\n\n  OptionManager.prototype.addConfig = function addConfig(loc, key) {\n    var json = arguments.length <= 2 || arguments[2] === undefined ? _json52[\"default\"] : arguments[2];\n\n    if (this.resolvedConfigs.indexOf(loc) >= 0) return;\n\n    var content = _fs2[\"default\"].readFileSync(loc, \"utf8\");\n    var opts;\n\n    try {\n      opts = jsonCache[content] = jsonCache[content] || json.parse(content);\n      if (key) opts = opts[key];\n    } catch (err) {\n      err.message = loc + \": Error while parsing JSON - \" + err.message;\n      throw err;\n    }\n\n    this.mergeOptions(opts, loc);\n    this.resolvedConfigs.push(loc);\n  };\n\n  /**\n   * [Please add a description.]\n   */\n\n  OptionManager.prototype.mergeOptions = function mergeOptions(opts) {\n    var alias = arguments.length <= 1 || arguments[1] === undefined ? \"foreign\" : arguments[1];\n\n    if (!opts) return;\n\n    for (var key in opts) {\n      if (key[0] === \"_\") continue;\n\n      var option = _config2[\"default\"][key];\n\n      // check for an unknown option\n      if (!option) this.log.error(\"Unknown option: \" + alias + \".\" + key, ReferenceError);\n    }\n\n    // normalise options\n    _index.normaliseOptions(opts);\n\n    // merge them into this current files options\n    _helpersMerge2[\"default\"](this.options, opts);\n  };\n\n  /**\n   * [Please add a description.]\n   */\n\n  OptionManager.prototype.addIgnoreConfig = function addIgnoreConfig(loc) {\n    var file = _fs2[\"default\"].readFileSync(loc, \"utf8\");\n    var lines = file.split(\"\\n\");\n\n    lines = lines.map(function (line) {\n      return line.replace(/#(.*?)$/, \"\").trim();\n    }).filter(function (line) {\n      return !!line;\n    });\n\n    this.mergeOptions({ ignore: lines }, loc);\n  };\n\n  /**\n   * Description\n   */\n\n  OptionManager.prototype.findConfigs = function findConfigs(loc) {\n    if (!loc) return;\n\n    if (!_pathIsAbsolute2[\"default\"](loc)) {\n      loc = _path2[\"default\"].join(process.cwd(), loc);\n    }\n\n    while (loc !== (loc = _path2[\"default\"].dirname(loc))) {\n      if (this.options.breakConfig) return;\n\n      var configLoc = _path2[\"default\"].join(loc, BABELRC_FILENAME);\n      if (exists(configLoc)) this.addConfig(configLoc);\n\n      var pkgLoc = _path2[\"default\"].join(loc, PACKAGE_FILENAME);\n      if (exists(pkgLoc)) this.addConfig(pkgLoc, \"babel\", JSON);\n\n      var ignoreLoc = _path2[\"default\"].join(loc, BABELIGNORE_FILENAME);\n      if (exists(ignoreLoc)) this.addIgnoreConfig(ignoreLoc);\n    }\n  };\n\n  /**\n   * [Please add a description.]\n   */\n\n  OptionManager.prototype.normaliseOptions = function normaliseOptions() {\n    var opts = this.options;\n\n    for (var key in _config2[\"default\"]) {\n      var option = _config2[\"default\"][key];\n      var val = opts[key];\n\n      // optional\n      if (!val && option.optional) continue;\n\n      // deprecated\n      if (this.log && val && option.deprecated) {\n        this.log.deprecate(\"Deprecated option \" + key + \": \" + option.deprecated);\n      }\n\n      // validate\n      if (this.pipeline && val) {\n        val = _index.validateOption(key, val, this.pipeline);\n      }\n\n      // aaliases\n      if (option.alias) {\n        opts[option.alias] = opts[option.alias] || val;\n      } else {\n        opts[key] = val;\n      }\n    }\n  };\n\n  /**\n   * [Please add a description.]\n   */\n\n  OptionManager.prototype.init = function init(opts) {\n    this.mergeOptions(opts, \"direct\");\n\n    // babelrc option\n    if (opts.babelrc) {\n      var _arr = opts.babelrc;\n\n      for (var _i = 0; _i < _arr.length; _i++) {\n        var loc = _arr[_i];this.addConfig(loc);\n      }\n    }\n\n    // resolve all .babelrc files\n    if (opts.babelrc !== false) {\n      this.findConfigs(opts.filename);\n    }\n\n    // merge in env\n    var envKey = process.env.BABEL_ENV || process.env.NODE_ENV || \"development\";\n    if (this.options.env) {\n      this.mergeOptions(this.options.env[envKey], \"direct.env.\" + envKey);\n    }\n\n    // normalise\n    this.normaliseOptions(opts);\n\n    return this.options;\n  };\n\n  return OptionManager;\n})();\n\nexports[\"default\"] = OptionManager;\nmodule.exports = exports[\"default\"];"]}