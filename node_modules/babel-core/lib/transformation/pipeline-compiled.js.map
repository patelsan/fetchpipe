{"version":3,"sources":["pipeline.js"],"names":[],"mappings":"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","file":"pipeline-compiled.js","sourcesContent":["\"use strict\";\n\nexports.__esModule = true;\n// istanbul ignore next\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { \"default\": obj }; }\n\n// istanbul ignore next\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar _filePluginManager = require(\"./file/plugin-manager\");\n\nvar _filePluginManager2 = _interopRequireDefault(_filePluginManager);\n\nvar _helpersNormalizeAst = require(\"../helpers/normalize-ast\");\n\nvar _helpersNormalizeAst2 = _interopRequireDefault(_helpersNormalizeAst);\n\nvar _plugin = require(\"./plugin\");\n\nvar _plugin2 = _interopRequireDefault(_plugin);\n\nvar _lodashObjectAssign = require(\"lodash/object/assign\");\n\nvar _lodashObjectAssign2 = _interopRequireDefault(_lodashObjectAssign);\n\nvar _helpersObject = require(\"../helpers/object\");\n\nvar _helpersObject2 = _interopRequireDefault(_helpersObject);\n\nvar _file = require(\"./file\");\n\nvar _file2 = _interopRequireDefault(_file);\n\n/**\n * [Please add a description.]\n */\n\nvar Pipeline = (function () {\n  function Pipeline() {\n    _classCallCheck(this, Pipeline);\n\n    this.transformers = _helpersObject2[\"default\"]();\n    this.namespaces = _helpersObject2[\"default\"]();\n    this.deprecated = _helpersObject2[\"default\"]();\n    this.aliases = _helpersObject2[\"default\"]();\n    this.filters = [];\n  }\n\n  /**\n   * [Please add a description.]\n   */\n\n  Pipeline.prototype.addTransformers = function addTransformers(transformers) {\n    for (var key in transformers) {\n      this.addTransformer(key, transformers[key]);\n    }\n    return this;\n  };\n\n  /**\n   * [Please add a description.]\n   */\n\n  Pipeline.prototype.addTransformer = function addTransformer(key, plugin) {\n    if (this.transformers[key]) throw new Error(); // todo: error\n\n    var namespace = key.split(\".\")[0];\n    this.namespaces[namespace] = this.namespaces[namespace] || [];\n    this.namespaces[namespace].push(key);\n    this.namespaces[key] = namespace;\n\n    if (typeof plugin === \"function\") {\n      plugin = _filePluginManager2[\"default\"].memoisePluginContainer(plugin);\n      plugin.key = key;\n      plugin.metadata.optional = true;\n\n      if (key === \"react.displayName\") {\n        plugin.metadata.optional = false;\n      }\n    } else {\n      plugin = new _plugin2[\"default\"](key, plugin);\n    }\n\n    this.transformers[key] = plugin;\n  };\n\n  /**\n   * [Please add a description.]\n   */\n\n  Pipeline.prototype.addAliases = function addAliases(names) {\n    _lodashObjectAssign2[\"default\"](this.aliases, names);\n    return this;\n  };\n\n  /**\n   * [Please add a description.]\n   */\n\n  Pipeline.prototype.addDeprecated = function addDeprecated(names) {\n    _lodashObjectAssign2[\"default\"](this.deprecated, names);\n    return this;\n  };\n\n  /**\n   * [Please add a description.]\n   */\n\n  Pipeline.prototype.addFilter = function addFilter(filter) {\n    this.filters.push(filter);\n    return this;\n  };\n\n  /**\n   * [Please add a description.]\n   */\n\n  Pipeline.prototype.canTransform = function canTransform(plugin, fileOpts) {\n    if (plugin.metadata.plugin) {\n      return true;\n    }\n\n    var _arr = this.filters;\n    for (var _i = 0; _i < _arr.length; _i++) {\n      var filter = _arr[_i];\n      var result = filter(plugin, fileOpts);\n      if (result != null) return result;\n    }\n\n    return true;\n  };\n\n  /**\n   * [Please add a description.]\n   */\n\n  Pipeline.prototype.analyze = function analyze(code) {\n    var opts = arguments.length <= 1 || arguments[1] === undefined ? {} : arguments[1];\n\n    opts.code = false;\n    return this.transform(code, opts);\n  };\n\n  /**\n   * Build dependency graph by recursing `metadata.modules`. WIP.\n   */\n\n  Pipeline.prototype.pretransform = function pretransform(code, opts) {\n    var file = new _file2[\"default\"](opts, this);\n    return file.wrap(code, function () {\n      file.addCode(code);\n      file.parseCode(code);\n      return file;\n    });\n  };\n\n  /**\n   * [Please add a description.]\n   */\n\n  Pipeline.prototype.transform = function transform(code, opts) {\n    var file = new _file2[\"default\"](opts, this);\n    return file.wrap(code, function () {\n      file.addCode(code);\n      file.parseCode(code);\n      return file.transform();\n    });\n  };\n\n  /**\n   * [Please add a description.]\n   */\n\n  Pipeline.prototype.transformFromAst = function transformFromAst(ast, code, opts) {\n    ast = _helpersNormalizeAst2[\"default\"](ast);\n\n    var file = new _file2[\"default\"](opts, this);\n    return file.wrap(code, function () {\n      file.addCode(code);\n      file.addAst(ast);\n      return file.transform();\n    });\n  };\n\n  /**\n   * [Please add a description.]\n   */\n\n  Pipeline.prototype._ensureTransformerNames = function _ensureTransformerNames(type, rawKeys) {\n    var keys = [];\n\n    for (var i = 0; i < rawKeys.length; i++) {\n      var key = rawKeys[i];\n      var deprecatedKey = this.deprecated[key];\n      var aliasKey = this.aliases[key];\n      if (aliasKey) {\n        keys.push(aliasKey);\n      } else if (deprecatedKey) {\n        // deprecated key, remap it to the new one\n        console.error(\"[BABEL] The transformer \" + key + \" has been renamed to \" + deprecatedKey);\n        rawKeys.push(deprecatedKey);\n      } else if (this.transformers[key]) {\n        // valid key\n        keys.push(key);\n      } else if (this.namespaces[key]) {\n        // namespace, append all transformers within this namespace\n        keys = keys.concat(this.namespaces[key]);\n      } else {\n        // invalid key\n        throw new ReferenceError(\"Unknown transformer \" + key + \" specified in \" + type);\n      }\n    }\n\n    return keys;\n  };\n\n  return Pipeline;\n})();\n\nexports[\"default\"] = Pipeline;\nmodule.exports = exports[\"default\"];"]}