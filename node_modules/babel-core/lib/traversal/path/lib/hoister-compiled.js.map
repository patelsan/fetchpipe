{"version":3,"sources":["hoister.js"],"names":[],"mappings":"AAAA,YAAY,CAAC;;AAEb,OAAO,CAAC,UAAU,GAAG,IAAI,CAAC;;;AAG1B,SAAS,uBAAuB,CAAC,GAAG,EAAE;AAAE,MAAI,GAAG,IAAI,GAAG,CAAC,UAAU,EAAE;AAAE,WAAO,GAAG,CAAC;GAAE,MAAM;AAAE,QAAI,MAAM,GAAG,EAAE,CAAC,AAAC,IAAI,GAAG,IAAI,IAAI,EAAE;AAAE,WAAK,IAAI,GAAG,IAAI,GAAG,EAAE;AAAE,YAAI,MAAM,CAAC,SAAS,CAAC,cAAc,CAAC,IAAI,CAAC,GAAG,EAAE,GAAG,CAAC,EAAE,MAAM,CAAC,GAAG,CAAC,GAAG,GAAG,CAAC,GAAG,CAAC,CAAC;OAAE;KAAE,AAAC,MAAM,CAAC,SAAS,CAAC,GAAG,GAAG,CAAC,AAAC,OAAO,MAAM,CAAC;GAAE;CAAE;;;;AAIhR,SAAS,eAAe,CAAC,QAAQ,EAAE,WAAW,EAAE;AAAE,MAAI,EAAE,QAAQ,YAAY,WAAW,CAAA,AAAC,EAAE;AAAE,UAAM,IAAI,SAAS,CAAC,mCAAmC,CAAC,CAAC;GAAE;CAAE;;AAEzJ,IAAI,2BAA2B,GAAG,OAAO,CAAC,uCAAuC,CAAC,CAAC;;AAEnF,IAAI,KAAK,GAAG,uBAAuB,CAAC,2BAA2B,CAAC,CAAC;;AAEjE,IAAI,MAAM,GAAG,OAAO,CAAC,gBAAgB,CAAC,CAAC;;AAEvC,IAAI,CAAC,GAAG,uBAAuB,CAAC,MAAM,CAAC,CAAC;;;;;;AAMxC,IAAI,gBAAgB,GAAG;;;;;;AAMrB,sBAAoB,EAAE,SAAS,oBAAoB,CAAC,IAAI,EAAE,MAAM,EAAE,KAAK,EAAE,KAAK,EAAE;AAC9E,QAAI,IAAI,CAAC,eAAe,EAAE,IAAI,KAAK,CAAC,WAAW,CAAC,IAAI,CAAC,IAAI,CAAC,EAAE;AAC1D,aAAO;KACR;;;AAGD,QAAI,OAAO,GAAG,KAAK,CAAC,UAAU,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;AAC1C,QAAI,CAAC,OAAO,EAAE,OAAO;;;;AAIrB,QAAI,OAAO,KAAK,KAAK,CAAC,KAAK,CAAC,UAAU,CAAC,IAAI,CAAC,IAAI,CAAC,EAAE,OAAO;;AAE1D,QAAI,OAAO,CAAC,QAAQ,EAAE;AACpB,WAAK,CAAC,QAAQ,CAAC,IAAI,CAAC,IAAI,CAAC,GAAG,OAAO,CAAC;KACrC,MAAM;AACL,UAAI,IAAI,GAAG,OAAO,CAAC,kBAAkB,CAAC;;AAEtC,WAAK,IAAI,EAAE,GAAG,CAAC,EAAE,EAAE,GAAG,IAAI,CAAC,MAAM,EAAE,EAAE,EAAE,EAAE;AACvC,YAAI,aAAa,GAAG,IAAI,CAAC,EAAE,CAAC,CAAC;AAC7B,aAAK,CAAC,iBAAiB,GAAG,KAAK,CAAC,iBAAiB,CAAC,MAAM,CAAC,aAAa,CAAC,WAAW,EAAE,CAAC,CAAC;OACvF;KACF;GACF;CACF,CAAC;;;;;;AAMF,IAAI,WAAW,GAAG,CAAC,YAAY;AAC7B,WAAS,WAAW,CAAC,IAAI,EAAE,KAAK,EAAE;AAChC,mBAAe,CAAC,IAAI,EAAE,WAAW,CAAC,CAAC;;AAEnC,QAAI,CAAC,iBAAiB,GAAG,EAAE,CAAC;AAC5B,QAAI,CAAC,QAAQ,GAAG,EAAE,CAAC;AACnB,QAAI,CAAC,MAAM,GAAG,EAAE,CAAC;AACjB,QAAI,CAAC,KAAK,GAAG,KAAK,CAAC;AACnB,QAAI,CAAC,IAAI,GAAG,IAAI,CAAC;GAClB;;;;;;AAMD,aAAW,CAAC,SAAS,CAAC,iBAAiB,GAAG,SAAS,iBAAiB,CAAC,KAAK,EAAE;AAC1E,SAAK,IAAI,GAAG,IAAI,IAAI,CAAC,QAAQ,EAAE;AAC7B,UAAI,OAAO,GAAG,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,CAAC;AACjC,UAAI,CAAC,KAAK,CAAC,uBAAuB,CAAC,GAAG,EAAE,OAAO,CAAC,UAAU,CAAC,EAAE;AAC3D,eAAO,KAAK,CAAC;OACd;KACF;;AAED,WAAO,IAAI,CAAC;GACb,CAAC;;;;;;AAMF,aAAW,CAAC,SAAS,CAAC,mBAAmB,GAAG,SAAS,mBAAmB,GAAG;AACzE,QAAI,KAAK,GAAG,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC;AAC5B,OAAG;AACD,UAAI,IAAI,CAAC,iBAAiB,CAAC,KAAK,CAAC,EAAE;AACjC,YAAI,CAAC,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;OACzB,MAAM;AACL,cAAM;OACP;;AAED,UAAI,IAAI,CAAC,iBAAiB,CAAC,OAAO,CAAC,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,EAAE;AACnD,cAAM;OACP;KACF,QAAQ,KAAK,GAAG,KAAK,CAAC,MAAM,EAAE;GAChC,CAAC;;;;;;AAMF,aAAW,CAAC,SAAS,CAAC,iBAAiB,GAAG,SAAS,iBAAiB,GAAG;AACrE,QAAI,MAAM,GAAG,IAAI,CAAC,MAAM,CAAC;;AAEzB,QAAI,KAAK,GAAG,MAAM,CAAC,GAAG,EAAE,CAAC;AACzB,QAAI,CAAC,KAAK,EAAE,OAAO;;AAEnB,QAAI,KAAK,CAAC,IAAI,CAAC,UAAU,EAAE,EAAE;AAC3B,UAAI,IAAI,CAAC,mBAAmB,CAAC,KAAK,CAAC,EAAE;;AAEnC,YAAI,IAAI,CAAC,KAAK,KAAK,KAAK,EAAE,OAAO;;;AAGjC,eAAO,KAAK,CAAC,IAAI,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC;OAC9C,MAAM;;AAEL,eAAO,IAAI,CAAC,2BAA2B,EAAE,CAAC;OAC3C;KACF,MAAM,IAAI,KAAK,CAAC,IAAI,CAAC,SAAS,EAAE,EAAE;AACjC,aAAO,IAAI,CAAC,2BAA2B,EAAE,CAAC;KAC3C;GACF,CAAC;;;;;;AAMF,aAAW,CAAC,SAAS,CAAC,2BAA2B,GAAG,SAAS,2BAA2B,GAAG;AACzF,QAAI,KAAK,GAAG,IAAI,CAAC,MAAM,CAAC,GAAG,EAAE,CAAC;AAC9B,QAAI,KAAK,EAAE,OAAO,KAAK,CAAC,IAAI,CAAC,kBAAkB,EAAE,CAAC;GACnD,CAAC;;;;;;AAMF,aAAW,CAAC,SAAS,CAAC,mBAAmB,GAAG,SAAS,mBAAmB,CAAC,KAAK,EAAE;AAC9E,SAAK,IAAI,IAAI,IAAI,IAAI,CAAC,QAAQ,EAAE;AAC9B,UAAI,CAAC,KAAK,CAAC,aAAa,CAAC,IAAI,CAAC,EAAE,SAAS;;AAEzC,UAAI,OAAO,GAAG,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC;AAClC,UAAI,OAAO,CAAC,IAAI,KAAK,OAAO,EAAE,OAAO,IAAI,CAAC;KAC3C;AACD,WAAO,KAAK,CAAC;GACd,CAAC;;;;;;AAMF,aAAW,CAAC,SAAS,CAAC,GAAG,GAAG,SAAS,GAAG,GAAG;AACzC,QAAI,IAAI,GAAG,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC;AAC1B,QAAI,IAAI,CAAC,QAAQ,EAAE,OAAO;AAC1B,QAAI,CAAC,QAAQ,GAAG,IAAI,CAAC;;AAErB,QAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,gBAAgB,EAAE,IAAI,CAAC,CAAC;;AAE3C,QAAI,CAAC,mBAAmB,EAAE,CAAC;;AAE3B,QAAI,QAAQ,GAAG,IAAI,CAAC,iBAAiB,EAAE,CAAC;AACxC,QAAI,CAAC,QAAQ,EAAE,OAAO;;;AAGtB,QAAI,QAAQ,CAAC,iBAAiB,EAAE,KAAK,IAAI,CAAC,IAAI,CAAC,iBAAiB,EAAE,EAAE,OAAO;;AAE3E,QAAI,GAAG,GAAG,QAAQ,CAAC,KAAK,CAAC,qBAAqB,CAAC,KAAK,CAAC,CAAC;;AAEtD,YAAQ,CAAC,YAAY,CAAC,CAAC,CAAC,CAAC,mBAAmB,CAAC,KAAK,EAAE,CAAC,CAAC,CAAC,kBAAkB,CAAC,GAAG,EAAE,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;;AAEnG,QAAI,MAAM,GAAG,IAAI,CAAC,IAAI,CAAC,UAAU,CAAC;;AAElC,QAAI,MAAM,CAAC,YAAY,EAAE,IAAI,IAAI,CAAC,IAAI,CAAC,SAAS,KAAK,MAAM,CAAC,IAAI,CAAC,QAAQ,EAAE;;;AAGzE,SAAG,GAAG,CAAC,CAAC,sBAAsB,CAAC,GAAG,CAAC,CAAC;KACrC;;AAED,QAAI,CAAC,IAAI,CAAC,WAAW,CAAC,GAAG,CAAC,CAAC;GAC5B,CAAC;;AAEF,SAAO,WAAW,CAAC;CACpB,CAAA,EAAG,CAAC;;AAEL,OAAO,CAAC,SAAS,CAAC,GAAG,WAAW,CAAC;AACjC,MAAM,CAAC,OAAO,GAAG,OAAO,CAAC,SAAS,CAAC,CAAC","file":"hoister-compiled.js","sourcesContent":["\"use strict\";\n\nexports.__esModule = true;\n// istanbul ignore next\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj[\"default\"] = obj; return newObj; } }\n\n// istanbul ignore next\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar _transformationHelpersReact = require(\"../../../transformation/helpers/react\");\n\nvar react = _interopRequireWildcard(_transformationHelpersReact);\n\nvar _types = require(\"../../../types\");\n\nvar t = _interopRequireWildcard(_types);\n\n/**\n * [Please add a description.]\n */\n\nvar referenceVisitor = {\n\n  /**\n   * [Please add a description.]\n   */\n\n  ReferencedIdentifier: function ReferencedIdentifier(node, parent, scope, state) {\n    if (this.isJSXIdentifier() && react.isCompatTag(node.name)) {\n      return;\n    }\n\n    // direct references that we need to track to hoist this to the highest scope we can\n    var binding = scope.getBinding(node.name);\n    if (!binding) return;\n\n    // this binding isn't accessible from the parent scope so we can safely ignore it\n    // eg. it's in a closure etc\n    if (binding !== state.scope.getBinding(node.name)) return;\n\n    if (binding.constant) {\n      state.bindings[node.name] = binding;\n    } else {\n      var _arr = binding.constantViolations;\n\n      for (var _i = 0; _i < _arr.length; _i++) {\n        var violationPath = _arr[_i];\n        state.breakOnScopePaths = state.breakOnScopePaths.concat(violationPath.getAncestry());\n      }\n    }\n  }\n};\n\n/**\n * [Please add a description.]\n */\n\nvar PathHoister = (function () {\n  function PathHoister(path, scope) {\n    _classCallCheck(this, PathHoister);\n\n    this.breakOnScopePaths = [];\n    this.bindings = {};\n    this.scopes = [];\n    this.scope = scope;\n    this.path = path;\n  }\n\n  /**\n   * [Please add a description.]\n   */\n\n  PathHoister.prototype.isCompatibleScope = function isCompatibleScope(scope) {\n    for (var key in this.bindings) {\n      var binding = this.bindings[key];\n      if (!scope.bindingIdentifierEquals(key, binding.identifier)) {\n        return false;\n      }\n    }\n\n    return true;\n  };\n\n  /**\n   * [Please add a description.]\n   */\n\n  PathHoister.prototype.getCompatibleScopes = function getCompatibleScopes() {\n    var scope = this.path.scope;\n    do {\n      if (this.isCompatibleScope(scope)) {\n        this.scopes.push(scope);\n      } else {\n        break;\n      }\n\n      if (this.breakOnScopePaths.indexOf(scope.path) >= 0) {\n        break;\n      }\n    } while (scope = scope.parent);\n  };\n\n  /**\n   * [Please add a description.]\n   */\n\n  PathHoister.prototype.getAttachmentPath = function getAttachmentPath() {\n    var scopes = this.scopes;\n\n    var scope = scopes.pop();\n    if (!scope) return;\n\n    if (scope.path.isFunction()) {\n      if (this.hasOwnParamBindings(scope)) {\n        // should ignore this scope since it's ourselves\n        if (this.scope === scope) return;\n\n        // needs to be attached to the body\n        return scope.path.get(\"body\").get(\"body\")[0];\n      } else {\n        // doesn't need to be be attached to this scope\n        return this.getNextScopeStatementParent();\n      }\n    } else if (scope.path.isProgram()) {\n      return this.getNextScopeStatementParent();\n    }\n  };\n\n  /**\n   * [Please add a description.]\n   */\n\n  PathHoister.prototype.getNextScopeStatementParent = function getNextScopeStatementParent() {\n    var scope = this.scopes.pop();\n    if (scope) return scope.path.getStatementParent();\n  };\n\n  /**\n   * [Please add a description.]\n   */\n\n  PathHoister.prototype.hasOwnParamBindings = function hasOwnParamBindings(scope) {\n    for (var name in this.bindings) {\n      if (!scope.hasOwnBinding(name)) continue;\n\n      var binding = this.bindings[name];\n      if (binding.kind === \"param\") return true;\n    }\n    return false;\n  };\n\n  /**\n   * [Please add a description.]\n   */\n\n  PathHoister.prototype.run = function run() {\n    var node = this.path.node;\n    if (node._hoisted) return;\n    node._hoisted = true;\n\n    this.path.traverse(referenceVisitor, this);\n\n    this.getCompatibleScopes();\n\n    var attachTo = this.getAttachmentPath();\n    if (!attachTo) return;\n\n    // don't bother hoisting to the same function as this will cause multiple branches to be evaluated more than once leading to a bad optimisation\n    if (attachTo.getFunctionParent() === this.path.getFunctionParent()) return;\n\n    var uid = attachTo.scope.generateUidIdentifier(\"ref\");\n\n    attachTo.insertBefore([t.variableDeclaration(\"var\", [t.variableDeclarator(uid, this.path.node)])]);\n\n    var parent = this.path.parentPath;\n\n    if (parent.isJSXElement() && this.path.container === parent.node.children) {\n      // turning the `span` in `<div><span /></div>` to an expression so we need to wrap it with\n      // an expression container\n      uid = t.JSXExpressionContainer(uid);\n    }\n\n    this.path.replaceWith(uid);\n  };\n\n  return PathHoister;\n})();\n\nexports[\"default\"] = PathHoister;\nmodule.exports = exports[\"default\"];"]}