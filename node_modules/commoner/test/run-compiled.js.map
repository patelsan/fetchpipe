{"version":3,"sources":["run.js"],"names":[],"mappings":"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","file":"run-compiled.js","sourcesContent":["var assert = require(\"assert\");\nvar Watcher = require(\"../lib/watcher\").Watcher;\nvar BuildContext = require(\"../lib/context\").BuildContext;\nvar ModuleReader = require(\"../lib/reader\").ModuleReader;\nvar ReadFileCache = require(\"../lib/cache\").ReadFileCache;\nvar grepP = require(\"../lib/grep\");\nvar util = require(\"../lib/util\");\nvar fs = require(\"fs\");\nvar Q = require(\"q\");\n\nvar path = require(\"path\");\nvar sourceDir = path.resolve(__dirname, \"source\");\nvar outputDir = path.resolve(__dirname, \"output\");\n\ntry {\n    fs.mkdirSync(outputDir);\n} catch (exists) {\n    // pass\n}\n\nvar watcher = new Watcher(new ReadFileCache(sourceDir), false);\n\n// Get a new context. Defaults to setRelativize(true) and setUseProvidesModule(true)\nfunction getNewContext(options) {\n    var context = new BuildContext({\n        config: { debug: options.debug },\n        sourceDir: sourceDir\n    }, new ReadFileCache(sourceDir));\n    context.setCacheDirectory(path.join(outputDir, options.cacheDirectory));\n    context.setRelativize(options.relative === undefined || options.relative);\n    context.setUseProvidesModule(options.useProvidesModule === undefined || options.useProvidesModule );\n    return context;\n}\n\nfunction getNewDebugContext(options) {\n    options = options || {};\n    options.debug = true;\n    options.cacheDirectory = \".debug-module-cache\";\n    return getNewContext(options);\n}\n\nfunction getNewReleaseContext(options) {\n    options = options || {};\n    options.debug = false;\n    options.cacheDirectory = \".release-module-cache\";\n    return getNewContext(options);\n}\n\nvar debugContext = getNewDebugContext();\n\nvar releaseContext = getNewReleaseContext();\n\nfunction getProvidedP(id) {\n    var context = this;\n    return context.getProvidedP().then(function(idToPath) {\n        if (idToPath.hasOwnProperty(id))\n            return context.readFileP(idToPath[id]);\n    });\n}\n\nfunction getSourceP(id) {\n    return this.readModuleP(id);\n}\n\nfunction waitForHelpers(done, helperP, contextOptions) {\n    Q.all([\n        helperP(getNewDebugContext(contextOptions)),\n        helperP(getNewReleaseContext(contextOptions))\n    ]).done(function() {\n        done();\n    });\n}\n\nfunction checkHome(assert, home) {\n    return Q(home).then(function(home) {\n        assert.strictEqual(home.id, \"home\");\n        assert.strictEqual(typeof home.source, \"string\");\n        assert.notEqual(home.source.indexOf(\"exports\"), -1);\n        assert.strictEqual(home.source.indexOf('require(\"./assert\");'), 0);\n        return home;\n    }).invoke(\"getRequiredP\").then(function(reqs) {\n        assert.strictEqual(reqs.length, 1);\n        assert.strictEqual(reqs[0].id, \"assert\");\n    });\n}\n\ndescribe(\"ModuleReader\", function() {\n    it('should read \"home\" module correctly', function(done) {\n        var reader = new ModuleReader(debugContext, [getSourceP], []);\n        var homeP = reader.readModuleP(\"home\");\n        checkHome(assert, homeP).done(done);\n    });\n\n    it(\"should generate stubs for missing modules\", function(done) {\n        function helperP(context) {\n            var reader = new ModuleReader(context, [getSourceP], []);\n            var id = \"this/module/should/not/exist\";\n            return reader.readModuleP(id).then(function(module) {\n                assert.strictEqual(module.id, id);\n                assert.notEqual(module.source.indexOf(\"throw new Error\"), -1);\n            });\n        }\n\n        waitForHelpers(done, helperP);\n    });\n\n    it(\"should skip failing resolvers\", function(done) {\n        var reader = new ModuleReader(debugContext, [function(id) {\n            return this.makePromise(function(callback) {\n                process.nextTick(function() {\n                    callback(new Error(\"bad thing happen\"));\n                });\n            });\n        }, function(id) {\n            throw new Error(\"superbad situation\");\n        }, getSourceP], []);\n\n        var homeP = reader.readModuleP(\"home\");\n        checkHome(assert, homeP).done(done);\n    });\n\n    it(\"should cache previously-read modules\", function(done) {\n        var reader = new ModuleReader(debugContext, [getSourceP], []);\n\n        var homes = [\n            reader.readModuleP(\"home\"),\n            reader.readModuleP(\"home\"),\n            reader.readModuleP.originalFn.call(reader, \"home\")\n        ];\n\n        assert.strictEqual(homes[0], homes[1]);\n        assert.notStrictEqual(homes[0], homes[2]);\n        assert.notStrictEqual(homes[1], homes[2]);\n\n        Q.spread(homes, function(h0, h1, h2) {\n            assert.strictEqual(h0, h1);\n            assert.strictEqual(h0, h2);\n            assert.strictEqual(h1, h2);\n\n            assert.strictEqual(h0.hash, h1.hash);\n            assert.strictEqual(h1.hash, h2.hash);\n        }).done(done);\n    });\n\n    it(\"should allow multiple file output\", function(done) {\n        var mfSource = [\n            \"function multiFile(foo) {\",\n            \"  console.log(foo);\",\n            \"}\"\n        ].join(\"\\n\");\n\n        var pkg = require(\"../package.json\");\n\n        function getSourceP(id) {\n            assert.strictEqual(id, \"multi-file\");\n            return Q(mfSource);\n        }\n\n        function processP1(id, source) {\n            assert.strictEqual(source, mfSource);\n            return {\n                \".js\": source,\n                \".json\": util.readJsonFileP(\n                    path.join(__dirname, \"..\", \"package.json\")\n                )\n            };\n        }\n\n        function processP2(id, input) {\n            assert.strictEqual(input[\".js\"], mfSource);\n\n            var json = input[\".json\"];\n            assert.deepEqual(json, pkg);\n\n            input[\".json\"] = util.makePromise(function(callback) {\n                process.nextTick(function() {\n                    callback(null, JSON.stringify(json));\n                });\n            });\n\n            return input;\n        }\n\n        function processP3(id, input) {\n            assert.strictEqual(input[\".js\"], mfSource);\n            assert.strictEqual(typeof input[\".json\"], \"string\");\n            assert.deepEqual(JSON.parse(input[\".json\"]), pkg);\n\n            return input;\n        }\n\n        var reader = new ModuleReader(\n            debugContext,\n            [getSourceP],\n            [processP1, processP2, processP3]\n        );\n\n        reader.readModuleP(\"multi-file\").then(function(mf) {\n            assert.strictEqual(mf.id, \"multi-file\");\n            assert.strictEqual(mf.source, mfSource);\n            assert.deepEqual(JSON.parse(mf.output[\".json\"]), pkg);\n        }).done(done);\n    });\n});\n\ndescribe(\"grepP\", function() {\n    it(\"should find @providesModule identifiers\", function(done) {\n        Q.spread([\n            grepP(\"@providesModule\\\\s+\\\\S+\", sourceDir),\n            debugContext.getProvidedP()\n        ], function(pathToMatch, valueToPath) {\n            assert.deepEqual(pathToMatch, {\n                \"widget/share.js\": \"@providesModule WidgetShare\",\n                \"widget/.bogus.js\": \"@providesModule WidgetShare\",\n                \"widget/bogus.js~\": \"@providesModule WidgetShare\"\n            });\n            assert.deepEqual(valueToPath, {\n                \"WidgetShare\": \"widget/share.js\"\n            });\n        }).done(done);\n    });\n});\n\ndescribe(\"@providesModule\", function() {\n    it(\"should parse docblocks correctly\", function(done) {\n        var code = arguments.callee.toString();\n\n        /**\n         * Look, Ma! A test function that uses itself as input!\n         * @providesModule\n         * @providesModule foo/bar\n         */\n\n        assert.strictEqual(\n            code.split(\"@provides\" + \"Module\").length,\n            4);\n\n        assert.strictEqual(\n            debugContext.getProvidedId(code),\n            \"foo/bar\");\n\n        assert.strictEqual(\n            debugContext.getProvidedId(\n                \"no at-providesModule, here\"),\n            null);\n\n        /**\n         * Just to make sure we only pay attention to the first one.\n         * @providesModule ignored\n         */\n\n        function helper(context) {\n            var reader = new ModuleReader(context, [\n                getProvidedP,\n                getSourceP\n            ], []);\n\n            return Q.all([\n                Q.spread([\n                    reader.readModuleP(\"widget/share\"),\n                    reader.readModuleP(\"WidgetShare\")\n                ], function(ws1, ws2) {\n                    assert.strictEqual(ws1.id, ws2.id);\n                    assert.strictEqual(ws1.id, \"WidgetShare\");\n                    assert.strictEqual(ws1, ws2);\n                }),\n\n                reader.readMultiP([\n                    \"widget/share\",\n                    \"WidgetShare\"\n                ]).then(function(modules) {\n                    assert.strictEqual(modules.length, 1);\n                    assert.strictEqual(modules[0].id, \"WidgetShare\");\n                }),\n\n                reader.readModuleP(\n                    \"widget/gallery\"\n                ).then(function(gallery) {\n                    return gallery.getRequiredP();\n                }).then(function(deps) {\n                    assert.strictEqual(deps.length, 1);\n                    assert.strictEqual(deps[0].id, \"WidgetShare\");\n                }),\n\n                Q.spread([\n                    reader.getSourceP(\"widget/share\"),\n                    reader.getSourceP(\"WidgetShare\")\n                ], function(source1, source2) {\n                    assert.strictEqual(source1, source2);\n                })\n            ]);\n        }\n\n        waitForHelpers(done, helper);\n    });\n});\n\ndescribe(\"context.makePromise\", function() {\n    it(\"should make goodly promises\", function(done) {\n        var error = new Error(\"test\");\n\n        function helperP(context) {\n            return context.makePromise(function(callback) {\n                process.nextTick(function() {\n                    callback(error, \"asdf\");\n                });\n            }).then(function() {\n                assert.ok(false, \"should have thrown an error\");\n            }, function(err) {\n                assert.strictEqual(err, error);\n\n                return context.makePromise(function(callback) {\n                    process.nextTick(function() {\n                        callback(null, \"success\");\n                    });\n                }).then(function(result) {\n                    assert.strictEqual(result, \"success\");\n                });\n            })\n        }\n\n        waitForHelpers(done, helperP);\n    });\n});\n\ndescribe(\"util.relativize\", function() {\n    it(\"should resolve correct relative module identifiers\", function(done) {\n        var moduleId = \"some/deeply/nested/module\";\n        var processor = require(\"../lib/relative\").getProcessor(null);\n\n        function makeSource(id) {\n            var str = JSON.stringify(id);\n            return \"require(\" + str + \");\\n\" +\n                \"require(function(){require(\" + str + \")}())\";\n        }\n\n        function helperP(requiredId, expected) {\n            assert.strictEqual(\n                util.relativize(moduleId, requiredId),\n                expected);\n\n            return processor(\n                moduleId,\n                makeSource(requiredId)\n            ).then(function(output) {\n                assert.deepEqual(output, {\n                    \".js\": makeSource(expected)\n                });\n            });\n        }\n\n        Q.all([\n            helperP(\"another/nested/module\",\n                    \"../../../another/nested/module\"),\n            helperP(\"../../buried/module/./file\",\n                    \"../../buried/module/file\"),\n            helperP(\"../../buried/module/../file\",\n                    \"../../buried/file\"),\n            helperP(\"./same/level\",\n                    \"./same/level\"),\n            helperP(\"./same/./level\",\n                    \"./same/level\"),\n            helperP(\"./same/../level\",\n                    \"./level\"),\n            helperP(\"some/deeply/buried/treasure\",\n                    \"../buried/treasure\"),\n            helperP(\"./file\", \"./file\"),\n            helperP(\"./file/../../../module\",\n                    \"../../module\"),\n            helperP(\"./file/../../module\",\n                    \"../module\")\n        ]).done(function() {\n            done();\n        });\n    });\n});\n\ndescribe(\"canonical module identifiers\", function() {\n    it(\"should be returned by reader.getCanonicalIdP\", function(done) {\n        function helperP(context) {\n            var reader = new ModuleReader(context, [\n                getProvidedP,\n                getSourceP\n            ], []);\n\n            return Q.spread([\n                reader.getCanonicalIdP(\"widget/share\"),\n                reader.getCanonicalIdP(\"WidgetShare\"),\n                reader.readModuleP(\"widget/share\").get(\"id\"),\n                reader.readModuleP(\"WidgetShare\").get(\"id\")\n            ], function(ws1, ws2, ws3, ws4) {\n                assert.strictEqual(ws1, \"WidgetShare\");\n                assert.strictEqual(ws2, \"WidgetShare\");\n                assert.strictEqual(ws3, \"WidgetShare\");\n                assert.strictEqual(ws4, \"WidgetShare\");\n            });\n        }\n\n        waitForHelpers(done, helperP);\n    });\n\n    it(\"should replace non-canonical required identifiers\", function(done) {\n        function helperP(context) {\n            assert.strictEqual(context.ignoreDependencies, false);\n\n            var reader = new ModuleReader(context, [\n                getProvidedP,\n                getSourceP\n            ], []);\n\n            return reader.readModuleP(\"widget/follow\").then(function(follow) {\n                assert.strictEqual(follow.source.indexOf(\"widget/share\"), -1);\n\n                assert.strictEqual(strCount(\n                    'require(\"../WidgetShare\")',\n                    follow.source\n                ), 4);\n\n                assert.strictEqual(strCount(\n                    'require(\"./gallery\")',\n                    follow.source\n                ), 2);\n\n                assert.strictEqual(strCount(\n                    'require(\"../assert\")',\n                    follow.source\n                ), 2);\n            });\n        }\n\n        waitForHelpers(done, helperP);\n    });\n\n    function strCount(substring, string) {\n        return string.split(substring).length - 1;\n    }\n});\n\ndescribe(\"canonical module identifiers without --use-provides-module\", function() {\n    it(\"should not be returned by reader.getCanonicalIdP nor reader.readModuleP\", function(done) {\n        function helperP(context) {\n            console.log(context.useProvidesModule);\n            var reader = new ModuleReader(context, [\n                getProvidedP,\n                getSourceP\n            ], []);\n\n            return Q.spread([\n                reader.getCanonicalIdP(\"widget/share\"),\n                reader.getCanonicalIdP(\"WidgetShare\"),\n                reader.readModuleP(\"widget/share\").get(\"id\"),\n                reader.readModuleP(\"WidgetShare\").get(\"id\")\n            ], function(ws1, ws2, ws3, ws4) {\n                assert.strictEqual(ws1, \"widget/share\");\n                assert.strictEqual(ws2, \"WidgetShare\");\n                assert.strictEqual(ws3, \"widget/share\");\n                assert.strictEqual(ws4, \"WidgetShare\");\n            });\n        }\n\n        waitForHelpers(done, helperP, {useProvidesModule: false});\n    });\n})\n\ndescribe(\"util.flatten\", function() {\n    it(\"should flatten deeply nested arrays\", function() {\n        function check(input, expected) {\n            var flat = util.flatten(input);\n            assert.deepEqual(flat, expected);\n        }\n\n        check(1, 1);\n        check([[],,[],1, 2], [1, 2]);\n        check([[[[[[]]]]]], []);\n        check([[1,[[[[2]]],3]]], [1, 2, 3]);\n        check([[1],[[2]],[[[3]]]], [1, 2, 3]);\n        check([,,,], []);\n    });\n});\n\ndescribe(\"util.testWriteFd\", function() {\n    it(\"should write non-ASCII file data\", function(done) {\n        var file = path.join(outputDir, \"writeFdP.test.txt\");\n\n        function check(content) {\n            function afterUnlink(err) {\n                return util.openExclusiveP(file).then(function(fd) {\n                    return util.writeFdP(fd, content).then(function(written) {\n                        assert.strictEqual(content, written);\n                    });\n                });\n            }\n\n            return function() {\n                return util.unlinkP(file).then(afterUnlink, afterUnlink);\n            };\n        }\n\n        Q(\"ignored\")\n            .then(check(\"x\"))\n            .then(check(\"x\\ny\"))\n            .then(check(\"x\\r\\ny\"))\n            .then(check(\"\\t\\nx\\t\"))\n            .then(check(\"\\ufeff\")) // zero-width non-breaking space\n            .then(check(\"\\u2603\")) // snowman\n            .then(check(\"\\ud83d\\udc19\")) // octopus\n            .finally(function() {\n                return util.unlinkP(file);\n            }).done(done);\n    });\n});\n\ndescribe(\"Watcher\", function() {\n    it(\"should basically work\", function(done) {\n        var watcher = new Watcher(new ReadFileCache(sourceDir), false);\n        var dummy = \"dummy.js\";\n        var dummyFile = path.join(sourceDir, dummy);\n\n        function waitForChangeP() {\n            return util.makePromise(function(callback) {\n                watcher.on(\"changed\", function(path) {\n                    callback(null, path);\n                });\n            });\n        }\n\n        util.unlinkP(dummyFile).then(function() {\n            return util.openExclusiveP(dummyFile).then(function(fd) {\n                return util.writeFdP(fd, \"dummy\");\n            });\n        }).then(function() {\n            return Q.all([\n                watcher.readFileP(\"home.js\"),\n                watcher.readFileP(dummy)\n            ]);\n        }).then(function() {\n            return Q.all([\n                util.unlinkP(dummyFile),\n                waitForChangeP()\n            ]);\n        }).done(function() {\n            watcher.close();\n            done();\n        });\n    });\n\n    it(\"should be able to watch directories\", function(done) {\n        var watcher = new Watcher(new ReadFileCache(sourceDir), false);\n        var watchMe = \"watchMe.js\";\n        var fullPath = path.join(sourceDir, watchMe);\n\n        function waitForChangeP() {\n            return util.makePromise(function(callback) {\n                watcher.once(\"changed\", function(path) {\n                    callback(null, path);\n                });\n            });\n        }\n\n        function write(content) {\n            return util.openFileP(fullPath).then(function(fd) {\n                var promise = waitForChangeP();\n                util.writeFdP(fd, content);\n                return promise;\n            });\n        }\n\n        util.unlinkP(fullPath).then(function() {\n            return watcher.readFileP(watchMe).then(function(source) {\n                assert.ok(false, \"readFileP should have failed\");\n            }, function(err) {\n                assert.strictEqual(err.code, \"ENOENT\");\n            });\n        }).then(function() {\n            return write(\"first\");\n        }).then(function() {\n            return write(\"second\");\n        }).then(function() {\n            var promise = waitForChangeP();\n            util.unlinkP(fullPath);\n            return promise;\n        }).then(function() {\n            return write(\"third\");\n        }).finally(function() {\n            return util.unlinkP(fullPath);\n        }).done(function() {\n            watcher.close();\n            done();\n        });\n    });\n});\n"]}