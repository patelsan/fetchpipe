{"version":3,"sources":["es6.promise.js"],"names":[],"mappings":"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","file":"es6.promise-compiled.js","sourcesContent":["'use strict';\nvar $          = require('./$')\n  , LIBRARY    = require('./$.library')\n  , global     = require('./$.global')\n  , ctx        = require('./$.ctx')\n  , classof    = require('./$.classof')\n  , $def       = require('./$.def')\n  , isObject   = require('./$.is-object')\n  , anObject   = require('./$.an-object')\n  , aFunction  = require('./$.a-function')\n  , strictNew  = require('./$.strict-new')\n  , forOf      = require('./$.for-of')\n  , setProto   = require('./$.set-proto').set\n  , same       = require('./$.same')\n  , species    = require('./$.species')\n  , SPECIES    = require('./$.wks')('species')\n  , RECORD     = require('./$.uid')('record')\n  , asap       = require('./$.microtask')\n  , PROMISE    = 'Promise'\n  , process    = global.process\n  , isNode     = classof(process) == 'process'\n  , P          = global[PROMISE]\n  , Wrapper;\n\nvar testResolve = function(sub){\n  var test = new P(function(){});\n  if(sub)test.constructor = Object;\n  return P.resolve(test) === test;\n};\n\nvar useNative = function(){\n  var works = false;\n  function P2(x){\n    var self = new P(x);\n    setProto(self, P2.prototype);\n    return self;\n  }\n  try {\n    works = P && P.resolve && testResolve();\n    setProto(P2, P);\n    P2.prototype = $.create(P.prototype, {constructor: {value: P2}});\n    // actual Firefox has broken subclass support, test that\n    if(!(P2.resolve(5).then(function(){}) instanceof P2)){\n      works = false;\n    }\n    // actual V8 bug, https://code.google.com/p/v8/issues/detail?id=4162\n    if(works && require('./$.support-desc')){\n      var thenableThenGotten = false;\n      P.resolve($.setDesc({}, 'then', {\n        get: function(){ thenableThenGotten = true; }\n      }));\n      works = thenableThenGotten;\n    }\n  } catch(e){ works = false; }\n  return works;\n}();\n\n// helpers\nvar isPromise = function(it){\n  return isObject(it) && (useNative ? classof(it) == 'Promise' : RECORD in it);\n};\nvar sameConstructor = function(a, b){\n  // library wrapper special case\n  if(LIBRARY && a === P && b === Wrapper)return true;\n  return same(a, b);\n};\nvar getConstructor = function(C){\n  var S = anObject(C)[SPECIES];\n  return S != undefined ? S : C;\n};\nvar isThenable = function(it){\n  var then;\n  return isObject(it) && typeof (then = it.then) == 'function' ? then : false;\n};\nvar notify = function(record, isReject){\n  if(record.n)return;\n  record.n = true;\n  var chain = record.c;\n  asap(function(){\n    var value = record.v\n      , ok    = record.s == 1\n      , i     = 0;\n    var run = function(react){\n      var cb = ok ? react.ok : react.fail\n        , ret, then;\n      try {\n        if(cb){\n          if(!ok)record.h = true;\n          ret = cb === true ? value : cb(value);\n          if(ret === react.P){\n            react.rej(TypeError('Promise-chain cycle'));\n          } else if(then = isThenable(ret)){\n            then.call(ret, react.res, react.rej);\n          } else react.res(ret);\n        } else react.rej(value);\n      } catch(err){\n        react.rej(err);\n      }\n    };\n    while(chain.length > i)run(chain[i++]); // variable length - can't use forEach\n    chain.length = 0;\n    record.n = false;\n    if(isReject)setTimeout(function(){\n      var promise = record.p\n        , handler, console;\n      if(isUnhandled(promise)){\n        if(isNode){\n          process.emit('unhandledRejection', value, promise);\n        } else if(handler = global.onunhandledrejection){\n          handler({promise: promise, reason: value});\n        } else if((console = global.console) && console.error){\n          console.error('Unhandled promise rejection', value);\n        }\n      } record.a = undefined;\n    }, 1);\n  });\n};\nvar isUnhandled = function(promise){\n  var record = promise[RECORD]\n    , chain  = record.a || record.c\n    , i      = 0\n    , react;\n  if(record.h)return false;\n  while(chain.length > i){\n    react = chain[i++];\n    if(react.fail || !isUnhandled(react.P))return false;\n  } return true;\n};\nvar $reject = function(value){\n  var record = this;\n  if(record.d)return;\n  record.d = true;\n  record = record.r || record; // unwrap\n  record.v = value;\n  record.s = 2;\n  record.a = record.c.slice();\n  notify(record, true);\n};\nvar $resolve = function(value){\n  var record = this\n    , then;\n  if(record.d)return;\n  record.d = true;\n  record = record.r || record; // unwrap\n  try {\n    if(then = isThenable(value)){\n      asap(function(){\n        var wrapper = {r: record, d: false}; // wrap\n        try {\n          then.call(value, ctx($resolve, wrapper, 1), ctx($reject, wrapper, 1));\n        } catch(e){\n          $reject.call(wrapper, e);\n        }\n      });\n    } else {\n      record.v = value;\n      record.s = 1;\n      notify(record, false);\n    }\n  } catch(e){\n    $reject.call({r: record, d: false}, e); // wrap\n  }\n};\n\n// constructor polyfill\nif(!useNative){\n  // 25.4.3.1 Promise(executor)\n  P = function Promise(executor){\n    aFunction(executor);\n    var record = {\n      p: strictNew(this, P, PROMISE),         // <- promise\n      c: [],                                  // <- awaiting reactions\n      a: undefined,                           // <- checked in isUnhandled reactions\n      s: 0,                                   // <- state\n      d: false,                               // <- done\n      v: undefined,                           // <- value\n      h: false,                               // <- handled rejection\n      n: false                                // <- notify\n    };\n    this[RECORD] = record;\n    try {\n      executor(ctx($resolve, record, 1), ctx($reject, record, 1));\n    } catch(err){\n      $reject.call(record, err);\n    }\n  };\n  require('./$.mix')(P.prototype, {\n    // 25.4.5.3 Promise.prototype.then(onFulfilled, onRejected)\n    then: function then(onFulfilled, onRejected){\n      var S = anObject(anObject(this).constructor)[SPECIES];\n      var react = {\n        ok:   typeof onFulfilled == 'function' ? onFulfilled : true,\n        fail: typeof onRejected == 'function'  ? onRejected  : false\n      };\n      var promise = react.P = new (S != undefined ? S : P)(function(res, rej){\n        react.res = res;\n        react.rej = rej;\n      });\n      aFunction(react.res);\n      aFunction(react.rej);\n      var record = this[RECORD];\n      record.c.push(react);\n      if(record.a)record.a.push(react);\n      if(record.s)notify(record, false);\n      return promise;\n    },\n    // 25.4.5.1 Promise.prototype.catch(onRejected)\n    'catch': function(onRejected){\n      return this.then(undefined, onRejected);\n    }\n  });\n}\n\n// export\n$def($def.G + $def.W + $def.F * !useNative, {Promise: P});\nrequire('./$.tag')(P, PROMISE);\nspecies(P);\nspecies(Wrapper = require('./$.core')[PROMISE]);\n\n// statics\n$def($def.S + $def.F * !useNative, PROMISE, {\n  // 25.4.4.5 Promise.reject(r)\n  reject: function reject(r){\n    return new this(function(res, rej){ rej(r); });\n  }\n});\n$def($def.S + $def.F * (!useNative || testResolve(true)), PROMISE, {\n  // 25.4.4.6 Promise.resolve(x)\n  resolve: function resolve(x){\n    return isPromise(x) && sameConstructor(x.constructor, this)\n      ? x : new this(function(res){ res(x); });\n  }\n});\n$def($def.S + $def.F * !(useNative && require('./$.iter-detect')(function(iter){\n  P.all(iter)['catch'](function(){});\n})), PROMISE, {\n  // 25.4.4.1 Promise.all(iterable)\n  all: function all(iterable){\n    var C      = getConstructor(this)\n      , values = [];\n    return new C(function(res, rej){\n      forOf(iterable, false, values.push, values);\n      var remaining = values.length\n        , results   = Array(remaining);\n      if(remaining)$.each.call(values, function(promise, index){\n        C.resolve(promise).then(function(value){\n          results[index] = value;\n          --remaining || res(results);\n        }, rej);\n      });\n      else res(results);\n    });\n  },\n  // 25.4.4.4 Promise.race(iterable)\n  race: function race(iterable){\n    var C = getConstructor(this);\n    return new C(function(res, rej){\n      forOf(iterable, false, function(promise){\n        C.resolve(promise).then(res, rej);\n      });\n    });\n  }\n});"]}