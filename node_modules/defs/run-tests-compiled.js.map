{"version":3,"sources":["run-tests.js"],"names":[],"mappings":";;AAAA,IAAM,EAAE,GAAG,OAAO,CAAC,IAAI,CAAC,CAAC;AACzB,IAAM,GAAG,GAAG,OAAO,CAAC,YAAY,CAAC,CAAC;AAClC,IAAM,IAAI,GAAG,OAAO,CAAC,eAAe,CAAC,CAAC,IAAI,CAAC;AAC3C,IAAM,IAAI,GAAG,OAAO,CAAC,MAAM,CAAC,CAAC;;AAE7B,SAAS,KAAK,CAAC,QAAQ,EAAE;AACrB,WAAO,EAAE,CAAC,UAAU,CAAC,QAAQ,CAAC,GAAG,MAAM,CAAC,EAAE,CAAC,YAAY,CAAC,QAAQ,CAAC,CAAC,GAAG,EAAE,CAAC;CAC3E;;AAED,IAAM,WAAW,GAAI,EAAE,CAAC,UAAU,CAAC,OAAO,CAAC,GAAG,OAAO,GAAG,aAAa,AAAC,CAAC;;AAEvE,IAAM,KAAK,GAAG,EAAE,CAAC,WAAW,CAAC,WAAW,CAAC,CAAC,MAAM,CAAC,UAAS,QAAQ,EAAE;AAChE,WAAO,CAAC,WAAW,CAAC,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;CACpE,CAAC,CAAC;;AAEH,SAAS,GAAG,CAAC,IAAI,EAAE;AACf,aAAS,UAAU,CAAC,OAAO,EAAE,GAAG,EAAE,IAAI,EAAE;AACpC,YAAI,GAAG,KAAK,OAAO,EAAE;AACjB,gBAAM,KAAK,GAAG,IAAI,CAAC,WAAW,CAAC,IAAI,EAAE,OAAO,EAAE,GAAG,CAAC,CAAC;AACnD,mBAAO,CAAC,MAAM,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC;AAC5B,mBAAO,CAAC,MAAM,CAAC,KAAK,CAAC,MAAM,CAAC,CAAC;SAChC;KACJ;;AAED,QAAM,QAAQ,GAAG,IAAI,CAAC,KAAK,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC;AACnC,QAAI,CAAC,GAAG,CAAC,0BAA0B,EAAE,IAAI,EAAE,IAAI,EAAE,WAAW,EAAE,IAAI,CAAC,EAAE,UAAS,KAAK,EAAE,MAAM,EAAE,MAAM,EAAE;AACjG,cAAM,GAAG,MAAM,IAAI,EAAE,CAAC;AACtB,cAAM,GAAG,MAAM,IAAI,EAAE,CAAC;AACtB,YAAM,cAAc,GAAG,KAAK,CAAC,GAAG,CAAC,gBAAgB,EAAE,WAAW,EAAE,QAAQ,CAAC,CAAC,CAAC;AAC3E,YAAM,cAAc,GAAG,KAAK,CAAC,GAAG,CAAC,gBAAgB,EAAE,WAAW,EAAE,QAAQ,CAAC,CAAC,CAAC;;AAE3E,YAAM,IAAI,GAAI,MAAM,KAAK,cAAc,IAAI,MAAM,KAAK,cAAc,AAAC,CAAC;;AAEtE,YAAI,CAAC,IAAI,EAAE;AACP,mBAAO,CAAC,GAAG,CAAC,GAAG,CAAC,iBAAiB,EAAE,IAAI,CAAC,CAAC,CAAC;SAC7C;AACD,kBAAU,CAAC,cAAc,EAAE,MAAM,EAAE,GAAG,CAAC,YAAY,EAAE,IAAI,CAAC,CAAC,CAAC;AAC5D,kBAAU,CAAC,cAAc,EAAE,MAAM,EAAE,GAAG,CAAC,YAAY,EAAE,IAAI,CAAC,CAAC,CAAC;KAC/D,CAAC,CAAC;CACN;;AAED,IAAM,IAAI,GAAG,OAAO,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;AAC7B,IAAM,IAAI,GAAI,OAAO,CAAC,IAAI,CAAC,CAAC,CAAC,KAAK,KAAK,GAAG,EAAE,GAAG,WAAW,AAAC,CAAC;AAC5D,KAAK,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC","file":"run-tests-compiled.js","sourcesContent":["const fs = require(\"fs\");\nconst fmt = require(\"simple-fmt\");\nconst exec = require(\"child_process\").exec;\nconst diff = require(\"diff\");\n\nfunction slurp(filename) {\n    return fs.existsSync(filename) ? String(fs.readFileSync(filename)) : \"\";\n}\n\nconst pathToTests = (fs.existsSync(\"tests\") ? \"tests\" : \"../../tests\");\n\nconst tests = fs.readdirSync(pathToTests).filter(function(filename) {\n    return !/-out\\.js$/.test(filename) && !/-stderr$/.test(filename);\n});\n\nfunction run(test) {\n    function diffOutput(correct, got, name) {\n        if (got !== correct) {\n            const patch = diff.createPatch(name, correct, got);\n            process.stdout.write(patch);\n            process.stdout.write(\"\\n\\n\");\n        }\n    }\n\n    const noSuffix = test.slice(0, -3);\n    exec(fmt(\"{0} {1} defs-cmd {2}/{3}\", NODE, FLAG, pathToTests, test), function(error, stdout, stderr) {\n        stderr = stderr || \"\";\n        stdout = stdout || \"\";\n        const expectedStderr = slurp(fmt(\"{0}/{1}-stderr\", pathToTests, noSuffix));\n        const expectedStdout = slurp(fmt(\"{0}/{1}-out.js\", pathToTests, noSuffix));\n\n        const pass = (stderr === expectedStderr && stdout === expectedStdout);\n\n        if (!pass) {\n            console.log(fmt(\"FAILED test {0}\", test));\n        }\n        diffOutput(expectedStdout, stdout, fmt(\"{0}-out.js\", test));\n        diffOutput(expectedStderr, stderr, fmt(\"{0}-stderr\", test));\n    });\n}\n\nconst NODE = process.argv[0];\nconst FLAG = (process.argv[2] === \"es5\" ? \"\" : \"--harmony\");\ntests.forEach(run);\n"]}