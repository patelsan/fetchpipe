{"version":3,"sources":["injector.js"],"names":[],"mappings":"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","file":"injector-compiled.js","sourcesContent":["var Module = require('./module');\nvar autoAnnotate = require('./annotation').parse;\n\n\nvar Injector = function(modules, parent) {\n  parent = parent || {\n    get: function(name) {\n      currentlyResolving.push(name);\n      throw error('No provider for \"' + name + '\"!');\n    }\n  };\n\n  var currentlyResolving = [];\n  var providers = this._providers = Object.create(parent._providers || null);\n  var instances = this._instances = Object.create(null);\n\n  instances.injector = this;\n\n  var error = function(msg) {\n    var stack = currentlyResolving.join(' -> ');\n    currentlyResolving.length = 0;\n    return new Error(stack ? msg + ' (Resolving: ' + stack + ')' : msg);\n  };\n\n  var get = function(name) {\n    if (!providers[name] && name.indexOf('.') !== -1) {\n      var parts = name.split('.');\n      var pivot = get(parts.shift());\n\n      while(parts.length) {\n        pivot = pivot[parts.shift()];\n      }\n\n      return pivot;\n    }\n\n    if (Object.hasOwnProperty.call(instances, name)) {\n      return instances[name];\n    }\n\n    if (Object.hasOwnProperty.call(providers, name)) {\n      if (currentlyResolving.indexOf(name) !== -1) {\n        currentlyResolving.push(name);\n        throw error('Can not resolve circular dependency!');\n      }\n\n      currentlyResolving.push(name);\n      instances[name] = providers[name][0](providers[name][1]);\n      currentlyResolving.pop();\n\n      return instances[name];\n    }\n\n    return parent.get(name);\n  };\n\n  var instantiate = function(Type) {\n    var instance = Object.create(Type.prototype);\n    var returned = invoke(Type, instance);\n\n    return typeof returned === 'object' ? returned : instance;\n  };\n\n  var invoke = function(fn, context) {\n    if (typeof fn !== 'function') {\n      throw error('Can not invoke \"' + fn + '\". Expected a function!');\n    }\n\n    var inject = fn.$inject && fn.$inject || autoAnnotate(fn);\n    var dependencies = inject.map(function(dep) {\n      return get(dep);\n    });\n\n    // TODO(vojta): optimize without apply\n    return fn.apply(context, dependencies);\n  };\n\n  var createChild = function(modules, providersFromParent) {\n    if (providersFromParent && providersFromParent.length) {\n      var fromParentModule = Object.create(null);\n\n      providersFromParent.forEach(function(name) {\n        if (!providers[name]) {\n          throw new Error('No provider for \"' + name + '\". Can not use provider from the parent!');\n        }\n\n        fromParentModule[name] = [providers[name][2], providers[name][1]];\n      });\n\n      modules.unshift(fromParentModule);\n    }\n\n    return new Injector(modules, this);\n  };\n\n  var factoryMap = {\n    factory: invoke,\n    type: instantiate,\n    value: function(value) {\n      return value;\n    }\n  };\n\n  modules.forEach(function(module) {\n    // TODO(vojta): handle wrong inputs (modules)\n    if (module instanceof Module) {\n      module.forEach(function(provider) {\n        var name = provider[0];\n        var type = provider[1];\n        var value = provider[2];\n\n        providers[name] = [factoryMap[type], value, type];\n      });\n    } else if (typeof module === 'object') {\n      Object.keys(module).forEach(function(name) {\n        var type = module[name][0];\n        var value = module[name][1];\n\n        providers[name] = [factoryMap[type], value, type];\n      });\n    }\n  });\n\n  // public API\n  this.get = get;\n  this.invoke = invoke;\n  this.instantiate = instantiate;\n  this.createChild = createChild;\n};\n\nmodule.exports = Injector;\n"]}