{"version":3,"sources":["polling.js"],"names":[],"mappings":"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","file":"polling-compiled.js","sourcesContent":["/**\n * Module dependencies.\n */\n\nvar Transport = require('../transport');\nvar parseqs = require('parseqs');\nvar parser = require('engine.io-parser');\nvar inherit = require('component-inherit');\nvar debug = require('debug')('engine.io-client:polling');\n\n/**\n * Module exports.\n */\n\nmodule.exports = Polling;\n\n/**\n * Is XHR2 supported?\n */\n\nvar hasXHR2 = (function() {\n  var XMLHttpRequest = require('xmlhttprequest');\n  var xhr = new XMLHttpRequest({ xdomain: false });\n  return null != xhr.responseType;\n})();\n\n/**\n * Polling interface.\n *\n * @param {Object} opts\n * @api private\n */\n\nfunction Polling(opts){\n  var forceBase64 = (opts && opts.forceBase64);\n  if (!hasXHR2 || forceBase64) {\n    this.supportsBinary = false;\n  }\n  Transport.call(this, opts);\n}\n\n/**\n * Inherits from Transport.\n */\n\ninherit(Polling, Transport);\n\n/**\n * Transport name.\n */\n\nPolling.prototype.name = 'polling';\n\n/**\n * Opens the socket (triggers polling). We write a PING message to determine\n * when the transport is open.\n *\n * @api private\n */\n\nPolling.prototype.doOpen = function(){\n  this.poll();\n};\n\n/**\n * Pauses polling.\n *\n * @param {Function} callback upon buffers are flushed and transport is paused\n * @api private\n */\n\nPolling.prototype.pause = function(onPause){\n  var pending = 0;\n  var self = this;\n\n  this.readyState = 'pausing';\n\n  function pause(){\n    debug('paused');\n    self.readyState = 'paused';\n    onPause();\n  }\n\n  if (this.polling || !this.writable) {\n    var total = 0;\n\n    if (this.polling) {\n      debug('we are currently polling - waiting to pause');\n      total++;\n      this.once('pollComplete', function(){\n        debug('pre-pause polling complete');\n        --total || pause();\n      });\n    }\n\n    if (!this.writable) {\n      debug('we are currently writing - waiting to pause');\n      total++;\n      this.once('drain', function(){\n        debug('pre-pause writing complete');\n        --total || pause();\n      });\n    }\n  } else {\n    pause();\n  }\n};\n\n/**\n * Starts polling cycle.\n *\n * @api public\n */\n\nPolling.prototype.poll = function(){\n  debug('polling');\n  this.polling = true;\n  this.doPoll();\n  this.emit('poll');\n};\n\n/**\n * Overloads onData to detect payloads.\n *\n * @api private\n */\n\nPolling.prototype.onData = function(data){\n  var self = this;\n  debug('polling got data %s', data);\n  var callback = function(packet, index, total) {\n    // if its the first message we consider the transport open\n    if ('opening' == self.readyState) {\n      self.onOpen();\n    }\n\n    // if its a close packet, we close the ongoing requests\n    if ('close' == packet.type) {\n      self.onClose();\n      return false;\n    }\n\n    // otherwise bypass onData and handle the message\n    self.onPacket(packet);\n  };\n\n  // decode payload\n  parser.decodePayload(data, this.socket.binaryType, callback);\n\n  // if an event did not trigger closing\n  if ('closed' != this.readyState) {\n    // if we got data we're not polling\n    this.polling = false;\n    this.emit('pollComplete');\n\n    if ('open' == this.readyState) {\n      this.poll();\n    } else {\n      debug('ignoring poll - transport state \"%s\"', this.readyState);\n    }\n  }\n};\n\n/**\n * For polling, send a close packet.\n *\n * @api private\n */\n\nPolling.prototype.doClose = function(){\n  var self = this;\n\n  function close(){\n    debug('writing close packet');\n    self.write([{ type: 'close' }]);\n  }\n\n  if ('open' == this.readyState) {\n    debug('transport open - closing');\n    close();\n  } else {\n    // in case we're trying to close while\n    // handshaking is in progress (GH-164)\n    debug('transport not open - deferring close');\n    this.once('open', close);\n  }\n};\n\n/**\n * Writes a packets payload.\n *\n * @param {Array} data packets\n * @param {Function} drain callback\n * @api private\n */\n\nPolling.prototype.write = function(packets){\n  var self = this;\n  this.writable = false;\n  var callbackfn = function() {\n    self.writable = true;\n    self.emit('drain');\n  };\n\n  var self = this;\n  parser.encodePayload(packets, this.supportsBinary, function(data) {\n    self.doWrite(data, callbackfn);\n  });\n};\n\n/**\n * Generates uri for connection.\n *\n * @api private\n */\n\nPolling.prototype.uri = function(){\n  var query = this.query || {};\n  var schema = this.secure ? 'https' : 'http';\n  var port = '';\n\n  // cache busting is forced\n  if (false !== this.timestampRequests) {\n    query[this.timestampParam] = +new Date + '-' + Transport.timestamps++;\n  }\n\n  if (!this.supportsBinary && !query.sid) {\n    query.b64 = 1;\n  }\n\n  query = parseqs.encode(query);\n\n  // avoid port if default for schema\n  if (this.port && (('https' == schema && this.port != 443) ||\n     ('http' == schema && this.port != 80))) {\n    port = ':' + this.port;\n  }\n\n  // prepend ? to query\n  if (query.length) {\n    query = '?' + query;\n  }\n\n  return schema + '://' + this.hostname + port + this.path + query;\n};\n"]}