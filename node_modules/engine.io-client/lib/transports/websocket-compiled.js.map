{"version":3,"sources":["websocket.js"],"names":[],"mappings":"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","file":"websocket-compiled.js","sourcesContent":["/**\n * Module dependencies.\n */\n\nvar Transport = require('../transport');\nvar parser = require('engine.io-parser');\nvar parseqs = require('parseqs');\nvar inherit = require('component-inherit');\nvar debug = require('debug')('engine.io-client:websocket');\n\n/**\n * `ws` exposes a WebSocket-compatible interface in\n * Node, or the `WebSocket` or `MozWebSocket` globals\n * in the browser.\n */\n\nvar WebSocket = require('ws');\n\n/**\n * Module exports.\n */\n\nmodule.exports = WS;\n\n/**\n * WebSocket transport constructor.\n *\n * @api {Object} connection options\n * @api public\n */\n\nfunction WS(opts){\n  var forceBase64 = (opts && opts.forceBase64);\n  if (forceBase64) {\n    this.supportsBinary = false;\n  }\n  Transport.call(this, opts);\n}\n\n/**\n * Inherits from Transport.\n */\n\ninherit(WS, Transport);\n\n/**\n * Transport name.\n *\n * @api public\n */\n\nWS.prototype.name = 'websocket';\n\n/*\n * WebSockets support binary\n */\n\nWS.prototype.supportsBinary = true;\n\n/**\n * Opens socket.\n *\n * @api private\n */\n\nWS.prototype.doOpen = function(){\n  if (!this.check()) {\n    // let probe timeout\n    return;\n  }\n\n  var self = this;\n  var uri = this.uri();\n  var protocols = void(0);\n  var opts = { agent: this.agent };\n\n  // SSL options for Node.js client\n  opts.pfx = this.pfx;\n  opts.key = this.key;\n  opts.passphrase = this.passphrase;\n  opts.cert = this.cert;\n  opts.ca = this.ca;\n  opts.ciphers = this.ciphers;\n  opts.rejectUnauthorized = this.rejectUnauthorized;\n\n  this.ws = new WebSocket(uri, protocols, opts);\n\n  if (this.ws.binaryType === undefined) {\n    this.supportsBinary = false;\n  }\n\n  this.ws.binaryType = 'arraybuffer';\n  this.addEventListeners();\n};\n\n/**\n * Adds event listeners to the socket\n *\n * @api private\n */\n\nWS.prototype.addEventListeners = function(){\n  var self = this;\n\n  this.ws.onopen = function(){\n    self.onOpen();\n  };\n  this.ws.onclose = function(){\n    self.onClose();\n  };\n  this.ws.onmessage = function(ev){\n    self.onData(ev.data);\n  };\n  this.ws.onerror = function(e){\n    self.onError('websocket error', e);\n  };\n};\n\n/**\n * Override `onData` to use a timer on iOS.\n * See: https://gist.github.com/mloughran/2052006\n *\n * @api private\n */\n\nif ('undefined' != typeof navigator\n  && /iPad|iPhone|iPod/i.test(navigator.userAgent)) {\n  WS.prototype.onData = function(data){\n    var self = this;\n    setTimeout(function(){\n      Transport.prototype.onData.call(self, data);\n    }, 0);\n  };\n}\n\n/**\n * Writes data to socket.\n *\n * @param {Array} array of packets.\n * @api private\n */\n\nWS.prototype.write = function(packets){\n  var self = this;\n  this.writable = false;\n  // encodePacket efficient as it uses WS framing\n  // no need for encodePayload\n  for (var i = 0, l = packets.length; i < l; i++) {\n    parser.encodePacket(packets[i], this.supportsBinary, function(data) {\n      //Sometimes the websocket has already been closed but the browser didn't\n      //have a chance of informing us about it yet, in that case send will\n      //throw an error\n      try {\n        self.ws.send(data);\n      } catch (e){\n        debug('websocket closed before onclose event');\n      }\n    });\n  }\n\n  function ondrain() {\n    self.writable = true;\n    self.emit('drain');\n  }\n  // fake drain\n  // defer to next tick to allow Socket to clear writeBuffer\n  setTimeout(ondrain, 0);\n};\n\n/**\n * Called upon close\n *\n * @api private\n */\n\nWS.prototype.onClose = function(){\n  Transport.prototype.onClose.call(this);\n};\n\n/**\n * Closes socket.\n *\n * @api private\n */\n\nWS.prototype.doClose = function(){\n  if (typeof this.ws !== 'undefined') {\n    this.ws.close();\n  }\n};\n\n/**\n * Generates uri for connection.\n *\n * @api private\n */\n\nWS.prototype.uri = function(){\n  var query = this.query || {};\n  var schema = this.secure ? 'wss' : 'ws';\n  var port = '';\n\n  // avoid port if default for schema\n  if (this.port && (('wss' == schema && this.port != 443)\n    || ('ws' == schema && this.port != 80))) {\n    port = ':' + this.port;\n  }\n\n  // append timestamp to URI\n  if (this.timestampRequests) {\n    query[this.timestampParam] = +new Date;\n  }\n\n  // communicate binary support capabilities\n  if (!this.supportsBinary) {\n    query.b64 = 1;\n  }\n\n  query = parseqs.encode(query);\n\n  // prepend ? to query\n  if (query.length) {\n    query = '?' + query;\n  }\n\n  return schema + '://' + this.hostname + port + this.path + query;\n};\n\n/**\n * Feature detection for WebSocket.\n *\n * @return {Boolean} whether this transport is available.\n * @api public\n */\n\nWS.prototype.check = function(){\n  return !!WebSocket && !('__initialize' in WebSocket && this.name === WS.prototype.name);\n};\n"]}