{"version":3,"sources":["websocket.js"],"names":[],"mappings":";;;;;;;AAKA,IAAI,SAAS,GAAG,OAAO,CAAC,cAAc,CAAC;IACnC,MAAM,GAAG,OAAO,CAAC,kBAAkB,CAAC;IACpC,KAAK,GAAG,OAAO,CAAC,OAAO,CAAC,CAAC,WAAW,CAAC,CAAA;;;;;;AAMzC,MAAM,CAAC,OAAO,GAAG,SAAS,CAAC;;;;;;;;;AAS3B,SAAS,SAAS,CAAE,GAAG,EAAE;AACvB,WAAS,CAAC,IAAI,CAAC,IAAI,EAAE,GAAG,CAAC,CAAC;AAC1B,MAAI,IAAI,GAAG,IAAI,CAAC;AAChB,MAAI,CAAC,MAAM,GAAG,GAAG,CAAC,SAAS,CAAC;AAC5B,MAAI,CAAC,MAAM,CAAC,EAAE,CAAC,SAAS,EAAE,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC;AAClD,MAAI,CAAC,MAAM,CAAC,IAAI,CAAC,OAAO,EAAE,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC;AACnD,MAAI,CAAC,MAAM,CAAC,EAAE,CAAC,OAAO,EAAE,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC;AACjD,MAAI,CAAC,MAAM,CAAC,EAAE,CAAC,SAAS,EAAE,UAAU,OAAO,EAAE;AAC3C,QAAI,CAAC,IAAI,CAAC,SAAS,EAAE,OAAO,CAAC,CAAC;GAC/B,CAAC,CAAC;AACH,MAAI,CAAC,QAAQ,GAAG,IAAI,CAAC;CACtB,CAAC;;;;;;AAMF,SAAS,CAAC,SAAS,CAAC,SAAS,GAAG,SAAS,CAAC,SAAS,CAAC;;;;;;;;AAQpD,SAAS,CAAC,SAAS,CAAC,IAAI,GAAG,WAAW,CAAC;;;;;;;;AAQvC,SAAS,CAAC,SAAS,CAAC,eAAe,GAAG,IAAI,CAAC;;;;;;;;AAQ3C,SAAS,CAAC,SAAS,CAAC,eAAe,GAAG,IAAI,CAAC;;;;;;;;;AAS3C,SAAS,CAAC,SAAS,CAAC,MAAM,GAAG,UAAU,IAAI,EAAE;AAC3C,OAAK,CAAC,eAAe,EAAE,IAAI,CAAC,CAAC;AAC7B,WAAS,CAAC,SAAS,CAAC,MAAM,CAAC,IAAI,CAAC,IAAI,EAAE,IAAI,CAAC,CAAC;CAC7C,CAAC;;;;;;;;;AASF,SAAS,CAAC,SAAS,CAAC,IAAI,GAAG,UAAU,OAAO,EAAE;AAC5C,MAAI,IAAI,GAAG,IAAI,CAAC;AAChB,OAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,OAAO,CAAC,MAAM,EAAE,CAAC,GAAG,CAAC,EAAE,CAAC,EAAE,EAAE;AAC9C,UAAM,CAAC,YAAY,CAAC,OAAO,CAAC,CAAC,CAAC,EAAE,IAAI,CAAC,cAAc,EAAE,UAAS,IAAI,EAAE;AAClE,WAAK,CAAC,cAAc,EAAE,IAAI,CAAC,CAAC;AAC5B,UAAI,CAAC,QAAQ,GAAG,KAAK,CAAC;AACtB,UAAI,CAAC,MAAM,CAAC,IAAI,CAAC,IAAI,EAAE,UAAU,GAAG,EAAC;AACnC,YAAI,GAAG,EAAE,OAAO,IAAI,CAAC,OAAO,CAAC,aAAa,EAAE,GAAG,CAAC,KAAK,CAAC,CAAC;AACvD,YAAI,CAAC,QAAQ,GAAG,IAAI,CAAC;AACrB,YAAI,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;OACpB,CAAC,CAAC;KACJ,CAAC,CAAC;GACJ;CACF,CAAC;;;;;;;;AAQF,SAAS,CAAC,SAAS,CAAC,OAAO,GAAG,UAAU,EAAE,EAAE;AAC1C,OAAK,CAAC,SAAS,CAAC,CAAC;AACjB,MAAI,CAAC,MAAM,CAAC,KAAK,EAAE,CAAC;AACpB,IAAE,IAAI,EAAE,EAAE,CAAC;CACZ,CAAC","file":"websocket-compiled.js","sourcesContent":["\n/**\n * Module dependencies.\n */\n\nvar Transport = require('../transport')\n  , parser = require('engine.io-parser')\n  , debug = require('debug')('engine:ws')\n\n/**\n * Export the constructor.\n */\n\nmodule.exports = WebSocket;\n\n/**\n * WebSocket transport \n *\n * @param {http.ServerRequest}\n * @api public\n */\n\nfunction WebSocket (req) {\n  Transport.call(this, req);\n  var self = this;\n  this.socket = req.websocket;\n  this.socket.on('message', this.onData.bind(this));\n  this.socket.once('close', this.onClose.bind(this));\n  this.socket.on('error', this.onError.bind(this));\n  this.socket.on('headers', function (headers) {\n    self.emit('headers', headers);\n  });\n  this.writable = true;\n};\n\n/**\n * Inherits from Transport.\n */\n\nWebSocket.prototype.__proto__ = Transport.prototype;\n\n/**\n * Transport name\n *\n * @api public\n */\n\nWebSocket.prototype.name = 'websocket';\n\n/**\n * Advertise upgrade support.\n *\n * @api public\n */\n\nWebSocket.prototype.handlesUpgrades = true;\n\n/**\n * Advertise framing support.\n *\n * @api public\n */\n\nWebSocket.prototype.supportsFraming = true;\n\n/**\n * Processes the incoming data.\n *\n * @param {String} encoded packet\n * @api private\n */\n\nWebSocket.prototype.onData = function (data) {\n  debug('received \"%s\"', data);\n  Transport.prototype.onData.call(this, data);\n};\n\n/**\n * Writes a packet payload.\n *\n * @param {Array} packets\n * @api private\n */\n\nWebSocket.prototype.send = function (packets) {\n  var self = this;\n  for (var i = 0, l = packets.length; i < l; i++) {\n    parser.encodePacket(packets[i], this.supportsBinary, function(data) {\n      debug('writing \"%s\"', data);\n      self.writable = false;\n      self.socket.send(data, function (err){\n        if (err) return self.onError('write error', err.stack);\n        self.writable = true;\n        self.emit('drain');\n      });\n    });\n  }\n};\n\n/**\n * Closes the transport.\n *\n * @api private\n */\n\nWebSocket.prototype.doClose = function (fn) {\n  debug('closing');\n  this.socket.close();\n  fn && fn();\n};\n"]}