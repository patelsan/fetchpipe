{"version":3,"sources":["testbinary.js"],"names":[],"mappings":"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","file":"testbinary-compiled.js","sourcesContent":["\"use strict\";\n\nmodule.exports = exports = testbinary;\n\nexports.usage = 'Tests that the binary.node can be required';\n\nvar fs = require('fs');\nvar path = require('path');\nvar log = require('npmlog');\nvar cp = require('child_process');\nvar versioning = require('./util/versioning.js');\nvar path = require('path');\n\nfunction testbinary(gyp, argv, callback) {\n    var args = [];\n    var options = {};\n    var shell_cmd = process.execPath;\n    var package_json = JSON.parse(fs.readFileSync('./package.json'));\n    var opts = versioning.evaluate(package_json, gyp.opts);\n    // ensure on windows that / are used for require path\n    var binary_module = opts.module.replace(/\\\\/g, '/');\n    var nw = (opts.runtime && opts.runtime === 'node-webkit');\n    if (nw) {\n        options.timeout = 5000;\n        if (process.platform === 'darwin') {\n            shell_cmd = 'node-webkit';\n        } else if (process.platform === 'win32') {\n            shell_cmd = 'nw.exe';\n        } else {\n            shell_cmd = 'nw';\n        }\n        var modulePath = path.resolve(binary_module);\n        var appDir = path.join(__dirname, 'util', 'nw-pre-gyp');\n        args.push(appDir);\n        args.push(modulePath);\n        log.info(\"validate\",\"Running test command: '\" + shell_cmd + ' ' + args.join(' ') + \"'\");\n        cp.execFile(shell_cmd, args, options, function(err, stdout, stderr) {\n            // check for normal timeout for node-webkit\n            if (err) {\n                if (err.killed === true && err.signal && err.signal.indexOf('SIG') > -1) {\n                    return callback();\n                }\n                var stderrLog = stderr.toString();\n                log.info('stderr', stderrLog);\n                if( /^\\s*Xlib:\\s*extension\\s*\"RANDR\"\\s*missing\\s*on\\s*display\\s*\":\\d+\\.\\d+\"\\.\\s*$/.test(stderrLog) ){\n                    log.info('RANDR', 'stderr contains only RANDR error, ignored');\n                    return callback();\n                }\n                return callback(err);\n            }\n            return callback();\n        });\n        return;\n    }\n    if ((process.arch != opts.target_arch) ||\n        (process.platform != opts.target_platform)) {\n        var msg = \"skipping validation since host platform/arch (\";\n        msg += process.platform+'/'+process.arch+\")\";\n        msg += \" does not match target (\";\n        msg += opts.target_platform+'/'+opts.target_arch+\")\";\n        log.info('validate', msg);\n        return callback();\n    }\n    args.push('--eval');\n    args.push(\"'require(\\\\'\" + binary_module.replace(/\\'/g, '\\\\\\'') +\"\\\\')'\");\n    log.info(\"validate\",\"Running test command: '\" + shell_cmd + ' ' + args.join(' ') + \"'\");\n    cp.execFile(shell_cmd, args, options, function(err, stdout, stderr) {\n        if (err) {\n            return callback(err, { stdout:stdout, stderr:stderr});\n        }\n        return callback();\n    });\n}\n"]}