{"version":3,"sources":["trackerstream.js"],"names":[],"mappings":"AAAA,YAAY,CAAA;AACZ,IAAI,IAAI,GAAG,OAAO,CAAC,KAAK,CAAC,CAAC,IAAI,CAAA;AAC9B,IAAI,IAAI,GAAG,OAAO,CAAC,MAAM,CAAC,CAAA;AAC1B,IAAI,MAAM,GAAG,OAAO,CAAC,iBAAiB,CAAC,CAAA;AACvC,IAAI,aAAa,GAAG,OAAO,CAAC,aAAa,CAAC,CAAC,aAAa,CAAA;;AAExD,IAAI,YAAY,GAAG,IAAI,KAAK,CAAC,SAAS,CAAC,CAAA;AACvC,IAAI,SAAS,GAAG,SAAZ,SAAS,CAAa,GAAG,EAAC,KAAK,EAAC,IAAI,EAAE;AACxC,MAAI,OAAO,GAAG,UAAU,CAAC,YAAU;AACjC,OAAG,CAAC,cAAc,CAAC,KAAK,EAAE,YAAY,CAAC,CAAA;AACvC,QAAI,CAAC,YAAY,CAAC,CAAA;GACnB,EAAE,EAAE,CAAC,CAAA;AACN,MAAI,YAAY,GAAG,SAAf,YAAY,GAAe;AAC7B,QAAI,IAAI,GAAG,KAAK,CAAC,SAAS,CAAC,KAAK,CAAC,IAAI,CAAC,SAAS,CAAC,CAAA;AAChD,QAAI,CAAC,OAAO,CAAC,IAAI,CAAC,CAAA;AAClB,gBAAY,CAAC,OAAO,CAAC,CAAA;AACrB,QAAI,CAAC,KAAK,CAAC,IAAI,EAAE,IAAI,CAAC,CAAA;GACvB,CAAA;AACD,KAAG,CAAC,IAAI,CAAC,KAAK,EAAE,YAAY,CAAC,CAAA;CAC9B,CAAA;;AAED,IAAI,IAAI,GAAG,SAAP,IAAI,GAAe;AACrB,QAAM,CAAC,QAAQ,CAAC,KAAK,CAAC,IAAI,EAAC,SAAS,CAAC,CAAA;CACtC,CAAA;AACD,IAAI,CAAC,QAAQ,CAAC,IAAI,EAAE,MAAM,CAAC,QAAQ,CAAC,CAAA;AACpC,IAAI,CAAC,SAAS,CAAC,MAAM,GAAG,UAAU,IAAI,EAAE,QAAQ,EAAE,EAAE,EAAE;AACpD,IAAE,EAAE,CAAA;CACL,CAAA;;AAED,IAAI,CAAC,eAAe,EAAE,UAAU,CAAC,EAAE;AACjC,GAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAA;;AAET,MAAI,IAAI,GAAG,MAAM,CAAA;AACjB,MAAI,KAAK,GAAG,IAAI,aAAa,CAAC,IAAI,CAAC,CAAA;;AAEnC,GAAC,CAAC,EAAE,CAAC,KAAK,CAAC,SAAS,EAAE,EAAE,CAAC,EAAE,8BAA8B,CAAC,CAAA;;AAE1D,MAAI,IAAI,GAAG,EAAE,CAAA;AACb,OAAK,GAAG,IAAI,aAAa,CAAC,IAAI,EAAE,IAAI,CAAC,CAAA;AACrC,GAAC,CAAC,EAAE,CAAC,KAAK,CAAC,SAAS,EAAE,EAAE,CAAC,EAAE,8BAA8B,CAAC,CAAA;;AAE1D,OAAK,CAAC,IAAI,CAAC,IAAI,IAAI,EAAE,CAAC,CAAA;;AAEtB,WAAS,CAAC,KAAK,EAAE,QAAQ,EAAE,iBAAiB,CAAC,CAAA;AAC7C,OAAK,CAAC,KAAK,CAAC,YAAY,CAAC,CAAA;AACzB,WAAS,iBAAiB,CAAC,EAAE,EAAE,YAAY,EAAE;AAC3C,KAAC,CAAC,EAAE,CAAC,EAAE,EAAE,IAAI,EAAE,8BAA8B,CAAC,CAAA;AAC9C,KAAC,CAAC,EAAE,CAAC,YAAY,EAAE,IAAI,EAAE,yCAAyC,CAAC,CAAA;AACnE,KAAC,CAAC,EAAE,CAAC,KAAK,CAAC,SAAS,EAAE,EAAE,CAAC,EAAE,uBAAuB,CAAC,CAAA;;AAEnD,aAAS,CAAC,KAAK,EAAE,QAAQ,EAAE,YAAY,CAAC,CAAA;AACxC,SAAK,CAAC,OAAO,CAAC,EAAE,CAAC,CAAA;GAClB;AACD,WAAS,YAAY,CAAC,EAAE,EAAE,YAAY,EAAE;AACtC,KAAC,CAAC,EAAE,CAAC,EAAE,EAAE,IAAI,EAAE,gCAAgC,CAAC,CAAA;AAChD,KAAC,CAAC,EAAE,CAAC,KAAK,CAAC,SAAS,EAAE,EAAE,GAAG,EAAE,wBAAwB,CAAC,CAAA;;AAEtD,aAAS,CAAC,KAAK,EAAE,QAAQ,EAAE,YAAY,CAAC,CAAA;AACxC,SAAK,CAAC,KAAK,CAAC,sBAAsB,CAAC,CAAA;GACpC;AACD,WAAS,YAAY,CAAC,EAAE,EAAE;AACxB,KAAC,CAAC,EAAE,CAAC,EAAE,EAAE,IAAI,EAAE,gCAAgC,CAAC,CAAA;AAChD,KAAC,CAAC,EAAE,CAAC,KAAK,CAAC,SAAS,EAAE,EAAE,CAAC,EAAE,yBAAyB,CAAC,CAAA;GACtD;CACF,CAAC,CAAA","file":"trackerstream-compiled.js","sourcesContent":["\"use strict\"\nvar test = require(\"tap\").test\nvar util = require(\"util\")\nvar stream = require(\"readable-stream\")\nvar TrackerStream = require(\"../index.js\").TrackerStream\n\nvar timeoutError = new Error(\"timeout\")\nvar testEvent = function (obj,event,next) {\n  var timeout = setTimeout(function(){\n    obj.removeListener(event, eventHandler)\n    next(timeoutError)\n  }, 10)\n  var eventHandler = function () {\n    var args = Array.prototype.slice.call(arguments)\n    args.unshift(null)\n    clearTimeout(timeout)\n    next.apply(null, args)\n  }\n  obj.once(event, eventHandler)\n}\n\nvar Sink = function () {\n  stream.Writable.apply(this,arguments)\n}\nutil.inherits(Sink, stream.Writable)\nSink.prototype._write = function (data, encoding, cb) {\n  cb()\n}\n\ntest(\"TrackerStream\", function (t) {\n  t.plan(9)\n\n  var name = \"test\"\n  var track = new TrackerStream(name)\n\n  t.is(track.completed(), 0, \"Nothing todo is 0 completion\")\n\n  var todo = 10\n  track = new TrackerStream(name, todo)\n  t.is(track.completed(), 0, \"Nothing done is 0 completion\")\n\n  track.pipe(new Sink())\n\n  testEvent(track, \"change\", afterCompleteWork)\n  track.write(\"0123456789\")\n  function afterCompleteWork(er, onChangeName) {\n    t.is(er, null, \"write: on change event fired\")\n    t.is(onChangeName, name, \"write: on change emits the correct name\")\n    t.is(track.completed(), 1, \"write: 100% completed\")\n\n    testEvent(track, \"change\", afterAddWork)\n    track.addWork(10)\n  }\n  function afterAddWork(er, onChangeName) {\n    t.is(er, null, \"addWork: on change event fired\")\n    t.is(track.completed(), 0.5, \"addWork: 50% completed\")\n\n    testEvent(track, \"change\", afterAllWork)\n    track.write(\"ABCDEFGHIJKLMNOPQRST\")\n  }\n  function afterAllWork(er) {\n    t.is(er, null, \"allWork: on change event fired\")\n    t.is(track.completed(), 1, \"allWork: 100% completed\")\n  }\n})\n"]}