{"version":3,"sources":["har.js"],"names":[],"mappings":"AAAA,YAAY,CAAA;;AAEZ,IAAI,EAAE,GAAG,OAAO,CAAC,IAAI,CAAC,CAAA;AACtB,IAAI,EAAE,GAAG,OAAO,CAAC,aAAa,CAAC,CAAA;AAC/B,IAAI,QAAQ,GAAG,OAAO,CAAC,eAAe,CAAC,CAAA;AACvC,IAAI,IAAI,GAAG,OAAO,CAAC,MAAM,CAAC,CAAA;;AAE1B,SAAS,GAAG,CAAE,OAAO,EAAE;AACrB,MAAI,CAAC,OAAO,GAAG,OAAO,CAAA;CACvB;;AAED,GAAG,CAAC,SAAS,CAAC,OAAO,GAAG,UAAU,GAAG,EAAE,IAAI,EAAE;;AAE3C,MAAI,GAAG,CAAC,IAAI,CAAC,IAAI,CAAC,KAAK,SAAS,EAAE;AAChC,OAAG,CAAC,IAAI,CAAC,IAAI,CAAC,GAAG,IAAI,CAAC,KAAK,CAAA;AAC3B,WAAO,GAAG,CAAA;GACX;;;AAGD,MAAI,GAAG,GAAG,CACR,GAAG,CAAC,IAAI,CAAC,IAAI,CAAC,EACd,IAAI,CAAC,KAAK,CACX,CAAA;;AAED,KAAG,CAAC,IAAI,CAAC,IAAI,CAAC,GAAG,GAAG,CAAA;;AAEpB,SAAO,GAAG,CAAA;CACX,CAAA;;AAED,GAAG,CAAC,SAAS,CAAC,IAAI,GAAG,UAAU,IAAI,EAAE;;AAEnC,MAAI,CAAC,QAAQ,GAAG,EAAE,CAAA;AAClB,MAAI,CAAC,UAAU,GAAG,EAAE,CAAA;AACpB,MAAI,CAAC,QAAQ,CAAC,OAAO,GAAG,KAAK,CAAA;AAC7B,MAAI,CAAC,QAAQ,CAAC,SAAS,GAAG,KAAK,CAAA;;;AAG/B,MAAI,IAAI,CAAC,WAAW,IAAI,IAAI,CAAC,WAAW,CAAC,MAAM,EAAE;AAC/C,QAAI,CAAC,QAAQ,GAAG,IAAI,CAAC,WAAW,CAAC,MAAM,CAAC,IAAI,CAAC,OAAO,EAAE,EAAE,CAAC,CAAA;GAC1D;;;AAGD,MAAI,IAAI,CAAC,OAAO,IAAI,IAAI,CAAC,OAAO,CAAC,MAAM,EAAE;;AAEvC,QAAI,CAAC,UAAU,GAAG,IAAI,CAAC,OAAO,CAAC,WAAW,CAAC,UAAU,OAAO,EAAE,MAAM,EAAE;AACpE,aAAO,CAAC,MAAM,CAAC,IAAI,CAAC,GAAG,MAAM,CAAC,KAAK,CAAA;AACnC,aAAO,OAAO,CAAA;KACf,EAAE,EAAE,CAAC,CAAA;GACP;;;AAGD,MAAI,IAAI,CAAC,OAAO,IAAI,IAAI,CAAC,OAAO,CAAC,MAAM,EAAE;AACvC,QAAI,OAAO,GAAG,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC,UAAU,MAAM,EAAE;AAC/C,aAAO,MAAM,CAAC,IAAI,GAAG,GAAG,GAAG,MAAM,CAAC,KAAK,CAAA;KACxC,CAAC,CAAA;;AAEF,QAAI,OAAO,CAAC,MAAM,EAAE;AAClB,UAAI,CAAC,UAAU,CAAC,MAAM,GAAG,OAAO,CAAC,IAAI,CAAC,IAAI,CAAC,CAAA;KAC5C;GACF;;;AAGD,UAAQ,IAAI,CAAC,QAAQ,CAAC,QAAQ;AAC5B,SAAK,iBAAiB,CAAC;AACvB,SAAK,mBAAmB,CAAC;AACzB,SAAK,qBAAqB,CAAC;AAC3B,SAAK,uBAAuB;;AAE1B,UAAI,CAAC,QAAQ,CAAC,QAAQ,GAAG,qBAAqB,CAAA;AAC9C,YAAK;;AAAA,AAEP,SAAK,mCAAmC;AACtC,UAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,MAAM,EAAE;AACzB,YAAI,CAAC,QAAQ,CAAC,IAAI,GAAG,EAAE,CAAA;OACxB,MAAM;AACL,YAAI,CAAC,QAAQ,CAAC,SAAS,GAAG,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,MAAM,CAAC,IAAI,CAAC,OAAO,EAAE,EAAE,CAAC,CAAA;;;AAGvE,YAAI,CAAC,QAAQ,CAAC,IAAI,GAAG,EAAE,CAAC,SAAS,CAAC,IAAI,CAAC,QAAQ,CAAC,SAAS,CAAC,CAAA;OAC3D;AACD,YAAK;;AAAA,AAEP,SAAK,WAAW,CAAC;AACjB,SAAK,aAAa,CAAC;AACnB,SAAK,kBAAkB,CAAC;AACxB,SAAK,oBAAoB;AACvB,UAAI,CAAC,QAAQ,CAAC,QAAQ,GAAG,kBAAkB,CAAA;;AAE3C,UAAI,IAAI,CAAC,QAAQ,CAAC,IAAI,EAAE;AACtB,YAAI;AACF,cAAI,CAAC,QAAQ,CAAC,OAAO,GAAG,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAA;SACvD,CAAC,OAAO,CAAC,EAAE;AACV,cAAI,CAAC,OAAO,CAAC,KAAK,CAAC,CAAC,CAAC,CAAA;;;AAGrB,cAAI,CAAC,QAAQ,CAAC,QAAQ,GAAG,YAAY,CAAA;SACtC;OACF;AACD,YAAK;AAAA,GACR;;AAED,SAAO,IAAI,CAAA;CACZ,CAAA;;AAED,GAAG,CAAC,SAAS,CAAC,OAAO,GAAG,UAAU,OAAO,EAAE;;AAEzC,MAAI,CAAC,OAAO,CAAC,GAAG,EAAE;AAChB,WAAO,OAAO,CAAA;GACf;;AAED,MAAI,GAAG,GAAG,IAAI,CAAC,OAAO,CAAC,EAAE,EAAE,OAAO,CAAC,GAAG,CAAC,CAAA;;;AAGvC,MAAI,GAAG,CAAC,GAAG,IAAI,GAAG,CAAC,GAAG,CAAC,OAAO,EAAE;AAC9B,OAAG,GAAG,GAAG,CAAC,GAAG,CAAC,OAAO,CAAC,CAAC,CAAC,CAAA;GACzB;;;AAGD,KAAG,CAAC,GAAG,GAAG,GAAG,CAAC,GAAG,IAAI,OAAO,CAAC,GAAG,IAAI,OAAO,CAAC,GAAG,IAAI,OAAO,CAAC,OAAO,IAAI,GAAG,CAAA;AACzE,KAAG,CAAC,WAAW,GAAG,GAAG,CAAC,WAAW,IAAI,UAAU,CAAA;AAC/C,KAAG,CAAC,WAAW,GAAG,GAAG,CAAC,WAAW,IAAI,EAAE,CAAA;AACvC,KAAG,CAAC,OAAO,GAAG,GAAG,CAAC,OAAO,IAAI,EAAE,CAAA;AAC/B,KAAG,CAAC,OAAO,GAAG,GAAG,CAAC,OAAO,IAAI,EAAE,CAAA;AAC/B,KAAG,CAAC,QAAQ,GAAG,GAAG,CAAC,QAAQ,IAAI,EAAE,CAAA;AACjC,KAAG,CAAC,QAAQ,CAAC,QAAQ,GAAG,GAAG,CAAC,QAAQ,CAAC,QAAQ,IAAI,0BAA0B,CAAA;;AAE3E,KAAG,CAAC,QAAQ,GAAG,CAAC,CAAA;AAChB,KAAG,CAAC,WAAW,GAAG,CAAC,CAAA;AACnB,KAAG,CAAC,QAAQ,CAAC,IAAI,GAAG,CAAC,CAAA;;AAErB,MAAI,CAAC,QAAQ,CAAC,OAAO,CAAC,GAAG,CAAC,EAAE;AAC1B,WAAO,OAAO,CAAA;GACf;;;AAGD,MAAI,GAAG,GAAG,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,CAAA;;;AAGxB,MAAI,GAAG,CAAC,GAAG,EAAE;AACX,WAAO,CAAC,GAAG,GAAG,GAAG,CAAC,GAAG,CAAA;GACtB;;AAED,MAAI,GAAG,CAAC,MAAM,EAAE;AACd,WAAO,CAAC,MAAM,GAAG,GAAG,CAAC,MAAM,CAAA;GAC5B;;AAED,MAAI,MAAM,CAAC,IAAI,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAC,MAAM,EAAE;AACpC,WAAO,CAAC,EAAE,GAAG,GAAG,CAAC,QAAQ,CAAA;GAC1B;;AAED,MAAI,MAAM,CAAC,IAAI,CAAC,GAAG,CAAC,UAAU,CAAC,CAAC,MAAM,EAAE;AACtC,WAAO,CAAC,OAAO,GAAG,GAAG,CAAC,UAAU,CAAA;GACjC;;AAED,UAAQ,GAAG,CAAC,QAAQ,CAAC,QAAQ;AAC3B,SAAK,mCAAmC;AACtC,aAAO,CAAC,IAAI,GAAG,GAAG,CAAC,QAAQ,CAAC,SAAS,CAAA;AACrC,YAAK;;AAAA,AAEP,SAAK,kBAAkB;AACrB,UAAI,GAAG,CAAC,QAAQ,CAAC,OAAO,EAAE;AACxB,eAAO,CAAC,IAAI,GAAG,GAAG,CAAC,QAAQ,CAAC,OAAO,CAAA;AACnC,eAAO,CAAC,IAAI,GAAG,IAAI,CAAA;OACpB;AACD,YAAK;;AAAA,AAEP,SAAK,qBAAqB;AACxB,aAAO,CAAC,QAAQ,GAAG,EAAE,CAAA;;AAErB,SAAG,CAAC,QAAQ,CAAC,MAAM,CAAC,OAAO,CAAC,UAAU,KAAK,EAAE;AAC3C,YAAI,UAAU,GAAG,EAAE,CAAA;;AAEnB,YAAI,CAAC,KAAK,CAAC,QAAQ,IAAI,CAAC,KAAK,CAAC,QAAQ,IAAI,CAAC,KAAK,CAAC,WAAW,EAAE;AAC5D,iBAAO,CAAC,QAAQ,CAAC,KAAK,CAAC,IAAI,CAAC,GAAG,KAAK,CAAC,KAAK,CAAA;AAC1C,iBAAM;SACP;;;AAGD,YAAI,KAAK,CAAC,QAAQ,IAAI,CAAC,KAAK,CAAC,KAAK,EAAE;AAClC,oBAAU,CAAC,KAAK,GAAG,EAAE,CAAC,gBAAgB,CAAC,KAAK,CAAC,QAAQ,CAAC,CAAA;SACvD,MAAM,IAAI,KAAK,CAAC,KAAK,EAAE;AACtB,oBAAU,CAAC,KAAK,GAAG,KAAK,CAAC,KAAK,CAAA;SAC/B;;AAED,YAAI,KAAK,CAAC,QAAQ,EAAE;AAClB,oBAAU,CAAC,OAAO,GAAG;AACnB,oBAAQ,EAAE,KAAK,CAAC,QAAQ;AACxB,uBAAW,EAAE,KAAK,CAAC,WAAW,GAAG,KAAK,CAAC,WAAW,GAAG,IAAI;WAC1D,CAAA;SACF;;AAED,eAAO,CAAC,QAAQ,CAAC,KAAK,CAAC,IAAI,CAAC,GAAG,UAAU,CAAA;OAC1C,CAAC,CAAA;AACF,YAAK;;AAAA,AAEP;AACE,UAAI,GAAG,CAAC,QAAQ,CAAC,IAAI,EAAE;AACrB,eAAO,CAAC,IAAI,GAAG,GAAG,CAAC,QAAQ,CAAC,IAAI,CAAA;OACjC;AAAA,GACJ;;AAED,SAAO,OAAO,CAAA;CACf,CAAA;;AAED,OAAO,CAAC,GAAG,GAAG,GAAG,CAAA","file":"har-compiled.js","sourcesContent":["'use strict'\n\nvar fs = require('fs')\nvar qs = require('querystring')\nvar validate = require('har-validator')\nvar util = require('util')\n\nfunction Har (request) {\n  this.request = request\n}\n\nHar.prototype.reducer = function (obj, pair) {\n  // new property ?\n  if (obj[pair.name] === undefined) {\n    obj[pair.name] = pair.value\n    return obj\n  }\n\n  // existing? convert to array\n  var arr = [\n    obj[pair.name],\n    pair.value\n  ]\n\n  obj[pair.name] = arr\n\n  return obj\n}\n\nHar.prototype.prep = function (data) {\n  // construct utility properties\n  data.queryObj = {}\n  data.headersObj = {}\n  data.postData.jsonObj = false\n  data.postData.paramsObj = false\n\n  // construct query objects\n  if (data.queryString && data.queryString.length) {\n    data.queryObj = data.queryString.reduce(this.reducer, {})\n  }\n\n  // construct headers objects\n  if (data.headers && data.headers.length) {\n    // loweCase header keys\n    data.headersObj = data.headers.reduceRight(function (headers, header) {\n      headers[header.name] = header.value\n      return headers\n    }, {})\n  }\n\n  // construct Cookie header\n  if (data.cookies && data.cookies.length) {\n    var cookies = data.cookies.map(function (cookie) {\n      return cookie.name + '=' + cookie.value\n    })\n\n    if (cookies.length) {\n      data.headersObj.cookie = cookies.join('; ')\n    }\n  }\n\n  // prep body\n  switch (data.postData.mimeType) {\n    case 'multipart/mixed':\n    case 'multipart/related':\n    case 'multipart/form-data':\n    case 'multipart/alternative':\n      // reset values\n      data.postData.mimeType = 'multipart/form-data'\n      break\n\n    case 'application/x-www-form-urlencoded':\n      if (!data.postData.params) {\n        data.postData.text = ''\n      } else {\n        data.postData.paramsObj = data.postData.params.reduce(this.reducer, {})\n\n        // always overwrite\n        data.postData.text = qs.stringify(data.postData.paramsObj)\n      }\n      break\n\n    case 'text/json':\n    case 'text/x-json':\n    case 'application/json':\n    case 'application/x-json':\n      data.postData.mimeType = 'application/json'\n\n      if (data.postData.text) {\n        try {\n          data.postData.jsonObj = JSON.parse(data.postData.text)\n        } catch (e) {\n          this.request.debug(e)\n\n          // force back to text/plain\n          data.postData.mimeType = 'text/plain'\n        }\n      }\n      break\n  }\n\n  return data\n}\n\nHar.prototype.options = function (options) {\n  // skip if no har property defined\n  if (!options.har) {\n    return options\n  }\n\n  var har = util._extend({}, options.har)\n\n  // only process the first entry\n  if (har.log && har.log.entries) {\n    har = har.log.entries[0]\n  }\n\n  // add optional properties to make validation successful\n  har.url = har.url || options.url || options.uri || options.baseUrl || '/'\n  har.httpVersion = har.httpVersion || 'HTTP/1.1'\n  har.queryString = har.queryString || []\n  har.headers = har.headers || []\n  har.cookies = har.cookies || []\n  har.postData = har.postData || {}\n  har.postData.mimeType = har.postData.mimeType || 'application/octet-stream'\n\n  har.bodySize = 0\n  har.headersSize = 0\n  har.postData.size = 0\n\n  if (!validate.request(har)) {\n    return options\n  }\n\n  // clean up and get some utility properties\n  var req = this.prep(har)\n\n  // construct new options\n  if (req.url) {\n    options.url = req.url\n  }\n\n  if (req.method) {\n    options.method = req.method\n  }\n\n  if (Object.keys(req.queryObj).length) {\n    options.qs = req.queryObj\n  }\n\n  if (Object.keys(req.headersObj).length) {\n    options.headers = req.headersObj\n  }\n\n  switch (req.postData.mimeType) {\n    case 'application/x-www-form-urlencoded':\n      options.form = req.postData.paramsObj\n      break\n\n    case 'application/json':\n      if (req.postData.jsonObj) {\n        options.body = req.postData.jsonObj\n        options.json = true\n      }\n      break\n\n    case 'multipart/form-data':\n      options.formData = {}\n\n      req.postData.params.forEach(function (param) {\n        var attachment = {}\n\n        if (!param.fileName && !param.fileName && !param.contentType) {\n          options.formData[param.name] = param.value\n          return\n        }\n\n        // attempt to read from disk!\n        if (param.fileName && !param.value) {\n          attachment.value = fs.createReadStream(param.fileName)\n        } else if (param.value) {\n          attachment.value = param.value\n        }\n\n        if (param.fileName) {\n          attachment.options = {\n            filename: param.fileName,\n            contentType: param.contentType ? param.contentType : null\n          }\n        }\n\n        options.formData[param.name] = attachment\n      })\n      break\n\n    default:\n      if (req.postData.text) {\n        options.body = req.postData.text\n      }\n  }\n\n  return options\n}\n\nexports.Har = Har\n"]}