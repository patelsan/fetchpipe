{"version":3,"sources":["finally.js"],"names":[],"mappings":"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","file":"finally-compiled.js","sourcesContent":["\"use strict\";\nmodule.exports = function(Promise, NEXT_FILTER, tryConvertToPromise) {\nvar util = require(\"./util.js\");\nvar isPrimitive = util.isPrimitive;\nvar thrower = util.thrower;\n\nfunction returnThis() {\n    return this;\n}\nfunction throwThis() {\n    throw this;\n}\nfunction return$(r) {\n    return function() {\n        return r;\n    };\n}\nfunction throw$(r) {\n    return function() {\n        throw r;\n    };\n}\nfunction promisedFinally(ret, reasonOrValue, isFulfilled) {\n    var then;\n    if (isPrimitive(reasonOrValue)) {\n        then = isFulfilled ? return$(reasonOrValue) : throw$(reasonOrValue);\n    } else {\n        then = isFulfilled ? returnThis : throwThis;\n    }\n    return ret._then(then, thrower, undefined, reasonOrValue, undefined);\n}\n\nfunction finallyHandler(reasonOrValue) {\n    var promise = this.promise;\n    var handler = this.handler;\n\n    var ret = promise._isBound()\n                    ? handler.call(promise._boundValue())\n                    : handler();\n\n    if (ret !== undefined) {\n        var maybePromise = tryConvertToPromise(ret, promise);\n        if (maybePromise instanceof Promise) {\n            maybePromise = maybePromise._target();\n            return promisedFinally(maybePromise, reasonOrValue,\n                                    promise.isFulfilled());\n        }\n    }\n\n    if (promise.isRejected()) {\n        NEXT_FILTER.e = reasonOrValue;\n        return NEXT_FILTER;\n    } else {\n        return reasonOrValue;\n    }\n}\n\nfunction tapHandler(value) {\n    var promise = this.promise;\n    var handler = this.handler;\n\n    var ret = promise._isBound()\n                    ? handler.call(promise._boundValue(), value)\n                    : handler(value);\n\n    if (ret !== undefined) {\n        var maybePromise = tryConvertToPromise(ret, promise);\n        if (maybePromise instanceof Promise) {\n            maybePromise = maybePromise._target();\n            return promisedFinally(maybePromise, value, true);\n        }\n    }\n    return value;\n}\n\nPromise.prototype._passThroughHandler = function (handler, isFinally) {\n    if (typeof handler !== \"function\") return this.then();\n\n    var promiseAndHandler = {\n        promise: this,\n        handler: handler\n    };\n\n    return this._then(\n            isFinally ? finallyHandler : tapHandler,\n            isFinally ? finallyHandler : undefined, undefined,\n            promiseAndHandler, undefined);\n};\n\nPromise.prototype.lastly =\nPromise.prototype[\"finally\"] = function (handler) {\n    return this._passThroughHandler(handler, true);\n};\n\nPromise.prototype.tap = function (handler) {\n    return this._passThroughHandler(handler, false);\n};\n};\n"]}