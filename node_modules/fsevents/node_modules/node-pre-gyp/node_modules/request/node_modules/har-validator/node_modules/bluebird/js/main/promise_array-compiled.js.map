{"version":3,"sources":["promise_array.js"],"names":[],"mappings":"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","file":"promise_array-compiled.js","sourcesContent":["\"use strict\";\nmodule.exports = function(Promise, INTERNAL, tryConvertToPromise,\n    apiRejection) {\nvar util = require(\"./util.js\");\nvar isArray = util.isArray;\n\nfunction toResolutionValue(val) {\n    switch(val) {\n    case -2: return [];\n    case -3: return {};\n    }\n}\n\nfunction PromiseArray(values) {\n    var promise = this._promise = new Promise(INTERNAL);\n    var parent;\n    if (values instanceof Promise) {\n        parent = values;\n        promise._propagateFrom(parent, 1 | 4);\n    }\n    this._values = values;\n    this._length = 0;\n    this._totalResolved = 0;\n    this._init(undefined, -2);\n}\nPromiseArray.prototype.length = function () {\n    return this._length;\n};\n\nPromiseArray.prototype.promise = function () {\n    return this._promise;\n};\n\nPromiseArray.prototype._init = function init(_, resolveValueIfEmpty) {\n    var values = tryConvertToPromise(this._values, this._promise);\n    if (values instanceof Promise) {\n        values = values._target();\n        this._values = values;\n        if (values._isFulfilled()) {\n            values = values._value();\n            if (!isArray(values)) {\n                var err = new Promise.TypeError(\"expecting an array, a promise or a thenable\\u000a\\u000a    See http://goo.gl/s8MMhc\\u000a\");\n                this.__hardReject__(err);\n                return;\n            }\n        } else if (values._isPending()) {\n            values._then(\n                init,\n                this._reject,\n                undefined,\n                this,\n                resolveValueIfEmpty\n           );\n            return;\n        } else {\n            this._reject(values._reason());\n            return;\n        }\n    } else if (!isArray(values)) {\n        this._promise._reject(apiRejection(\"expecting an array, a promise or a thenable\\u000a\\u000a    See http://goo.gl/s8MMhc\\u000a\")._reason());\n        return;\n    }\n\n    if (values.length === 0) {\n        if (resolveValueIfEmpty === -5) {\n            this._resolveEmptyArray();\n        }\n        else {\n            this._resolve(toResolutionValue(resolveValueIfEmpty));\n        }\n        return;\n    }\n    var len = this.getActualLength(values.length);\n    this._length = len;\n    this._values = this.shouldCopyValues() ? new Array(len) : this._values;\n    var promise = this._promise;\n    for (var i = 0; i < len; ++i) {\n        var isResolved = this._isResolved();\n        var maybePromise = tryConvertToPromise(values[i], promise);\n        if (maybePromise instanceof Promise) {\n            maybePromise = maybePromise._target();\n            if (isResolved) {\n                maybePromise._ignoreRejections();\n            } else if (maybePromise._isPending()) {\n                maybePromise._proxyPromiseArray(this, i);\n            } else if (maybePromise._isFulfilled()) {\n                this._promiseFulfilled(maybePromise._value(), i);\n            } else {\n                this._promiseRejected(maybePromise._reason(), i);\n            }\n        } else if (!isResolved) {\n            this._promiseFulfilled(maybePromise, i);\n        }\n    }\n};\n\nPromiseArray.prototype._isResolved = function () {\n    return this._values === null;\n};\n\nPromiseArray.prototype._resolve = function (value) {\n    this._values = null;\n    this._promise._fulfill(value);\n};\n\nPromiseArray.prototype.__hardReject__ =\nPromiseArray.prototype._reject = function (reason) {\n    this._values = null;\n    this._promise._rejectCallback(reason, false, true);\n};\n\nPromiseArray.prototype._promiseProgressed = function (progressValue, index) {\n    this._promise._progress({\n        index: index,\n        value: progressValue\n    });\n};\n\n\nPromiseArray.prototype._promiseFulfilled = function (value, index) {\n    this._values[index] = value;\n    var totalResolved = ++this._totalResolved;\n    if (totalResolved >= this._length) {\n        this._resolve(this._values);\n    }\n};\n\nPromiseArray.prototype._promiseRejected = function (reason, index) {\n    this._totalResolved++;\n    this._reject(reason);\n};\n\nPromiseArray.prototype.shouldCopyValues = function () {\n    return true;\n};\n\nPromiseArray.prototype.getActualLength = function (len) {\n    return len;\n};\n\nreturn PromiseArray;\n};\n"]}