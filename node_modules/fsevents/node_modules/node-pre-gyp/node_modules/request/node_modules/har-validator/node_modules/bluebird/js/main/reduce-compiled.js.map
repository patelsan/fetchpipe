{"version":3,"sources":["reduce.js"],"names":[],"mappings":"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","file":"reduce-compiled.js","sourcesContent":["\"use strict\";\nmodule.exports = function(Promise,\n                          PromiseArray,\n                          apiRejection,\n                          tryConvertToPromise,\n                          INTERNAL) {\nvar getDomain = Promise._getDomain;\nvar async = require(\"./async.js\");\nvar util = require(\"./util.js\");\nvar tryCatch = util.tryCatch;\nvar errorObj = util.errorObj;\nfunction ReductionPromiseArray(promises, fn, accum, _each) {\n    this.constructor$(promises);\n    this._promise._captureStackTrace();\n    this._preservedValues = _each === INTERNAL ? [] : null;\n    this._zerothIsAccum = (accum === undefined);\n    this._gotAccum = false;\n    this._reducingIndex = (this._zerothIsAccum ? 1 : 0);\n    this._valuesPhase = undefined;\n    var maybePromise = tryConvertToPromise(accum, this._promise);\n    var rejected = false;\n    var isPromise = maybePromise instanceof Promise;\n    if (isPromise) {\n        maybePromise = maybePromise._target();\n        if (maybePromise._isPending()) {\n            maybePromise._proxyPromiseArray(this, -1);\n        } else if (maybePromise._isFulfilled()) {\n            accum = maybePromise._value();\n            this._gotAccum = true;\n        } else {\n            this._reject(maybePromise._reason());\n            rejected = true;\n        }\n    }\n    if (!(isPromise || this._zerothIsAccum)) this._gotAccum = true;\n    var domain = getDomain();\n    this._callback = domain === null ? fn : domain.bind(fn);\n    this._accum = accum;\n    if (!rejected) async.invoke(init, this, undefined);\n}\nfunction init() {\n    this._init$(undefined, -5);\n}\nutil.inherits(ReductionPromiseArray, PromiseArray);\n\nReductionPromiseArray.prototype._init = function () {};\n\nReductionPromiseArray.prototype._resolveEmptyArray = function () {\n    if (this._gotAccum || this._zerothIsAccum) {\n        this._resolve(this._preservedValues !== null\n                        ? [] : this._accum);\n    }\n};\n\nReductionPromiseArray.prototype._promiseFulfilled = function (value, index) {\n    var values = this._values;\n    values[index] = value;\n    var length = this.length();\n    var preservedValues = this._preservedValues;\n    var isEach = preservedValues !== null;\n    var gotAccum = this._gotAccum;\n    var valuesPhase = this._valuesPhase;\n    var valuesPhaseIndex;\n    if (!valuesPhase) {\n        valuesPhase = this._valuesPhase = new Array(length);\n        for (valuesPhaseIndex=0; valuesPhaseIndex<length; ++valuesPhaseIndex) {\n            valuesPhase[valuesPhaseIndex] = 0;\n        }\n    }\n    valuesPhaseIndex = valuesPhase[index];\n\n    if (index === 0 && this._zerothIsAccum) {\n        this._accum = value;\n        this._gotAccum = gotAccum = true;\n        valuesPhase[index] = ((valuesPhaseIndex === 0)\n            ? 1 : 2);\n    } else if (index === -1) {\n        this._accum = value;\n        this._gotAccum = gotAccum = true;\n    } else {\n        if (valuesPhaseIndex === 0) {\n            valuesPhase[index] = 1;\n        } else {\n            valuesPhase[index] = 2;\n            this._accum = value;\n        }\n    }\n    if (!gotAccum) return;\n\n    var callback = this._callback;\n    var receiver = this._promise._boundValue();\n    var ret;\n\n    for (var i = this._reducingIndex; i < length; ++i) {\n        valuesPhaseIndex = valuesPhase[i];\n        if (valuesPhaseIndex === 2) {\n            this._reducingIndex = i + 1;\n            continue;\n        }\n        if (valuesPhaseIndex !== 1) return;\n        value = values[i];\n        this._promise._pushContext();\n        if (isEach) {\n            preservedValues.push(value);\n            ret = tryCatch(callback).call(receiver, value, i, length);\n        }\n        else {\n            ret = tryCatch(callback)\n                .call(receiver, this._accum, value, i, length);\n        }\n        this._promise._popContext();\n\n        if (ret === errorObj) return this._reject(ret.e);\n\n        var maybePromise = tryConvertToPromise(ret, this._promise);\n        if (maybePromise instanceof Promise) {\n            maybePromise = maybePromise._target();\n            if (maybePromise._isPending()) {\n                valuesPhase[i] = 4;\n                return maybePromise._proxyPromiseArray(this, i);\n            } else if (maybePromise._isFulfilled()) {\n                ret = maybePromise._value();\n            } else {\n                return this._reject(maybePromise._reason());\n            }\n        }\n\n        this._reducingIndex = i + 1;\n        this._accum = ret;\n    }\n\n    this._resolve(isEach ? preservedValues : this._accum);\n};\n\nfunction reduce(promises, fn, initialValue, _each) {\n    if (typeof fn !== \"function\") return apiRejection(\"fn must be a function\\u000a\\u000a    See http://goo.gl/916lJJ\\u000a\");\n    var array = new ReductionPromiseArray(promises, fn, initialValue, _each);\n    return array.promise();\n}\n\nPromise.prototype.reduce = function (fn, initialValue) {\n    return reduce(this, fn, initialValue, null);\n};\n\nPromise.reduce = function (promises, fn, initialValue, _each) {\n    return reduce(promises, fn, initialValue, _each);\n};\n};\n"]}