{"version":3,"sources":["file-writer.js"],"names":[],"mappings":";;AAAA,MAAM,CAAC,OAAO,GAAG,UAAU,CAAA;;AAE3B,IAAI,EAAE,GAAG,OAAO,CAAC,aAAa,CAAC;IAC3B,KAAK,GAAG,OAAO,CAAC,QAAQ,CAAC;IACzB,MAAM,GAAG,OAAO,CAAC,aAAa,CAAC;IAC/B,QAAQ,GAAG,OAAO,CAAC,UAAU,CAAC;IAC9B,GAAG,GAAG,EAAE,CAAA;;AAEZ,QAAQ,CAAC,UAAU,EAAE,MAAM,CAAC,CAAA;;AAE5B,SAAS,UAAU,CAAE,KAAK,EAAE;AAC1B,MAAI,EAAE,GAAG,IAAI,CAAA;AACb,MAAI,EAAE,EAAE,YAAY,UAAU,CAAA,AAAC,EAAE,MAAM,IAAI,KAAK,CAC9C,2CAA2C,CAAC,CAAA;;;AAG9C,MAAI,KAAK,CAAC,IAAI,KAAK,MAAM,IAAI,CAAC,KAAK,CAAC,IAAI,EAAE;AACxC,UAAM,IAAI,KAAK,CAAC,gBAAgB,GAAE,KAAK,CAAC,IAAI,CAAC,CAAA;GAC9C;;AAED,IAAE,CAAC,OAAO,GAAG,EAAE,CAAA;AACf,IAAE,CAAC,aAAa,GAAG,CAAC,CAAA;;AAEpB,QAAM,CAAC,IAAI,CAAC,IAAI,EAAE,KAAK,CAAC,CAAA;CACzB;;AAED,UAAU,CAAC,SAAS,CAAC,OAAO,GAAG,YAAY;AACzC,MAAI,EAAE,GAAG,IAAI,CAAA;AACb,MAAI,EAAE,CAAC,OAAO,EAAE,OAAM;;AAEtB,MAAI,EAAE,GAAG,EAAE,CAAA;AACX,MAAI,EAAE,CAAC,KAAK,CAAC,KAAK,EAAE,EAAE,CAAC,KAAK,GAAG,EAAE,CAAC,KAAK,CAAC,KAAK,CAAA;AAC7C,IAAE,CAAC,IAAI,GAAG,MAAM,CAAC,QAAQ,CAAA;AACzB,MAAI,EAAE,CAAC,IAAI,IAAI,EAAE,CAAC,IAAI,CAAC,OAAO,EAAE,EAAE,CAAC,UAAU,GAAG,EAAE,CAAC,IAAI,CAAC,OAAO,CAAA;;AAE/D,IAAE,CAAC,OAAO,GAAG,EAAE,CAAC,iBAAiB,CAAC,EAAE,CAAC,KAAK,EAAE,EAAE,CAAC,CAAA;;AAE/C,IAAE,CAAC,OAAO,CAAC,EAAE,CAAC,MAAM,EAAE,UAAU,EAAE,EAAE;;AAElC,MAAE,CAAC,KAAK,GAAG,IAAI,CAAA;AACf,MAAE,CAAC,OAAO,CAAC,OAAO,CAAC,UAAU,CAAC,EAAE;AAC9B,UAAI,CAAC,KAAK,GAAG,EAAE,EAAE,CAAC,OAAO,CAAC,GAAG,EAAE,CAAA,KAC1B,EAAE,CAAC,OAAO,CAAC,KAAK,CAAC,CAAC,CAAC,CAAA;KACzB,CAAC,CAAA;AACF,MAAE,CAAC,IAAI,CAAC,OAAO,CAAC,CAAA;;AAEhB,MAAE,CAAC,IAAI,CAAC,OAAO,CAAC,CAAA;GACjB,CAAC,CAAA;;AAEF,IAAE,CAAC,OAAO,CAAC,EAAE,CAAC,OAAO,EAAE,YAAY;AAAE,MAAE,CAAC,IAAI,CAAC,OAAO,CAAC,CAAA;GAAE,CAAC,CAAA;;AAExD,IAAE,CAAC,OAAO,CAAC,EAAE,CAAC,OAAO,EAAE,YAAY;;AAEjC,MAAE,CAAC,OAAO,EAAE,CAAA;GACb,CAAC,CAAA;CACH,CAAA;;AAED,UAAU,CAAC,SAAS,CAAC,KAAK,GAAG,UAAU,CAAC,EAAE;AACxC,MAAI,EAAE,GAAG,IAAI,CAAA;;AAEb,IAAE,CAAC,aAAa,IAAI,CAAC,CAAC,MAAM,CAAA;;AAE5B,MAAI,CAAC,EAAE,CAAC,KAAK,EAAE;AACb,QAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,CAAC,CAAC,IAAI,OAAO,CAAC,KAAK,QAAQ,EAC9C,MAAM,IAAI,KAAK,CAAC,oBAAoB,CAAC,CAAA;AACvC,MAAE,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC,CAAC,CAAA;AAClB,WAAO,KAAK,CAAA;GACb;;AAED,MAAI,GAAG,GAAG,EAAE,CAAC,OAAO,CAAC,KAAK,CAAC,CAAC,CAAC,CAAA;;;;;AAK7B,MAAI,GAAG,KAAK,KAAK,IAAI,EAAE,CAAC,OAAO,CAAC,MAAM,EAAE;AACtC,WAAO,EAAE,CAAC,OAAO,CAAC,MAAM,CAAC,MAAM,IAAI,CAAC,CAAC;GACtC,MAAM;AACL,WAAO,GAAG,CAAC;GACZ;CACF,CAAA;;AAED,UAAU,CAAC,SAAS,CAAC,GAAG,GAAG,UAAU,CAAC,EAAE;AACtC,MAAI,EAAE,GAAG,IAAI,CAAA;;AAEb,MAAI,CAAC,EAAE,EAAE,CAAC,KAAK,CAAC,CAAC,CAAC,CAAA;;AAElB,MAAI,CAAC,EAAE,CAAC,KAAK,EAAE;AACb,MAAE,CAAC,OAAO,CAAC,IAAI,CAAC,GAAG,CAAC,CAAA;AACpB,WAAO,KAAK,CAAA;GACb;;AAED,SAAO,EAAE,CAAC,OAAO,CAAC,GAAG,EAAE,CAAA;CACxB,CAAA;;AAED,UAAU,CAAC,SAAS,CAAC,OAAO,GAAG,YAAY;AACzC,MAAI,EAAE,GAAG,IAAI,CAAA;AACb,MAAI,OAAO,EAAE,CAAC,IAAI,KAAK,QAAQ,IAAI,EAAE,CAAC,aAAa,IAAI,EAAE,CAAC,IAAI,EAAE;AAC9D,MAAE,CAAC,KAAK,CACN,oCAAoC,GACpC,UAAU,GAAG,EAAE,CAAC,IAAI,GAAG,IAAI,GAC3B,UAAU,GAAG,EAAE,CAAC,aAAa,CAAC,CAAA;GACjC;AACD,QAAM,CAAC,SAAS,CAAC,OAAO,CAAC,IAAI,CAAC,EAAE,CAAC,CAAA;CAClC,CAAA","file":"file-writer-compiled.js","sourcesContent":["module.exports = FileWriter\n\nvar fs = require(\"graceful-fs\")\n  , mkdir = require(\"mkdirp\")\n  , Writer = require(\"./writer.js\")\n  , inherits = require(\"inherits\")\n  , EOF = {}\n\ninherits(FileWriter, Writer)\n\nfunction FileWriter (props) {\n  var me = this\n  if (!(me instanceof FileWriter)) throw new Error(\n    \"FileWriter must be called as constructor.\")\n\n  // should already be established as a File type\n  if (props.type !== \"File\" || !props.File) {\n    throw new Error(\"Non-file type \"+ props.type)\n  }\n\n  me._buffer = []\n  me._bytesWritten = 0\n\n  Writer.call(this, props)\n}\n\nFileWriter.prototype._create = function () {\n  var me = this\n  if (me._stream) return\n\n  var so = {}\n  if (me.props.flags) so.flags = me.props.flags\n  so.mode = Writer.filemode\n  if (me._old && me._old.blksize) so.bufferSize = me._old.blksize\n\n  me._stream = fs.createWriteStream(me._path, so)\n\n  me._stream.on(\"open\", function (fd) {\n    // console.error(\"FW open\", me._buffer, me._path)\n    me.ready = true\n    me._buffer.forEach(function (c) {\n      if (c === EOF) me._stream.end()\n      else me._stream.write(c)\n    })\n    me.emit(\"ready\")\n    // give this a kick just in case it needs it.\n    me.emit(\"drain\")\n  })\n\n  me._stream.on(\"drain\", function () { me.emit(\"drain\") })\n\n  me._stream.on(\"close\", function () {\n    // console.error(\"\\n\\nFW Stream Close\", me._path, me.size)\n    me._finish()\n  })\n}\n\nFileWriter.prototype.write = function (c) {\n  var me = this\n\n  me._bytesWritten += c.length\n\n  if (!me.ready) {\n    if (!Buffer.isBuffer(c) && typeof c !== 'string')\n      throw new Error('invalid write data')\n    me._buffer.push(c)\n    return false\n  }\n\n  var ret = me._stream.write(c)\n  // console.error(\"\\t-- fw wrote, _stream says\", ret, me._stream._queue.length)\n\n  // allow 2 buffered writes, because otherwise there's just too\n  // much stop and go bs.\n  if (ret === false && me._stream._queue) {\n    return me._stream._queue.length <= 2;\n  } else {\n    return ret;\n  }\n}\n\nFileWriter.prototype.end = function (c) {\n  var me = this\n\n  if (c) me.write(c)\n\n  if (!me.ready) {\n    me._buffer.push(EOF)\n    return false\n  }\n\n  return me._stream.end()\n}\n\nFileWriter.prototype._finish = function () {\n  var me = this\n  if (typeof me.size === \"number\" && me._bytesWritten != me.size) {\n    me.error(\n      \"Did not get expected byte count.\\n\" +\n      \"expect: \" + me.size + \"\\n\" +\n      \"actual: \" + me._bytesWritten)\n  }\n  Writer.prototype._finish.call(me)\n}\n"]}