{"version":3,"sources":["proxy-reader.js"],"names":[],"mappings":"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","file":"proxy-reader-compiled.js","sourcesContent":["// A reader for when we don't yet know what kind of thing\n// the thing is.\n\nmodule.exports = ProxyReader\n\nvar Reader = require(\"./reader.js\")\n  , getType = require(\"./get-type.js\")\n  , inherits = require(\"inherits\")\n  , fs = require(\"graceful-fs\")\n\ninherits(ProxyReader, Reader)\n\nfunction ProxyReader (props) {\n  var me = this\n  if (!(me instanceof ProxyReader)) throw new Error(\n    \"ProxyReader must be called as constructor.\")\n\n  me.props = props\n  me._buffer = []\n  me.ready = false\n\n  Reader.call(me, props)\n}\n\nProxyReader.prototype._stat = function () {\n  var me = this\n    , props = me.props\n    // stat the thing to see what the proxy should be.\n    , stat = props.follow ? \"stat\" : \"lstat\"\n\n  fs[stat](props.path, function (er, current) {\n    var type\n    if (er || !current) {\n      type = \"File\"\n    } else {\n      type = getType(current)\n    }\n\n    props[type] = true\n    props.type = me.type = type\n\n    me._old = current\n    me._addProxy(Reader(props, current))\n  })\n}\n\nProxyReader.prototype._addProxy = function (proxy) {\n  var me = this\n  if (me._proxyTarget) {\n    return me.error(\"proxy already set\")\n  }\n\n  me._proxyTarget = proxy\n  proxy._proxy = me\n\n  ; [ \"error\"\n    , \"data\"\n    , \"end\"\n    , \"close\"\n    , \"linkpath\"\n    , \"entry\"\n    , \"entryEnd\"\n    , \"child\"\n    , \"childEnd\"\n    , \"warn\"\n    , \"stat\"\n    ].forEach(function (ev) {\n      // console.error(\"~~ proxy event\", ev, me.path)\n      proxy.on(ev, me.emit.bind(me, ev))\n    })\n\n  me.emit(\"proxy\", proxy)\n\n  proxy.on(\"ready\", function () {\n    // console.error(\"~~ proxy is ready!\", me.path)\n    me.ready = true\n    me.emit(\"ready\")\n  })\n\n  var calls = me._buffer\n  me._buffer.length = 0\n  calls.forEach(function (c) {\n    proxy[c[0]].apply(proxy, c[1])\n  })\n}\n\nProxyReader.prototype.pause = function () {\n  return this._proxyTarget ? this._proxyTarget.pause() : false\n}\n\nProxyReader.prototype.resume = function () {\n  return this._proxyTarget ? this._proxyTarget.resume() : false\n}\n"]}