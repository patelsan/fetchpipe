{"version":3,"sources":["graceful-fs.js"],"names":[],"mappings":"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","file":"graceful-fs-compiled.js","sourcesContent":["// Monkey-patching the fs module.\n// It's ugly, but there is simply no other way to do this.\nvar fs = module.exports = require('./fs.js')\n\nvar assert = require('assert')\n\n// fix up some busted stuff, mostly on windows and old nodes\nrequire('./polyfills.js')\n\nvar util = require('util')\n\nfunction noop () {}\n\nvar debug = noop\nif (util.debuglog)\n  debug = util.debuglog('gfs')\nelse if (/\\bgfs\\b/i.test(process.env.NODE_DEBUG || ''))\n  debug = function() {\n    var m = util.format.apply(util, arguments)\n    m = 'GFS: ' + m.split(/\\n/).join('\\nGFS: ')\n    console.error(m)\n  }\n\nif (/\\bgfs\\b/i.test(process.env.NODE_DEBUG || '')) {\n  process.on('exit', function() {\n    debug('fds', fds)\n    debug(queue)\n    assert.equal(queue.length, 0)\n  })\n}\n\n\nvar originalOpen = fs.open\nfs.open = open\n\nfunction open(path, flags, mode, cb) {\n  if (typeof mode === \"function\") cb = mode, mode = null\n  if (typeof cb !== \"function\") cb = noop\n  new OpenReq(path, flags, mode, cb)\n}\n\nfunction OpenReq(path, flags, mode, cb) {\n  this.path = path\n  this.flags = flags\n  this.mode = mode\n  this.cb = cb\n  Req.call(this)\n}\n\nutil.inherits(OpenReq, Req)\n\nOpenReq.prototype.process = function() {\n  originalOpen.call(fs, this.path, this.flags, this.mode, this.done)\n}\n\nvar fds = {}\nOpenReq.prototype.done = function(er, fd) {\n  debug('open done', er, fd)\n  if (fd)\n    fds['fd' + fd] = this.path\n  Req.prototype.done.call(this, er, fd)\n}\n\n\nvar originalReaddir = fs.readdir\nfs.readdir = readdir\n\nfunction readdir(path, cb) {\n  if (typeof cb !== \"function\") cb = noop\n  new ReaddirReq(path, cb)\n}\n\nfunction ReaddirReq(path, cb) {\n  this.path = path\n  this.cb = cb\n  Req.call(this)\n}\n\nutil.inherits(ReaddirReq, Req)\n\nReaddirReq.prototype.process = function() {\n  originalReaddir.call(fs, this.path, this.done)\n}\n\nReaddirReq.prototype.done = function(er, files) {\n  if (files && files.sort)\n    files = files.sort()\n  Req.prototype.done.call(this, er, files)\n  onclose()\n}\n\n\nvar originalClose = fs.close\nfs.close = close\n\nfunction close (fd, cb) {\n  debug('close', fd)\n  if (typeof cb !== \"function\") cb = noop\n  delete fds['fd' + fd]\n  originalClose.call(fs, fd, function(er) {\n    onclose()\n    cb(er)\n  })\n}\n\n\nvar originalCloseSync = fs.closeSync\nfs.closeSync = closeSync\n\nfunction closeSync (fd) {\n  try {\n    return originalCloseSync(fd)\n  } finally {\n    onclose()\n  }\n}\n\n\n// Req class\nfunction Req () {\n  // start processing\n  this.done = this.done.bind(this)\n  this.failures = 0\n  this.process()\n}\n\nReq.prototype.done = function (er, result) {\n  var tryAgain = false\n  if (er) {\n    var code = er.code\n    var tryAgain = code === \"EMFILE\" || code === \"ENFILE\"\n    if (process.platform === \"win32\")\n      tryAgain = tryAgain || code === \"OK\"\n  }\n\n  if (tryAgain) {\n    this.failures ++\n    enqueue(this)\n  } else {\n    var cb = this.cb\n    cb(er, result)\n  }\n}\n\nvar queue = []\n\nfunction enqueue(req) {\n  queue.push(req)\n  debug('enqueue %d %s', queue.length, req.constructor.name, req)\n}\n\nfunction onclose() {\n  var req = queue.shift()\n  if (req) {\n    debug('process', req.constructor.name, req)\n    req.process()\n  }\n}\n"]}