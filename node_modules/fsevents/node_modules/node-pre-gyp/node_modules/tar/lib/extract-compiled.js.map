{"version":3,"sources":["extract.js"],"names":[],"mappings":"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","file":"extract-compiled.js","sourcesContent":["// give it a tarball and a path, and it'll dump the contents\n\nmodule.exports = Extract\n\nvar tar = require(\"../tar.js\")\n  , fstream = require(\"fstream\")\n  , inherits = require(\"inherits\")\n  , path = require(\"path\")\n\nfunction Extract (opts) {\n  if (!(this instanceof Extract)) return new Extract(opts)\n  tar.Parse.apply(this)\n\n  if (typeof opts !== \"object\") {\n    opts = { path: opts }\n  }\n\n  // better to drop in cwd? seems more standard.\n  opts.path = opts.path || path.resolve(\"node-tar-extract\")\n  opts.type = \"Directory\"\n  opts.Directory = true\n\n  // similar to --strip or --strip-components\n  opts.strip = +opts.strip\n  if (!opts.strip || opts.strip <= 0) opts.strip = 0\n\n  this._fst = fstream.Writer(opts)\n\n  this.pause()\n  var me = this\n\n  // Hardlinks in tarballs are relative to the root\n  // of the tarball.  So, they need to be resolved against\n  // the target directory in order to be created properly.\n  me.on(\"entry\", function (entry) {\n    // if there's a \"strip\" argument, then strip off that many\n    // path components.\n    if (opts.strip) {\n      var p = entry.path.split(\"/\").slice(opts.strip).join(\"/\")\n      entry.path = entry.props.path = p\n      if (entry.linkpath) {\n        var lp = entry.linkpath.split(\"/\").slice(opts.strip).join(\"/\")\n        entry.linkpath = entry.props.linkpath = lp\n      }\n    }\n    if (entry.type === \"Link\") {\n      entry.linkpath = entry.props.linkpath =\n        path.join(opts.path, path.join(\"/\", entry.props.linkpath))\n    }\n\n    if (entry.type === \"SymbolicLink\") {\n      var dn = path.dirname(entry.path) || \"\"\n      var linkpath = entry.props.linkpath\n      var target = path.resolve(opts.path, dn, linkpath)\n      if (target.indexOf(opts.path) !== 0) {\n        linkpath = path.join(opts.path, path.join(\"/\", linkpath))\n      }\n      entry.linkpath = entry.props.linkpath = linkpath\n    }\n  })\n\n  this._fst.on(\"ready\", function () {\n    me.pipe(me._fst, { end: false })\n    me.resume()\n  })\n\n  this._fst.on('error', function(err) {\n    me.emit('error', err)\n  })\n\n  this._fst.on('drain', function() {\n    me.emit('drain')\n  })\n\n  // this._fst.on(\"end\", function () {\n  //   console.error(\"\\nEEEE Extract End\", me._fst.path)\n  // })\n\n  this._fst.on(\"close\", function () {\n    // console.error(\"\\nEEEE Extract End\", me._fst.path)\n    me.emit(\"finish\")\n    me.emit(\"end\")\n    me.emit(\"close\")\n  })\n}\n\ninherits(Extract, tar.Parse)\n\nExtract.prototype._streamEnd = function () {\n  var me = this\n  if (!me._ended || me._entry) me.error(\"unexpected eof\")\n  me._fst.end()\n  // my .end() is coming later.\n}\n"]}