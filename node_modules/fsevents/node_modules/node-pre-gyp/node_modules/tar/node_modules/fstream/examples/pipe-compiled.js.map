{"version":3,"sources":["pipe.js"],"names":[],"mappings":"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","file":"pipe-compiled.js","sourcesContent":["var fstream = require('../fstream.js')\nvar path = require('path')\n\nvar r = fstream.Reader({\n  path: path.dirname(__dirname),\n  filter: function () {\n    return !this.basename.match(/^\\./) &&\n      !this.basename.match(/^node_modules$/) &&\n      !this.basename.match(/^deep-copy$/)\n  }\n})\n\nvar w = fstream.Writer({\n  path: path.resolve(__dirname, 'deep-copy'),\n  type: 'Directory'\n})\n\nvar indent = ''\n\nr.on('entry', appears)\nr.on('ready', function () {\n  console.error('ready to begin!', r.path)\n})\n\nfunction appears (entry) {\n  console.error(indent + 'a %s appears!', entry.type, entry.basename, typeof entry.basename, entry)\n  if (foggy) {\n    console.error('FOGGY!')\n    var p = entry\n    do {\n      console.error(p.depth, p.path, p._paused)\n      p = p.parent\n    } while (p)\n\n    throw new Error('\\u001b[mshould not have entries while foggy')\n  }\n  indent += '\\t'\n  entry.on('data', missile(entry))\n  entry.on('end', runaway(entry))\n  entry.on('entry', appears)\n}\n\nvar foggy\nfunction missile (entry) {\n  function liftFog (who) {\n    if (!foggy) return\n    if (who) {\n      console.error('%s breaks the spell!', who && who.path)\n    } else {\n      console.error('the spell expires!')\n    }\n    console.error('\\u001b[mthe fog lifts!\\n')\n    clearTimeout(foggy)\n    foggy = null\n    if (entry._paused) entry.resume()\n  }\n\n  if (entry.type === 'Directory') {\n    var ended = false\n    entry.once('end', function () { ended = true })\n    return function (c) {\n      // throw in some pathological pause()/resume() behavior\n      // just for extra fun.\n      process.nextTick(function () {\n        if (!foggy && !ended) { // && Math.random() < 0.3) {\n          console.error(indent + '%s casts a spell', entry.basename)\n          console.error('\\na slowing fog comes over the battlefield...\\n\\u001b[32m')\n          entry.pause()\n          entry.once('resume', liftFog)\n          foggy = setTimeout(liftFog, 10)\n        }\n      })\n    }\n  }\n\n  return function (c) {\n    var e = Math.random() < 0.5\n    console.error(indent + '%s %s for %d damage!',\n      entry.basename,\n      e ? 'is struck' : 'fires a chunk',\n      c.length)\n  }\n}\n\nfunction runaway (entry) {\n  return function () {\n    var e = Math.random() < 0.5\n    console.error(indent + '%s %s',\n      entry.basename,\n      e ? 'turns to flee' : 'is vanquished!')\n    indent = indent.slice(0, -1)\n  }\n}\n\nw.on('entry', attacks)\n// w.on('ready', function () { attacks(w) })\nfunction attacks (entry) {\n  console.error(indent + '%s %s!', entry.basename,\n    entry.type === 'Directory' ? 'calls for backup' : 'attacks')\n  entry.on('entry', attacks)\n}\n\nvar ended = false\nr.on('end', function () {\n  if (foggy) clearTimeout(foggy)\n  console.error(\"\\u001b[mIT'S OVER!!\")\n  console.error('A WINNAR IS YOU!')\n\n  console.log('ok 1 A WINNAR IS YOU')\n  ended = true\n})\n\nprocess.on('exit', function () {\n  console.log((ended ? '' : 'not ') + 'ok 2 ended')\n  console.log('1..2')\n})\n\nr.pipe(w)\n"]}