{"version":3,"sources":["proxy-writer.js"],"names":[],"mappings":";;;;;;;;;AAOA,MAAM,CAAC,OAAO,GAAG,WAAW,CAAA;;AAE5B,IAAI,MAAM,GAAG,OAAO,CAAC,aAAa,CAAC,CAAA;AACnC,IAAI,OAAO,GAAG,OAAO,CAAC,eAAe,CAAC,CAAA;AACtC,IAAI,QAAQ,GAAG,OAAO,CAAC,UAAU,CAAC,CAAA;AAClC,IAAI,OAAO,GAAG,OAAO,CAAC,cAAc,CAAC,CAAA;AACrC,IAAI,EAAE,GAAG,OAAO,CAAC,IAAI,CAAC,CAAA;;AAEtB,QAAQ,CAAC,WAAW,EAAE,MAAM,CAAC,CAAA;;AAE7B,SAAS,WAAW,CAAE,KAAK,EAAE;AAC3B,MAAI,IAAI,GAAG,IAAI,CAAA;AACf,MAAI,EAAE,IAAI,YAAY,WAAW,CAAA,AAAC,EAAE;AAClC,UAAM,IAAI,KAAK,CAAC,4CAA4C,CAAC,CAAA;GAC9D;;AAED,MAAI,CAAC,KAAK,GAAG,KAAK,CAAA;AAClB,MAAI,CAAC,UAAU,GAAG,KAAK,CAAA;;AAEvB,QAAM,CAAC,IAAI,CAAC,IAAI,EAAE,KAAK,CAAC,CAAA;CACzB;;AAED,WAAW,CAAC,SAAS,CAAC,KAAK,GAAG,YAAY;AACxC,MAAI,IAAI,GAAG,IAAI,CAAA;AACf,MAAI,KAAK,GAAG,IAAI,CAAC,KAAK,CAAA;;AAEtB,MAAI,IAAI,GAAG,KAAK,CAAC,MAAM,GAAG,MAAM,GAAG,OAAO,CAAA;;AAE1C,IAAE,CAAC,IAAI,CAAC,CAAC,KAAK,CAAC,IAAI,EAAE,UAAU,EAAE,EAAE,OAAO,EAAE;AAC1C,QAAI,IAAI,CAAA;AACR,QAAI,EAAE,IAAI,CAAC,OAAO,EAAE;AAClB,UAAI,GAAG,MAAM,CAAA;KACd,MAAM;AACL,UAAI,GAAG,OAAO,CAAC,OAAO,CAAC,CAAA;KACxB;;AAED,SAAK,CAAC,IAAI,CAAC,GAAG,IAAI,CAAA;AAClB,SAAK,CAAC,IAAI,GAAG,IAAI,CAAC,IAAI,GAAG,IAAI,CAAA;;AAE7B,QAAI,CAAC,IAAI,GAAG,OAAO,CAAA;AACnB,QAAI,CAAC,SAAS,CAAC,MAAM,CAAC,KAAK,EAAE,OAAO,CAAC,CAAC,CAAA;GACvC,CAAC,CAAA;CACH,CAAA;;AAED,WAAW,CAAC,SAAS,CAAC,SAAS,GAAG,UAAU,KAAK,EAAE;;AAEjD,MAAI,IAAI,GAAG,IAAI,CAAA;AACf,MAAI,IAAI,CAAC,MAAM,EAAE;AACf,WAAO,IAAI,CAAC,KAAK,CAAC,mBAAmB,CAAC,CAAA;GACvC;;AAED,MAAI,CAAC,MAAM,GAAG,KAAK,CAClB,CACC,OAAO,EACP,OAAO,EACP,OAAO,EACP,MAAM,EACN,OAAO,EACP,MAAM,CACP,CAAC,OAAO,CAAC,UAAU,EAAE,EAAE;AACtB,SAAK,CAAC,EAAE,CAAC,EAAE,EAAE,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,EAAE,EAAE,CAAC,CAAC,CAAA;GACvC,CAAC,CAAA;;AAEF,MAAI,CAAC,IAAI,CAAC,OAAO,EAAE,KAAK,CAAC,CAAA;;AAEzB,MAAI,KAAK,GAAG,IAAI,CAAC,OAAO,CAAA;AACxB,OAAK,CAAC,OAAO,CAAC,UAAU,CAAC,EAAE;;AAEzB,SAAK,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC,KAAK,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAA;GAC/B,CAAC,CAAA;AACF,MAAI,CAAC,OAAO,CAAC,MAAM,GAAG,CAAC,CAAA;AACvB,MAAI,IAAI,CAAC,WAAW,EAAE,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,CAAA;CACzC,CAAA;;AAED,WAAW,CAAC,SAAS,CAAC,GAAG,GAAG,UAAU,KAAK,EAAE;;AAE3C,SAAO,CAAC,KAAK,CAAC,CAAA;;AAEd,MAAI,CAAC,IAAI,CAAC,MAAM,EAAE;AAChB,QAAI,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC,KAAK,EAAE,CAAC,KAAK,CAAC,CAAC,CAAC,CAAA;AACnC,QAAI,CAAC,UAAU,GAAG,IAAI,CAAA;AACtB,WAAO,KAAK,CAAA;GACb;AACD,SAAO,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,KAAK,CAAC,CAAA;CAC9B,CAAA;;AAED,WAAW,CAAC,SAAS,CAAC,KAAK,GAAG,UAAU,CAAC,EAAE;;AAEzC,MAAI,CAAC,IAAI,CAAC,MAAM,EAAE;AAChB,QAAI,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC,OAAO,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAA;AACjC,QAAI,CAAC,UAAU,GAAG,IAAI,CAAA;AACtB,WAAO,KAAK,CAAA;GACb;AACD,SAAO,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC,CAAC,CAAA;CAC5B,CAAA;;AAED,WAAW,CAAC,SAAS,CAAC,GAAG,GAAG,UAAU,CAAC,EAAE;;AAEvC,MAAI,CAAC,IAAI,CAAC,MAAM,EAAE;AAChB,QAAI,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC,KAAK,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAA;AAC/B,WAAO,KAAK,CAAA;GACb;AACD,SAAO,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,CAAC,CAAA;CAC1B,CAAA","file":"proxy-writer-compiled.js","sourcesContent":["// A writer for when we don't know what kind of thing\n// the thing is.  That is, it's not explicitly set,\n// so we're going to make it whatever the thing already\n// is, or \"File\"\n//\n// Until then, collect all events.\n\nmodule.exports = ProxyWriter\n\nvar Writer = require('./writer.js')\nvar getType = require('./get-type.js')\nvar inherits = require('inherits')\nvar collect = require('./collect.js')\nvar fs = require('fs')\n\ninherits(ProxyWriter, Writer)\n\nfunction ProxyWriter (props) {\n  var self = this\n  if (!(self instanceof ProxyWriter)) {\n    throw new Error('ProxyWriter must be called as constructor.')\n  }\n\n  self.props = props\n  self._needDrain = false\n\n  Writer.call(self, props)\n}\n\nProxyWriter.prototype._stat = function () {\n  var self = this\n  var props = self.props\n  // stat the thing to see what the proxy should be.\n  var stat = props.follow ? 'stat' : 'lstat'\n\n  fs[stat](props.path, function (er, current) {\n    var type\n    if (er || !current) {\n      type = 'File'\n    } else {\n      type = getType(current)\n    }\n\n    props[type] = true\n    props.type = self.type = type\n\n    self._old = current\n    self._addProxy(Writer(props, current))\n  })\n}\n\nProxyWriter.prototype._addProxy = function (proxy) {\n  // console.error(\"~~ set proxy\", this.path)\n  var self = this\n  if (self._proxy) {\n    return self.error('proxy already set')\n  }\n\n  self._proxy = proxy\n  ;[\n    'ready',\n    'error',\n    'close',\n    'pipe',\n    'drain',\n    'warn'\n  ].forEach(function (ev) {\n    proxy.on(ev, self.emit.bind(self, ev))\n  })\n\n  self.emit('proxy', proxy)\n\n  var calls = self._buffer\n  calls.forEach(function (c) {\n    // console.error(\"~~ ~~ proxy buffered call\", c[0], c[1])\n    proxy[c[0]].apply(proxy, c[1])\n  })\n  self._buffer.length = 0\n  if (self._needsDrain) self.emit('drain')\n}\n\nProxyWriter.prototype.add = function (entry) {\n  // console.error(\"~~ proxy add\")\n  collect(entry)\n\n  if (!this._proxy) {\n    this._buffer.push(['add', [entry]])\n    this._needDrain = true\n    return false\n  }\n  return this._proxy.add(entry)\n}\n\nProxyWriter.prototype.write = function (c) {\n  // console.error('~~ proxy write')\n  if (!this._proxy) {\n    this._buffer.push(['write', [c]])\n    this._needDrain = true\n    return false\n  }\n  return this._proxy.write(c)\n}\n\nProxyWriter.prototype.end = function (c) {\n  // console.error('~~ proxy end')\n  if (!this._proxy) {\n    this._buffer.push(['end', [c]])\n    return false\n  }\n  return this._proxy.end(c)\n}\n"]}