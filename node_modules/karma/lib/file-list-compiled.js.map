{"version":3,"sources":["file-list.js"],"names":[],"mappings":"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","file":"file-list-compiled.js","sourcesContent":["// File List\n// =========\n//\n// The List is an object for tracking all files that karma knows about\n// currently.\n\n// Dependencies\n// ------------\n\nrequire('core-js')\nvar from = require('core-js/library/fn/array/from')\nvar Promise = require('bluebird')\nvar mm = require('minimatch')\nvar Glob = require('glob').Glob\nvar fs = Promise.promisifyAll(require('fs'))\nvar pathLib = require('path')\n\nvar File = require('./file')\nvar Url = require('./url')\nvar helper = require('./helper')\nvar _ = helper._\nvar log = require('./logger').create('watcher')\n\n// Constants\n// ---------\n\nvar GLOB_OPTS = {\n  cwd: '/',\n  follow: true,\n  nodir: true,\n  sync: true\n}\n\n// Helper Functions\n// ----------------\n\nfunction byPath (a, b) {\n  if (a.path > b.path) return 1\n  if (a.path < b.path) return -1\n\n  return 0\n}\n\n// Constructor\n//\n// patterns      - Array\n// excludes      - Array\n// emitter       - EventEmitter\n// preprocess    - Function\n// batchInterval - Number\nvar List = function (patterns, excludes, emitter, preprocess, batchInterval) {\n  // Store options\n  this._patterns = patterns\n  this._excludes = excludes\n  this._emitter = emitter\n  this._preprocess = Promise.promisify(preprocess)\n  this._batchInterval = batchInterval\n\n  // The actual list of files\n  this.buckets = new Map()\n\n  // Internal tracker if we are refreshing.\n  // When a refresh is triggered this gets set\n  // to the promise that `this._refresh` returns.\n  // So we know we are refreshing when this promise\n  // is still pending, and we are done when it's either\n  // resolved or rejected.\n  this._refreshing = Promise.resolve()\n\n  var self = this\n\n  // Emit the `file_list_modified` event.\n  // This function is throttled to the value of `batchInterval`\n  // to avoid spamming the listener.\n  function emit () {\n    self._emitter.emit('file_list_modified', self.files)\n  }\n  var throttledEmit = _.throttle(emit, self._batchInterval, {leading: false})\n  self._emitModified = function (immediate) {\n    immediate ? emit() : throttledEmit()\n  }\n}\n\n// Private Interface\n// -----------------\n\n// Is the given path matched by any exclusion filter\n//\n// path - String\n//\n// Returns `undefined` if no match, otherwise the matching\n// pattern.\nList.prototype._isExcluded = function (path) {\n  return _.find(this._excludes, function (pattern) {\n    return mm(path, pattern)\n  })\n}\n\n// Find the matching include pattern for the given path.\n//\n// path - String\n//\n// Returns the match or `undefined` if none found.\nList.prototype._isIncluded = function (path) {\n  return _.find(this._patterns, function (pattern) {\n    return mm(path, pattern.pattern)\n  })\n}\n\n// Find the given path in the bucket corresponding\n// to the given pattern.\n//\n// path    - String\n// pattern - Object\n//\n// Returns a File or undefined\nList.prototype._findFile = function (path, pattern) {\n  if (!path || !pattern) return\n  if (!this.buckets.has(pattern.pattern)) return\n\n  return _.find(from(this.buckets.get(pattern.pattern)), function (file) {\n    return file.originalPath === path\n  })\n}\n\n// Is the given path already in the files list.\n//\n// path - String\n//\n// Returns a boolean.\nList.prototype._exists = function (path) {\n  var self = this\n\n  var patterns = this._patterns.filter(function (pattern) {\n    return mm(path, pattern.pattern)\n  })\n\n  return !!_.find(patterns, function (pattern) {\n    return self._findFile(path, pattern)\n  })\n}\n\n// Check if we are currently refreshing\nList.prototype._isRefreshing = function () {\n  return this._refreshing.isPending()\n}\n\n// Do the actual work of refreshing\nList.prototype._refresh = function () {\n  var self = this\n  var buckets = this.buckets\n\n  return Promise.all(this._patterns.map(function (patternObject) {\n    var pattern = patternObject.pattern\n\n    if (helper.isUrlAbsolute(pattern)) {\n      buckets.set(pattern, new Set([new Url(pattern)]))\n      return Promise.resolve()\n    }\n\n    var mg = new Glob(pathLib.normalize(pattern), GLOB_OPTS)\n    var files = mg.found\n    buckets.set(pattern, new Set())\n\n    if (_.isEmpty(files)) {\n      log.warn('Pattern \"%s\" does not match any file.', pattern)\n      return\n    }\n\n    return Promise.all(files.map(function (path) {\n      if (self._isExcluded(path)) {\n        log.debug('Excluded file \"%s\"', path)\n        return Promise.resolve()\n      }\n\n      var mtime = mg.statCache[path].mtime\n      var doNotCache = patternObject.nocache\n      var file = new File(path, mtime, doNotCache)\n\n      if (file.doNotCache) {\n        log.debug('Not preprocessing \"%s\" due to nocache')\n        return Promise.resolve(file)\n      }\n\n      return self._preprocess(file).then(function () {\n        return file\n      })\n    }))\n    .then(function (files) {\n      files = _.compact(files)\n\n      if (_.isEmpty(files)) {\n        log.warn('All files matched by \"%s\" were excluded.', pattern)\n      } else {\n        buckets.set(pattern, new Set(files))\n      }\n    })\n  }))\n  .cancellable()\n  .then(function () {\n    self.buckets = buckets\n    self._emitModified(true)\n    return self.files\n  })\n  .catch(Promise.CancellationError, function () {\n    // We were canceled so return the resolution of the new run\n    return self._refreshing\n  })\n}\n\n// Public Interface\n// ----------------\n\nObject.defineProperty(List.prototype, 'files', {\n  get: function () {\n    var self = this\n\n    var served = this._patterns.filter(function (pattern) {\n      return pattern.served\n    })\n    .map(function (p) {\n      return from(self.buckets.get(p.pattern) || []).sort(byPath)\n    })\n\n    var included = this._patterns.filter(function (pattern) {\n      return pattern.included\n    })\n    .map(function (p) {\n      return from(self.buckets.get(p.pattern) || []).sort(byPath)\n    })\n\n    var uniqFlat = function (list) {\n      return _.uniq(_.flatten(list), 'path')\n    }\n\n    return {\n      served: uniqFlat(served),\n      included: uniqFlat(included)\n    }\n  }\n})\n\n// Reglob all patterns to update the list.\n//\n// Returns a promise that is resolved when the refresh\n// is completed.\nList.prototype.refresh = function () {\n  if (this._isRefreshing()) {\n    this._refreshing.cancel()\n  }\n\n  this._refreshing = this._refresh()\n  return this._refreshing\n}\n\n// Set new patterns and excludes and update\n// the list accordingly\n//\n// patterns - Array, the new patterns.\n// excludes - Array, the new exclude patterns.\n//\n// Returns a promise that is resolved when the refresh\n// is completed.\nList.prototype.reload = function (patterns, excludes) {\n  this._patterns = patterns\n  this._excludes = excludes\n\n  // Wait until the current refresh is done and then do a\n  // refresh to ensure a refresh actually happens\n  return this.refresh()\n}\n\n// Add a new file from the list.\n// This is called by the watcher\n//\n// path - String, the path of the file to update.\n//\n// Returns a promise that is resolved when the update\n// is completed.\nList.prototype.addFile = function (path) {\n  var self = this\n\n  // Ensure we are not adding a file that should be excluded\n  var excluded = this._isExcluded(path)\n  if (excluded) {\n    log.debug('Add file \"%s\" ignored. Excluded by \"%s\".', path, excluded)\n\n    return Promise.resolve(this.files)\n  }\n\n  var pattern = this._isIncluded(path)\n\n  if (!pattern) {\n    log.debug('Add file \"%s\" ignored. Does not match any pattern.', path)\n    return Promise.resolve(this.files)\n  }\n\n  if (this._exists(path)) {\n    log.debug('Add file \"%s\" ignored. Already in the list.', path)\n    return Promise.resolve(this.files)\n  }\n\n  var file = new File(path)\n  this.buckets.get(pattern.pattern).add(file)\n\n  return Promise.all([\n    fs.statAsync(path),\n    this._refreshing\n  ]).spread(function (stat) {\n    file.mtime = stat.mtime\n    return self._preprocess(file)\n  })\n  .then(function () {\n    log.info('Added file \"%s\".', path)\n    self._emitModified()\n    return self.files\n  })\n}\n\n// Update the `mtime` of a file.\n// This is called by the watcher\n//\n// path - String, the path of the file to update.\n//\n// Returns a promise that is resolved when the update\n// is completed.\nList.prototype.changeFile = function (path) {\n  var self = this\n\n  var pattern = this._isIncluded(path)\n  var file = this._findFile(path, pattern)\n\n  if (!pattern || !file) {\n    log.debug('Changed file \"%s\" ignored. Does not match any file in the list.', path)\n    return Promise.resolve(this.files)\n  }\n\n  return Promise.all([\n    fs.statAsync(path),\n    this._refreshing\n  ]).spread(function (stat) {\n    if (stat.mtime <= file.mtime) throw new Promise.CancellationError()\n\n    file.mtime = stat.mtime\n    return self._preprocess(file)\n  })\n  .then(function () {\n    log.info('Changed file \"%s\".', path)\n    self._emitModified()\n    return self.files\n  })\n  .catch(Promise.CancellationError, function () {\n    return self.files\n  })\n}\n\n// Remove a file from the list.\n// This is called by the watcher\n//\n// path - String, the path of the file to update.\n//\n// Returns a promise that is resolved when the update\n// is completed.\nList.prototype.removeFile = function (path) {\n  var self = this\n\n  return Promise.try(function () {\n    var pattern = self._isIncluded(path)\n    var file = self._findFile(path, pattern)\n\n    if (!pattern || !file) {\n      log.debug('Removed file \"%s\" ignored. Does not match any file in the list.', path)\n      return self.files\n    }\n\n    self.buckets.get(pattern.pattern).delete(file)\n\n    log.info('Removed file \"%s\".', path)\n    self._emitModified()\n    return self.files\n  })\n}\n\n// Inject dependencies\nList.$inject = ['config.files', 'config.exclude', 'emitter', 'preprocess',\n  'config.autoWatchBatchDelay']\n\n// PUBLIC\nmodule.exports = List\n"]}