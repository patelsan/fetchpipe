{"version":3,"sources":["base.js"],"names":[],"mappings":"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","file":"base-compiled.js","sourcesContent":["var KarmaEventEmitter = require('../events').EventEmitter\nvar EventEmitter = require('events').EventEmitter\nvar Promise = require('bluebird')\n\nvar log = require('../logger').create('launcher')\n\nvar BEING_CAPTURED = 1\nvar CAPTURED = 2\nvar BEING_KILLED = 3\nvar FINISHED = 4\nvar RESTARTING = 5\nvar BEING_FORCE_KILLED = 6\n\n/**\n * Base launcher that any custom launcher extends.\n */\nvar BaseLauncher = function (id, emitter) {\n  if (this.start) {\n    return\n  }\n\n  // TODO(vojta): figure out how to do inheritance with DI\n  Object.keys(EventEmitter.prototype).forEach(function (method) {\n    this[method] = EventEmitter.prototype[method]\n  }, this)\n  KarmaEventEmitter.call(this)\n\n  this.id = id\n  this.state = null\n  this.error = null\n\n  var self = this\n  var killingPromise\n  var previousUrl\n\n  this.start = function (url) {\n    previousUrl = url\n\n    this.error = null\n    this.state = BEING_CAPTURED\n    this.emit('start', url + '?id=' + this.id)\n  }\n\n  this.kill = function () {\n    // Already killed, or being killed.\n    if (killingPromise) {\n      return killingPromise\n    }\n\n    killingPromise = this.emitAsync('kill').then(function () {\n      self.state = FINISHED\n    })\n\n    this.state = BEING_KILLED\n\n    return killingPromise\n  }\n\n  this.forceKill = function () {\n    this.kill()\n    this.state = BEING_FORCE_KILLED\n\n    return killingPromise\n  }\n\n  this.restart = function () {\n    if (this.state === BEING_FORCE_KILLED) {\n      return\n    }\n\n    if (!killingPromise) {\n      killingPromise = this.emitAsync('kill')\n    }\n\n    killingPromise.then(function () {\n      if (self.state === BEING_FORCE_KILLED) {\n        self.state = FINISHED\n      } else {\n        killingPromise = null\n        log.debug('Restarting %s', self.name)\n        self.start(previousUrl)\n      }\n    })\n\n    self.state = RESTARTING\n  }\n\n  this.markCaptured = function () {\n    if (this.state === BEING_CAPTURED) {\n      this.state = CAPTURED\n    }\n  }\n\n  this.isCaptured = function () {\n    return this.state === CAPTURED\n  }\n\n  this.toString = function () {\n    return this.name\n  }\n\n  this._done = function (error) {\n    killingPromise = killingPromise || Promise.resolve()\n\n    this.error = this.error || error\n    this.emit('done')\n\n    if (this.error && this.state !== BEING_FORCE_KILLED && this.state !== RESTARTING) {\n      emitter.emit('browser_process_failure', this)\n    }\n\n    this.state = FINISHED\n  }\n\n  this.STATE_BEING_CAPTURED = BEING_CAPTURED\n  this.STATE_CAPTURED = CAPTURED\n  this.STATE_BEING_KILLED = BEING_KILLED\n  this.STATE_FINISHED = FINISHED\n  this.STATE_RESTARTING = RESTARTING\n  this.STATE_BEING_FORCE_KILLED = BEING_FORCE_KILLED\n}\n\nBaseLauncher.decoratorFactory = function (id, emitter) {\n  return function (launcher) {\n    BaseLauncher.call(launcher, id, emitter)\n  }\n}\n\nmodule.exports = BaseLauncher\n"]}