{"version":3,"sources":["karma.js"],"names":[],"mappings":"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","file":"karma-compiled.js","sourcesContent":["/**\n * Karma middleware is responsible for serving:\n * - client.html (the entrypoint for capturing a browser)\n * - debug.html\n * - context.html (the execution context, loaded within an iframe)\n * - karma.js\n *\n * The main part is generating context.html, as it contains:\n * - generating mappings\n * - including <script> and <link> tags\n * - setting propert caching headers\n */\n\nvar path = require('path')\nvar util = require('util')\nvar url = require('url')\n\nvar urlparse = function (urlStr) {\n  var urlObj = url.parse(urlStr, true)\n  urlObj.query = urlObj.query || {}\n  return urlObj\n}\n\nvar common = require('./common')\n\nvar VERSION = require('../constants').VERSION\nvar SCRIPT_TAG = '<script type=\"%s\" src=\"%s\"></script>'\nvar LINK_TAG_CSS = '<link type=\"text/css\" href=\"%s\" rel=\"stylesheet\">'\nvar LINK_TAG_HTML = '<link href=\"%s\" rel=\"import\">'\nvar SCRIPT_TYPE = {\n  '.js': 'text/javascript',\n  '.dart': 'application/dart'\n}\n\nvar filePathToUrlPath = function (filePath, basePath, urlRoot) {\n  if (filePath.indexOf(basePath) === 0) {\n    return urlRoot + 'base' + filePath.substr(basePath.length)\n  }\n\n  return urlRoot + 'absolute' + filePath\n}\n\nvar getXUACompatibleMetaElement = function (url) {\n  var tag = ''\n  var urlObj = urlparse(url)\n  if (urlObj.query['x-ua-compatible']) {\n    tag = '\\n<meta http-equiv=\"X-UA-Compatible\" content=\"' +\n      urlObj.query['x-ua-compatible'] + '\"/>'\n  }\n  return tag\n}\n\nvar getXUACompatibleUrl = function (url) {\n  var value = ''\n  var urlObj = urlparse(url)\n  if (urlObj.query['x-ua-compatible']) {\n    value = '?x-ua-compatible=' + encodeURIComponent(urlObj.query['x-ua-compatible'])\n  }\n  return value\n}\n\nvar createKarmaMiddleware = function (filesPromise, serveStaticFile,\n  /* config.basePath */ basePath, /* config.urlRoot */ urlRoot, /* config.client */ client) {\n  return function (request, response, next) {\n    var requestUrl = request.normalizedUrl.replace(/\\?.*/, '')\n\n    // redirect /__karma__ to /__karma__ (trailing slash)\n    if (requestUrl === urlRoot.substr(0, urlRoot.length - 1)) {\n      response.setHeader('Location', urlRoot)\n      response.writeHead(301)\n      return response.end('MOVED PERMANENTLY')\n    }\n\n    // ignore urls outside urlRoot\n    if (requestUrl.indexOf(urlRoot) !== 0) {\n      return next()\n    }\n\n    // remove urlRoot prefix\n    requestUrl = requestUrl.substr(urlRoot.length - 1)\n\n    // serve client.html\n    if (requestUrl === '/') {\n      return serveStaticFile('/client.html', response, function (data) {\n        return data\n          .replace('\\n%X_UA_COMPATIBLE%', getXUACompatibleMetaElement(request.url))\n          .replace('%X_UA_COMPATIBLE_URL%', getXUACompatibleUrl(request.url))\n      })\n    }\n\n    // serve karma.js\n    if (requestUrl === '/karma.js') {\n      return serveStaticFile(requestUrl, response, function (data) {\n        return data.replace('%KARMA_URL_ROOT%', urlRoot)\n          .replace('%KARMA_VERSION%', VERSION)\n      })\n    }\n\n    // serve the favicon\n    if (requestUrl === '/favicon.ico') {\n      return serveStaticFile(requestUrl, response)\n    }\n\n    // serve context.html - execution context within the iframe\n    // or debug.html - execution context without channel to the server\n    if (requestUrl === '/context.html' || requestUrl === '/debug.html') {\n      return filesPromise.then(function (files) {\n        serveStaticFile(requestUrl, response, function (data) {\n          common.setNoCacheHeaders(response)\n\n          var scriptTags = files.included.map(function (file) {\n            var filePath = file.path\n            var fileExt = path.extname(filePath)\n\n            if (!file.isUrl) {\n              filePath = filePathToUrlPath(filePath, basePath, urlRoot)\n\n              if (requestUrl === '/context.html') {\n                filePath += '?' + file.sha\n              }\n            }\n\n            if (fileExt === '.css') {\n              return util.format(LINK_TAG_CSS, filePath)\n            }\n\n            if (fileExt === '.html') {\n              return util.format(LINK_TAG_HTML, filePath)\n            }\n\n            return util.format(SCRIPT_TAG, SCRIPT_TYPE[fileExt] || 'text/javascript', filePath)\n          })\n\n          // TODO(vojta): don't compute if it's not in the template\n          var mappings = files.served.map(function (file) {\n            // Windows paths contain backslashes and generate bad IDs if not escaped\n            var filePath = filePathToUrlPath(file.path, basePath, urlRoot).replace(/\\\\/g, '\\\\\\\\')\n\n            return util.format(\"  '%s': '%s'\", filePath, file.sha)\n          })\n\n          var clientConfig = ''\n\n          if (requestUrl === '/debug.html') {\n            clientConfig = 'window.__karma__.config = ' + JSON.stringify(client) + ';\\n'\n          }\n\n          mappings = 'window.__karma__.files = {\\n' + mappings.join(',\\n') + '\\n};\\n'\n\n          return data\n            .replace('%SCRIPTS%', scriptTags.join('\\n'))\n            .replace('%CLIENT_CONFIG%', clientConfig)\n            .replace('%MAPPINGS%', mappings)\n            .replace('\\n%X_UA_COMPATIBLE%', getXUACompatibleMetaElement(request.url))\n        })\n      }, function (errorFiles) {\n        serveStaticFile(requestUrl, response, function (data) {\n          common.setNoCacheHeaders(response)\n          return data.replace('%SCRIPTS%', '').replace('%CLIENT_CONFIG%', '').replace('%MAPPINGS%',\n            'window.__karma__.error(\"TEST RUN WAS CANCELLED because ' +\n            (errorFiles.length > 1 ? 'these files contain' : 'this file contains') +\n            ' some errors:\\\\n  ' + errorFiles.join('\\\\n  ') + '\");')\n        })\n      })\n    } else if (requestUrl === '/context.json') {\n      return filesPromise.then(function (files) {\n        common.setNoCacheHeaders(response)\n        response.writeHead(200)\n        response.end(JSON.stringify({\n          files: files.included.map(function (file) {\n            return filePathToUrlPath(file.path + '?' + file.sha, basePath, urlRoot)\n          })\n        }))\n      })\n    }\n\n    return next()\n  }\n}\n\ncreateKarmaMiddleware.$inject = ['filesPromise', 'serveStaticFile',\n  'config.basePath', 'config.urlRoot', 'config.client']\n\n// PUBLIC API\nexports.create = createKarmaMiddleware\n"]}