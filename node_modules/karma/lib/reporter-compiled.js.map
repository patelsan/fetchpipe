{"version":3,"sources":["reporter.js"],"names":[],"mappings":"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","file":"reporter-compiled.js","sourcesContent":["var util = require('util')\nvar log = require('./logger').create('reporter')\nvar MultiReporter = require('./reporters/multi')\nvar baseReporterDecoratorFactory = require('./reporters/base').decoratorFactory\nvar SourceMapConsumer = require('source-map').SourceMapConsumer\nvar memoizeWeak = require('memoizee/weak')\n\nvar createErrorFormatter = function (basePath, emitter, SourceMapConsumer) {\n  var lastServedFiles = []\n\n  emitter.on('file_list_modified', function (files) {\n    lastServedFiles = files.served\n  })\n\n  var findFile = function (path) {\n    for (var i = 0; i < lastServedFiles.length; i++) {\n      if (lastServedFiles[i].path === path) {\n        return lastServedFiles[i]\n      }\n    }\n    return null\n  }\n\n  var URL_REGEXP = new RegExp('(?:https?:\\\\/\\\\/[^\\\\/]*)?\\\\/?' +\n    '(base|absolute)' + // prefix\n    '((?:[A-z]\\\\:)?[^\\\\?\\\\s\\\\:]*)' + // path\n    '(\\\\?\\\\w*)?' + // sha\n    '(\\\\:(\\\\d+))?' + // line\n    '(\\\\:(\\\\d+))?' + // column\n    '', 'g')\n\n  var getSourceMapConsumer = memoizeWeak(function (sourceMap) {\n    return new SourceMapConsumer(sourceMap)\n  })\n\n  return function (msg, indentation) {\n    // remove domain and timestamp from source files\n    // and resolve base path / absolute path urls into absolute path\n    msg = (msg || '').replace(URL_REGEXP, function (_, prefix, path, __, ___, line, ____, column) {\n      if (prefix === 'base') {\n        path = basePath + path\n      }\n\n      var file = findFile(path)\n\n      if (file && file.sourceMap) {\n        line = parseInt(line || '0', 10)\n\n        column = parseInt(column, 10)\n\n        // When no column is given and we default to 0, it doesn't make sense to only search for smaller\n        // or equal columns in the sourcemap, let's search for equal or greater columns.\n        var bias = column ? SourceMapConsumer.GREATEST_LOWER_BOUND : SourceMapConsumer.LEAST_UPPER_BOUND\n\n        try {\n          var original = getSourceMapConsumer(file.sourceMap)\n            .originalPositionFor({line: line, column: (column || 0), bias: bias})\n\n          var formattedColumn = column ? util.format(':%s', column) : ''\n          return util.format('%s:%d%s <- %s:%d:%d', path, line, formattedColumn, original.source,\n            original.line, original.column)\n        } catch (e) {\n          log.warn('SourceMap position not found for trace: %s', msg)\n        // Fall back to non-source-mapped formatting.\n        }\n      }\n\n      var result = path + (line ? ':' + line : '') + (column ? ':' + column : '')\n      return result || prefix\n    })\n\n    // indent every line\n    if (indentation) {\n      msg = indentation + msg.replace(/\\n/g, '\\n' + indentation)\n    }\n\n    return msg + '\\n'\n  }\n}\n\nvar createReporters = function (names, config, emitter, injector) {\n  var errorFormatter = createErrorFormatter(config.basePath, emitter, SourceMapConsumer)\n  var reporters = []\n\n  // TODO(vojta): instantiate all reporters through DI\n  names.forEach(function (name) {\n    if (['dots', 'progress'].indexOf(name) !== -1) {\n      var Cls = require('./reporters/' + name + (config.colors ? '_color' : ''))\n      return reporters.push(new Cls(errorFormatter, config.reportSlowerThan))\n    }\n\n    var locals = {\n      baseReporterDecorator: ['factory', baseReporterDecoratorFactory],\n      formatError: ['value', errorFormatter]\n    }\n\n    try {\n      reporters.push(injector.createChild([locals], ['reporter:' + name]).get('reporter:' + name))\n    } catch (e) {\n      if (e.message.indexOf('No provider for \"reporter:' + name + '\"') !== -1) {\n        log.warn('Can not load \"%s\", it is not registered!\\n  ' +\n          'Perhaps you are missing some plugin?', name)\n      } else {\n        log.warn('Can not load \"%s\"!\\n  ' + e.stack, name)\n      }\n    }\n  })\n\n  // bind all reporters\n  reporters.forEach(function (reporter) {\n    emitter.bind(reporter)\n  })\n\n  return new MultiReporter(reporters)\n}\n\ncreateReporters.$inject = ['config.reporters', 'config', 'emitter', 'injector']\n\n// PUBLISH\nexports.createReporters = createReporters\n"]}