{"version":3,"sources":["runner.js"],"names":[],"mappings":"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","file":"runner-compiled.js","sourcesContent":["var http = require('http')\n\nvar constant = require('./constants')\nvar helper = require('./helper')\nvar cfg = require('./config')\n\nvar parseExitCode = function (buffer, defaultCode) {\n  var tailPos = buffer.length - Buffer.byteLength(constant.EXIT_CODE) - 1\n\n  if (tailPos < 0) {\n    return defaultCode\n  }\n\n  // tail buffer which might contain the message\n  var tail = buffer.slice(tailPos)\n  var tailStr = tail.toString()\n  if (tailStr.substr(0, tailStr.length - 1) === constant.EXIT_CODE) {\n    tail.fill('\\x00')\n    return parseInt(tailStr.substr(-1), 10)\n  }\n\n  return defaultCode\n}\n\n// TODO(vojta): read config file (port, host, urlRoot)\nexports.run = function (config, done) {\n  done = helper.isFunction(done) ? done : process.exit\n  config = cfg.parseConfig(config.configFile, config)\n\n  var exitCode = 1\n  var options = {\n    hostname: config.hostname,\n    path: config.urlRoot + 'run',\n    port: config.port,\n    method: 'POST',\n    headers: {\n      'Content-Type': 'application/json'\n    }\n  }\n\n  var request = http.request(options, function (response) {\n    response.on('data', function (buffer) {\n      exitCode = parseExitCode(buffer, exitCode)\n      process.stdout.write(buffer)\n    })\n\n    response.on('end', function () {\n      done(exitCode)\n    })\n  })\n\n  request.on('error', function (e) {\n    if (e.code === 'ECONNREFUSED') {\n      console.error('There is no server listening on port %d', options.port)\n      done(1, e.code)\n    } else {\n      throw e\n    }\n  })\n\n  request.end(JSON.stringify({\n    args: config.clientArgs,\n    removedFiles: config.removedFiles,\n    changedFiles: config.changedFiles,\n    addedFiles: config.addedFiles,\n    refresh: config.refresh\n  }))\n}\n"]}