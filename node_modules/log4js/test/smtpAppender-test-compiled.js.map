{"version":3,"sources":["smtpAppender-test.js"],"names":[],"mappings":"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","file":"smtpAppender-test-compiled.js","sourcesContent":["\"use strict\";\nvar vows = require('vows')\n, assert = require('assert')\n, log4js = require('../lib/log4js')\n, sandbox = require('sandboxed-module')\n;\n\nfunction setupLogging(category, options) {\n  var msgs = [];\n\n  var fakeMailer = {\n\t\tcreateTransport: function (name, options) {\n\t\t\treturn {\n\t\t\t\tconfig: options,\n\t\t\t\tsendMail: function (msg, callback) {\n          msgs.push(msg);\n          callback(null, true);\n        },\n        close: function() {}\n\t\t\t};\n\t\t}\n  };\n\n  var fakeLayouts = {\n    layout: function(type, config) {\n      this.type = type;\n      this.config = config;\n      return log4js.layouts.messagePassThroughLayout;\n    },\n    basicLayout: log4js.layouts.basicLayout,\n    messagePassThroughLayout: log4js.layouts.messagePassThroughLayout\n  };\n\n  var fakeConsole = {\n    errors: [],\n    error: function(msg, value) {\n      this.errors.push({ msg: msg, value: value });\n    }\n  };\n\n  var fakeTransportPlugin = function () {\n  };\n    \n  var smtpModule = sandbox.require('../lib/appenders/smtp', {\n\t\trequires: {\n      'nodemailer': fakeMailer,\n      'nodemailer-sendmail-transport': fakeTransportPlugin,\n      'nodemailer-smtp-transport': fakeTransportPlugin,\n      '../layouts': fakeLayouts\n\t\t},\n    globals: {\n      console: fakeConsole\n    }\n  });\n\n  log4js.addAppender(smtpModule.configure(options), category);\n\n  return {\n\t\tlogger: log4js.getLogger(category),\n\t\tmailer: fakeMailer,\n    layouts: fakeLayouts,\n    console: fakeConsole,\n\t\tresults: msgs\n  };\n}\n\nfunction checkMessages (result, sender, subject) {\n  for (var i = 0; i < result.results.length; ++i) {\n\t\tassert.equal(result.results[i].from, sender);\n\t\tassert.equal(result.results[i].to, 'recipient@domain.com');\n\t\tassert.equal(result.results[i].subject, subject ? subject : 'Log event #' + (i+1));\n\t\tassert.ok(new RegExp('.+Log event #' + (i+1) + '\\n$').test(result.results[i].text));\n  }\n}\n\nlog4js.clearAppenders();\nvows.describe('log4js smtpAppender').addBatch({\n  'minimal config': {\n\t\ttopic: function() {\n      var setup = setupLogging('minimal config', {\n        recipients: 'recipient@domain.com',\n        SMTP: {\n          port: 25,\n          auth: {\n            user: 'user@domain.com'\n          }\n        }\n      });\n      setup.logger.info('Log event #1');\n      return setup;\n\t\t},\n\t\t'there should be one message only': function (result) {\n      assert.equal(result.results.length, 1);\n\t\t},\n\t\t'message should contain proper data': function (result) {\n      checkMessages(result);\n\t\t}\n  },\n  'fancy config': {\n    topic: function() {\n      var setup = setupLogging('fancy config', {\n        recipients: 'recipient@domain.com',\n        sender: 'sender@domain.com',\n        subject: 'This is subject',\n        SMTP: {\n          port: 25,\n          auth: {\n            user: 'user@domain.com'\n          }\n        }\n      });\n      setup.logger.info('Log event #1');\n      return setup;\n    },\n    'there should be one message only': function (result) {\n      assert.equal(result.results.length, 1);\n    },\n    'message should contain proper data': function (result) {\n      checkMessages(result, 'sender@domain.com', 'This is subject');\n    }\n  },\n  'config with layout': {\n    topic: function() {\n      var setup = setupLogging('config with layout', {\n        layout: {\n          type: \"tester\"\n        }\n      });\n      return setup;\n    },\n    'should configure layout': function(result) {\n      assert.equal(result.layouts.type, 'tester');\n    }\n  },\n  'separate email for each event': {\n    topic: function() {\n      var self = this;\n      var setup = setupLogging('separate email for each event', {\n        recipients: 'recipient@domain.com',\n        SMTP: {\n          port: 25,\n          auth: {\n            user: 'user@domain.com'\n          }\n        }\n      });\n      setTimeout(function () {\n        setup.logger.info('Log event #1');\n      }, 0);\n      setTimeout(function () {\n        setup.logger.info('Log event #2');\n      }, 500);\n      setTimeout(function () {\n        setup.logger.info('Log event #3');\n      }, 1100);\n      setTimeout(function () {\n        self.callback(null, setup);\n      }, 3000);\n    },\n    'there should be three messages': function (result) {\n      assert.equal(result.results.length, 3);\n    },\n    'messages should contain proper data': function (result) {\n      checkMessages(result);\n    }\n  },\n  'multiple events in one email': {\n    topic: function() {\n      var self = this;\n      var setup = setupLogging('multiple events in one email', {\n        recipients: 'recipient@domain.com',\n        sendInterval: 1,\n        SMTP: {\n          port: 25,\n          auth: {\n            user: 'user@domain.com'\n          }\n        }\n      });\n      setTimeout(function () {\n        setup.logger.info('Log event #1');\n      }, 0);\n      setTimeout(function () {\n        setup.logger.info('Log event #2');\n      }, 100);\n      setTimeout(function () {\n        setup.logger.info('Log event #3');\n      }, 1500);\n      setTimeout(function () {\n        self.callback(null, setup);\n      }, 3000);\n    },\n    'there should be two messages': function (result) {\n      assert.equal(result.results.length, 2);\n    },\n    'messages should contain proper data': function (result) {\n      assert.equal(result.results[0].to, 'recipient@domain.com');\n      assert.equal(result.results[0].subject, 'Log event #1');\n      assert.equal(result.results[0].text.match(new RegExp('.+Log event #[1-2]$', 'gm')).length, 2);\n      assert.equal(result.results[1].to, 'recipient@domain.com');\n      assert.equal(result.results[1].subject, 'Log event #3');\n      assert.ok(new RegExp('.+Log event #3\\n$').test(result.results[1].text));\n    }\n  },\n  'error when sending email': {\n    topic: function() {\n      var setup = setupLogging('error when sending email', {\n        recipients: 'recipient@domain.com',\n        sendInterval: 0,\n        SMTP: { port: 25, auth: { user: 'user@domain.com' } }\n      });\n\n      setup.mailer.createTransport = function() {\n        return {\n          sendMail: function(msg, cb) {\n            cb({ message: \"oh noes\" });\n          },\n          close: function() { }\n        };\n      };\n\n      setup.logger.info(\"This will break\");\n      return setup.console;\n    },\n    'should be logged to console': function(cons) {\n      assert.equal(cons.errors.length, 1);\n      assert.equal(cons.errors[0].msg, \"log4js.smtpAppender - Error happened\");\n      assert.equal(cons.errors[0].value.message, 'oh noes');\n    }\n  },\n  'transport full config': {\n    topic: function() {\n      var setup = setupLogging('transport full config', {\n          recipients: 'recipient@domain.com',\n          transport: {\n              plugin: 'sendmail',\n              options: {\n                  path: '/usr/sbin/sendmail'\n              }\n          }\n      });\n      setup.logger.info('Log event #1');\n      return setup;\n    },\n    'there should be one message only': function (result) {\n      assert.equal(result.results.length, 1);\n    },\n    'message should contain proper data': function (result) {\n      checkMessages(result);\n    }\n  },\n  'transport no-options config': {\n    topic: function() {\n      var setup = setupLogging('transport no-options config', {\n          recipients: 'recipient@domain.com',\n          transport: {\n              plugin: 'sendmail'\n          }\n      });\n      setup.logger.info('Log event #1');\n      return setup;\n    },\n    'there should be one message only': function (result) {\n      assert.equal(result.results.length, 1);\n    },\n    'message should contain proper data': function (result) {\n      checkMessages(result);\n    }\n  },\n  'transport no-plugin config': {\n    topic: function() {\n      var setup = setupLogging('transport no-plugin config', {\n          recipients: 'recipient@domain.com',\n          transport: {\n          }\n      });\n      setup.logger.info('Log event #1');\n      return setup;\n    },\n    'there should be one message only': function (result) {\n      assert.equal(result.results.length, 1);\n    },\n    'message should contain proper data': function (result) {\n      checkMessages(result);\n    }\n  }\n}).export(module);\n"]}