{"version":3,"sources":["async.js"],"names":[],"mappings":"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","file":"async-compiled.js","sourcesContent":["// Support for asynchronous functions\n\n'use strict';\n\nvar aFrom        = require('es5-ext/array/from')\n  , mixin        = require('es5-ext/object/mixin')\n  , defineLength = require('es5-ext/function/_define-length')\n  , nextTick     = require('next-tick')\n\n  , slice = Array.prototype.slice\n  , apply = Function.prototype.apply, create = Object.create\n  , hasOwnProperty = Object.prototype.hasOwnProperty;\n\nrequire('../lib/registered-extensions').async = function (tbi, conf) {\n\tvar waiting = create(null), cache = create(null)\n\t  , base = conf.memoized, original = conf.original\n\t  , currentCallback, currentContext, currentArgs;\n\n\t// Initial\n\tconf.memoized = defineLength(function (arg) {\n\t\tvar args = arguments, last = args[args.length - 1];\n\t\tif (typeof last === 'function') {\n\t\t\tcurrentCallback = last;\n\t\t\targs = slice.call(args, 0, -1);\n\t\t}\n\t\treturn base.apply(currentContext = this, currentArgs = args);\n\t}, base);\n\ttry { mixin(conf.memoized, base); } catch (ignore) {}\n\n\t// From cache (sync)\n\tconf.on('get', function (id) {\n\t\tvar cb, context, args;\n\t\tif (!currentCallback) return;\n\n\t\t// Unresolved\n\t\tif (waiting[id]) {\n\t\t\tif (typeof waiting[id] === 'function') waiting[id] = [waiting[id], currentCallback];\n\t\t\telse waiting[id].push(currentCallback);\n\t\t\tcurrentCallback = null;\n\t\t\treturn;\n\t\t}\n\n\t\t// Resolved, assure next tick invocation\n\t\tcb = currentCallback;\n\t\tcontext = currentContext;\n\t\targs = currentArgs;\n\t\tcurrentCallback = currentContext = currentArgs = null;\n\t\tnextTick(function () {\n\t\t\tvar data;\n\t\t\tif (hasOwnProperty.call(cache, id)) {\n\t\t\t\tdata = cache[id];\n\t\t\t\tconf.emit('getasync', id, args, context);\n\t\t\t\tapply.call(cb, data.context, data.args);\n\t\t\t} else {\n\t\t\t\t// Purged in a meantime, we shouldn't rely on cached value, recall\n\t\t\t\tcurrentCallback = cb;\n\t\t\t\tcurrentContext = context;\n\t\t\t\tcurrentArgs = args;\n\t\t\t\tbase.apply(context, args);\n\t\t\t}\n\t\t});\n\t});\n\n\t// Not from cache\n\tconf.original = function () {\n\t\tvar args, cb, origCb, result;\n\t\tif (!currentCallback) return apply.call(original, this, arguments);\n\t\targs = aFrom(arguments);\n\t\tcb = function self(err) {\n\t\t\tvar cb, args, id = self.id;\n\t\t\tif (id == null) {\n\t\t\t\t// Shouldn't happen, means async callback was called sync way\n\t\t\t\tnextTick(apply.bind(self, this, arguments));\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tdelete self.id;\n\t\t\tcb = waiting[id];\n\t\t\tdelete waiting[id];\n\t\t\tif (!cb) {\n\t\t\t\t// Already processed,\n\t\t\t\t// outcome of race condition: asyncFn(1, cb), asyncFn.clear(), asyncFn(1, cb)\n\t\t\t\treturn;\n\t\t\t}\n\t\t\targs = aFrom(arguments);\n\t\t\tif (conf.has(id)) {\n\t\t\t\tif (err) {\n\t\t\t\t\tconf.delete(id);\n\t\t\t\t} else {\n\t\t\t\t\tcache[id] = { context: this, args: args };\n\t\t\t\t\tconf.emit('setasync', id, (typeof cb === 'function') ? 1 : cb.length);\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (typeof cb === 'function') {\n\t\t\t\tresult = apply.call(cb, this, args);\n\t\t\t} else {\n\t\t\t\tcb.forEach(function (cb) { result = apply.call(cb, this, args); }, this);\n\t\t\t}\n\t\t\treturn result;\n\t\t};\n\t\torigCb = currentCallback;\n\t\tcurrentCallback = currentContext = currentArgs = null;\n\t\targs.push(cb);\n\t\tresult = apply.call(original, this, args);\n\t\tcb.cb = origCb;\n\t\tcurrentCallback = cb;\n\t\treturn result;\n\t};\n\n\t// After not from cache call\n\tconf.on('set', function (id) {\n\t\tif (!currentCallback) {\n\t\t\tconf.delete(id);\n\t\t\treturn;\n\t\t}\n\t\tif (waiting[id]) {\n\t\t\t// Race condition: asyncFn(1, cb), asyncFn.clear(), asyncFn(1, cb)\n\t\t\tif (typeof waiting[id] === 'function') waiting[id] = [waiting[id], currentCallback.cb];\n\t\t\telse waiting[id].push(currentCallback.cb);\n\t\t} else {\n\t\t\twaiting[id] = currentCallback.cb;\n\t\t}\n\t\tdelete currentCallback.cb;\n\t\tcurrentCallback.id = id;\n\t\tcurrentCallback = null;\n\t});\n\n\t// On delete\n\tconf.on('delete', function (id) {\n\t\tvar result;\n\t\t// If false, we don't have value yet, so we assume that intention is not\n\t\t// to memoize this call. After value is obtained we don't cache it but\n\t\t// gracefully pass to callback\n\t\tif (hasOwnProperty.call(waiting, id)) return;\n\t\tif (!cache[id]) return;\n\t\tresult = cache[id];\n\t\tdelete cache[id];\n\t\tconf.emit('deleteasync', id, result);\n\t});\n\n\t// On clear\n\tconf.on('clear', function () {\n\t\tvar oldCache = cache;\n\t\tcache = create(null);\n\t\tconf.emit('clearasync', oldCache);\n\t});\n};\n"]}