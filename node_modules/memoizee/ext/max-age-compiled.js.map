{"version":3,"sources":["max-age.js"],"names":[],"mappings":"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","file":"max-age-compiled.js","sourcesContent":["// Timeout cached values\n\n'use strict';\n\nvar aFrom      = require('es5-ext/array/from')\n  , noop       = require('es5-ext/function/noop')\n  , forEach    = require('es5-ext/object/for-each')\n  , timeout    = require('timers-ext/valid-timeout')\n  , extensions = require('../lib/registered-extensions')\n\n  , max = Math.max, min = Math.min, create = Object.create;\n\nextensions.maxAge = function (maxAge, conf, options) {\n\tvar timeouts, postfix, preFetchAge, preFetchTimeouts;\n\n\tmaxAge = timeout(maxAge);\n\tif (!maxAge) return;\n\n\ttimeouts = create(null);\n\tpostfix = (options.async && extensions.async) ? 'async' : '';\n\tconf.on('set' + postfix, function (id) {\n\t\ttimeouts[id] = setTimeout(function () { conf.delete(id); }, maxAge);\n\t\tif (!preFetchTimeouts) return;\n\t\tif (preFetchTimeouts[id]) clearTimeout(preFetchTimeouts[id]);\n\t\tpreFetchTimeouts[id] = setTimeout(function () {\n\t\t\tdelete preFetchTimeouts[id];\n\t\t}, preFetchAge);\n\t});\n\tconf.on('delete' + postfix, function (id) {\n\t\tclearTimeout(timeouts[id]);\n\t\tdelete timeouts[id];\n\t\tif (!preFetchTimeouts) return;\n\t\tclearTimeout(preFetchTimeouts[id]);\n\t\tdelete preFetchTimeouts[id];\n\t});\n\n\tif (options.preFetch) {\n\t\tif ((options.preFetch === true) || isNaN(options.preFetch)) {\n\t\t\tpreFetchAge = 0.333;\n\t\t} else {\n\t\t\tpreFetchAge = max(min(Number(options.preFetch), 1), 0);\n\t\t}\n\t\tif (preFetchAge) {\n\t\t\tpreFetchTimeouts = {};\n\t\t\tpreFetchAge = (1 - preFetchAge) * maxAge;\n\t\t\tconf.on('get' + postfix, function (id, args, context) {\n\t\t\t\tif (!preFetchTimeouts[id]) {\n\t\t\t\t\tpreFetchTimeouts[id] =  setTimeout(function () {\n\t\t\t\t\t\tdelete preFetchTimeouts[id];\n\t\t\t\t\t\tconf.delete(id);\n\t\t\t\t\t\tif (options.async) {\n\t\t\t\t\t\t\targs = aFrom(args);\n\t\t\t\t\t\t\targs.push(noop);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tconf.memoized.apply(context, args);\n\t\t\t\t\t}, 0);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\tconf.on('clear' + postfix, function () {\n\t\tforEach(timeouts, function (id) { clearTimeout(id); });\n\t\ttimeouts = {};\n\t\tif (preFetchTimeouts) {\n\t\t\tforEach(preFetchTimeouts, function (id) { clearTimeout(id); });\n\t\t\tpreFetchTimeouts = {};\n\t\t}\n\t});\n};\n"]}