{"version":3,"sources":["readdirp.js"],"names":[],"mappings":"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","file":"readdirp-compiled.js","sourcesContent":["'use strict';\n\nvar fs        =  require('graceful-fs')\n  , path      =  require('path')\n  , minimatch =  require('minimatch')\n  , toString  =  Object.prototype.toString\n  ;\n\n// Standard helpers\nfunction isFunction (obj) {\n  return toString.call(obj) === '[object Function]';\n}\n\nfunction isString (obj) {\n  return toString.call(obj) === '[object String]';\n}\n\nfunction isRegExp (obj) {\n  return toString.call(obj) === '[object RegExp]';\n}\n\nfunction isUndefined (obj) {\n  return obj === void 0;\n}\n\n/** \n * Main function which ends up calling readdirRec and reads all files and directories in given root recursively.\n * @param { Object }   opts     Options to specify root (start directory), filters and recursion depth\n * @param { function } callback1  When callback2 is given calls back for each processed file - function (fileInfo) { ... },\n *                                when callback2 is not given, it behaves like explained in callback2\n * @param { function } callback2  Calls back once all files have been processed with an array of errors and file infos\n *                                function (err, fileInfos) { ... }\n */\nfunction readdir(opts, callback1, callback2) {\n  var stream\n    , handleError\n    , handleFatalError\n    , pending = 0\n    , errors = []\n    , readdirResult = {\n        directories: []\n      , files: []\n    }\n    , fileProcessed\n    , allProcessed\n    , realRoot\n    , aborted = false\n    ;\n\n  // If no callbacks were given we will use a streaming interface\n  if (isUndefined(callback1)) {\n    var api          =  require('./stream-api')();\n    stream           =  api.stream;\n    callback1        =  api.processEntry;\n    callback2        =  api.done;\n    handleError      =  api.handleError;\n    handleFatalError =  api.handleFatalError;\n\n    stream.on('close', function () { aborted = true; });\n  } else {\n    handleError      =  function (err) { errors.push(err); };\n    handleFatalError =  function (err) {\n      handleError(err);\n      allProcessed(errors, null);\n    };\n  }\n\n  if (isUndefined(opts)){\n    handleFatalError(new Error (\n      'Need to pass at least one argument: opts! \\n' +\n      'https://github.com/thlorenz/readdirp#options'\n      )\n    );\n    return stream;\n  }\n\n  opts.root            =  opts.root            || '.';\n  opts.fileFilter      =  opts.fileFilter      || function() { return true; };\n  opts.directoryFilter =  opts.directoryFilter || function() { return true; };\n  opts.depth           =  typeof opts.depth === 'undefined' ? 999999999 : opts.depth;\n  opts.entryType       =  opts.entryType       || 'files';\n\n  var statfn = opts.lstat === true ? fs.lstat.bind(fs) : fs.stat.bind(fs);\n\n  if (isUndefined(callback2)) {\n    fileProcessed = function() { };\n    allProcessed = callback1;\n  } else {\n    fileProcessed = callback1;\n    allProcessed = callback2;\n  }\n\n  function normalizeFilter (filter) {\n\n    if (isUndefined(filter)) return undefined;\n\n    function isNegated (filters) {\n\n      function negated(f) { \n        return f.indexOf('!') === 0; \n      }\n\n      var some = filters.some(negated);\n      if (!some) {\n        return false;\n      } else {\n        if (filters.every(negated)) {\n          return true;\n        } else {\n          // if we detect illegal filters, bail out immediately\n          throw new Error(\n            'Cannot mix negated with non negated glob filters: ' + filters + '\\n' +\n            'https://github.com/thlorenz/readdirp#filters'\n          );\n        }\n      }\n    }\n\n    // Turn all filters into a function\n    if (isFunction(filter)) {\n\n      return filter;\n\n    } else if (isString(filter)) {\n\n      return function (entryInfo) {\n        return minimatch(entryInfo.name, filter.trim());\n      };\n\n    } else if (filter && Array.isArray(filter)) {\n\n      if (filter) filter = filter.map(function (f) {\n        return f.trim();\n      });\n\n      return isNegated(filter) ?\n        // use AND to concat multiple negated filters\n        function (entryInfo) {\n          return filter.every(function (f) {\n            return minimatch(entryInfo.name, f);\n          });\n        }\n        :\n        // use OR to concat multiple inclusive filters\n        function (entryInfo) {\n          return filter.some(function (f) {\n            return minimatch(entryInfo.name, f);\n          });\n        };\n    }\n  }\n\n  function processDir(currentDir, entries, callProcessed) {\n    if (aborted) return;\n    var total = entries.length\n      , processed = 0\n      , entryInfos = []\n      ;\n\n    fs.realpath(currentDir, function(err, realCurrentDir) {\n      if (aborted) return;\n      if (err) {\n        handleError(err);\n        callProcessed(entryInfos);\n        return;\n      }\n\n      var relDir = path.relative(realRoot, realCurrentDir);\n\n      if (entries.length === 0) {\n        callProcessed([]);\n      } else {\n        entries.forEach(function (entry) { \n\n          var fullPath = path.join(realCurrentDir, entry)\n            , relPath  = path.join(relDir, entry);\n\n          statfn(fullPath, function (err, stat) {\n            if (err) {\n              handleError(err);\n            } else {\n              entryInfos.push({\n                  name          :  entry\n                , path          :  relPath   // relative to root\n                , fullPath      :  fullPath\n\n                , parentDir     :  relDir    // relative to root\n                , fullParentDir :  realCurrentDir\n\n                , stat          :  stat\n              });\n            }\n            processed++;\n            if (processed === total) callProcessed(entryInfos);\n          });\n        });\n      }\n    });\n  }\n\n  function readdirRec(currentDir, depth, callCurrentDirProcessed) {\n    if (aborted) return;\n\n    fs.readdir(currentDir, function (err, entries) {\n      if (err) {\n        handleError(err);\n        callCurrentDirProcessed();\n        return;\n      }\n\n      processDir(currentDir, entries, function(entryInfos) {\n\n        var subdirs = entryInfos\n          .filter(function (ei) { return ei.stat.isDirectory() && opts.directoryFilter(ei); });\n\n        subdirs.forEach(function (di) {\n          if(opts.entryType === 'directories' || opts.entryType === 'both' || opts.entryType === 'all') {\n            fileProcessed(di);\n          }\n          readdirResult.directories.push(di); \n        });\n\n        entryInfos\n          .filter(function(ei) {\n            var isCorrectType = opts.entryType === 'all' ?\n              !ei.stat.isDirectory() : ei.stat.isFile() || ei.stat.isSymbolicLink();\n            return isCorrectType && opts.fileFilter(ei);\n          })\n          .forEach(function (fi) {\n            if(opts.entryType === 'files' || opts.entryType === 'both' || opts.entryType === 'all') {\n              fileProcessed(fi);\n            }\n            readdirResult.files.push(fi); \n          });\n\n        var pendingSubdirs = subdirs.length;\n\n        // Be done if no more subfolders exist or we reached the maximum desired depth\n        if(pendingSubdirs === 0 || depth === opts.depth) {\n          callCurrentDirProcessed();\n        } else {\n          // recurse into subdirs, keeping track of which ones are done \n          // and call back once all are processed\n          subdirs.forEach(function (subdir) {\n            readdirRec(subdir.fullPath, depth + 1, function () {\n              pendingSubdirs = pendingSubdirs - 1;\n              if(pendingSubdirs === 0) { \n                callCurrentDirProcessed();\n              }\n            });\n          });\n        }\n      });\n    });\n  }\n\n  // Validate and normalize filters\n  try {\n    opts.fileFilter = normalizeFilter(opts.fileFilter);\n    opts.directoryFilter = normalizeFilter(opts.directoryFilter);\n  } catch (err) {\n    // if we detect illegal filters, bail out immediately\n    handleFatalError(err);\n    return stream;\n  }\n\n  // If filters were valid get on with the show\n  fs.realpath(opts.root, function(err, res) {\n    if (err) {\n      handleFatalError(err);\n      return stream;\n    }\n\n    realRoot = res;\n    readdirRec(opts.root, 0, function () { \n      // All errors are collected into the errors array\n      if (errors.length > 0) {\n        allProcessed(errors, readdirResult); \n      } else {\n        allProcessed(null, readdirResult);\n      }\n    });\n  });\n\n  return stream;\n}\n\nmodule.exports = readdir;\n"]}