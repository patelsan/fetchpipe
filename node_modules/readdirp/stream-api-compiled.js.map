{"version":3,"sources":["stream-api.js"],"names":[],"mappings":"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","file":"stream-api-compiled.js","sourcesContent":["'use strict';\n\nvar si = typeof setImmediate !== 'undefined' ? setImmediate : function (fn) { setTimeout(fn, 0) };\n\nvar stream = require('readable-stream');\nvar util = require('util');\n\nvar Readable = stream.Readable;\n\nmodule.exports = ReaddirpReadable;\n\nutil.inherits(ReaddirpReadable, Readable);\n\nfunction ReaddirpReadable (opts) {\n  if (!(this instanceof ReaddirpReadable)) return new ReaddirpReadable(opts);\n\n  opts = opts || {};\n  \n  opts.objectMode = true;\n  Readable.call(this, opts);\n\n  // backpressure not implemented at this point\n  this.highWaterMark = Infinity;\n\n  this._destroyed = false;\n  this._paused = false;\n  this._warnings = [];\n  this._errors = [];\n\n  this._pauseResumeErrors();\n}\n\nvar proto = ReaddirpReadable.prototype;\n\nproto._pauseResumeErrors = function () {\n  var self = this;\n  self.on('pause', function () { self._paused = true });\n  self.on('resume', function () {\n    if (self._destroyed) return;\n    self._paused = false;\n\n    self._warnings.forEach(function (err) { self.emit('warn', err) });\n    self._warnings.length = 0;\n\n    self._errors.forEach(function (err) { self.emit('error', err) });\n    self._errors.length = 0;\n  })\n}\n\n// called for each entry\nproto._processEntry = function (entry) {\n  if (this._destroyed) return;\n  this.push(entry);\n}\n\nproto._read = function () { }\n\nproto.destroy = function () {\n  // when stream is destroyed it will emit nothing further, not even errors or warnings\n  this.push(null);\n  this.readable = false;\n  this._destroyed = true;\n  this.emit('close');\n}\n\nproto._done = function () {\n  this.push(null);\n}\n\n// we emit errors and warnings async since we may handle errors like invalid args\n// within the initial event loop before any event listeners subscribed\nproto._handleError = function (err) {\n  var self = this;\n  si(function () { \n    if (self._paused) return self._warnings.push(err);\n    if (!self._destroyed) self.emit('warn', err);\n  });\n}\n\nproto._handleFatalError = function (err) {\n  var self = this;\n  si(function () { \n    if (self._paused) return self._errors.push(err);\n    if (!self._destroyed) self.emit('error', err);\n  });\n}\n\nfunction createStreamAPI () {\n  var stream = new ReaddirpReadable();\n\n  return { \n      stream           :  stream\n    , processEntry     :  stream._processEntry.bind(stream)\n    , done             :  stream._done.bind(stream)\n    , handleError      :  stream._handleError.bind(stream)\n    , handleFatalError :  stream._handleFatalError.bind(stream)\n  };\n}\n\nmodule.exports = createStreamAPI;\n"]}