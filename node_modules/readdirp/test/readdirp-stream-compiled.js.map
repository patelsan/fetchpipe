{"version":3,"sources":["readdirp-stream.js"],"names":[],"mappings":"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","file":"readdirp-stream-compiled.js","sourcesContent":["/*jshint asi:true */\n\nvar debug           //= true;\nvar test            = debug  ? function () {} : require('tap').test\nvar test_           = !debug ? function () {} : require('tap').test\n  , path            = require('path')\n  , fs              = require('fs')\n  , util            = require('util')\n  , TransformStream = require('readable-stream').Transform\n  , through         = require('through2')\n  , streamapi       = require('../stream-api')\n  , readdirp        = require('..')\n  , root            = path.join(__dirname, 'bed')\n  , totalDirs       = 6\n  , totalFiles      = 12\n  , ext1Files       = 4\n  , ext2Files       = 3\n  , ext3Files       = 2\n  ;\n  \n// see test/readdirp.js for test bed layout\n\nfunction opts (extend) {\n  var o = { root: root };\n\n  if (extend) {\n    for (var prop in extend) {\n      o[prop] = extend[prop];\n    }\n  }\n  return o;\n}\n\nfunction capture () {\n  var result = { entries: [], errors: [], ended: false }\n    , dst = new TransformStream({ objectMode: true });\n\n  dst._transform = function (entry, _, cb) {\n    result.entries.push(entry);\n    cb();\n  }\n\n  dst._flush = function (cb) {\n    result.ended = true;\n    this.push(result); \n    cb();\n  }\n\n  return dst;\n}\n\ntest('\\nintegrated', function (t) {\n  t.test('\\n# reading root without filter', function (t) {\n    t.plan(2);\n\n    readdirp(opts())\n      .on('error', function (err) {\n        t.fail('should not throw error', err);\n      })\n      .pipe(capture())\n      .pipe(through.obj(\n        function (result, _ , cb) { \n          t.equals(result.entries.length, totalFiles, 'emits all files');\n          t.ok(result.ended, 'ends stream');\n          t.end();\n          cb();\n        }\n      ));\n  })\n\n  t.test('\\n# normal: [\"*.ext1\", \"*.ext3\"]', function (t) {\n    t.plan(2);\n\n    readdirp(opts( { fileFilter: [ '*.ext1', '*.ext3' ] } ))\n      .on('error', function (err) {\n        t.fail('should not throw error', err);\n      })\n      .pipe(capture())\n      .pipe(through.obj(\n        function (result, _ , cb) { \n          t.equals(result.entries.length, ext1Files + ext3Files, 'all ext1 and ext3 files');\n          t.ok(result.ended, 'ends stream');\n          t.end();\n          cb();\n        }\n      ))\n  })\n\n  t.test('\\n# files only', function (t) {\n    t.plan(2);\n\n    readdirp(opts( { entryType: 'files' } ))\n      .on('error', function (err) {\n        t.fail('should not throw error', err);\n      })\n      .pipe(capture())\n      .pipe(through.obj(\n        function (result, _ , cb) { \n          t.equals(result.entries.length, totalFiles, 'returned files');\n          t.ok(result.ended, 'ends stream');\n          t.end();\n          cb();\n        }\n      ))\n  })\n\n  t.test('\\n# directories only', function (t) {\n    t.plan(2);\n\n    readdirp(opts( { entryType: 'directories' } ))\n      .on('error', function (err) {\n        t.fail('should not throw error', err);\n      })\n      .pipe(capture())\n      .pipe(through.obj(\n        function (result, _ , cb) { \n          t.equals(result.entries.length, totalDirs, 'returned directories');\n          t.ok(result.ended, 'ends stream');\n          t.end();\n          cb();\n        }\n      ))\n  })\n\n  t.test('\\n# both directories + files', function (t) {\n    t.plan(2);\n\n    readdirp(opts( { entryType: 'both' } ))\n      .on('error', function (err) {\n        t.fail('should not throw error', err);\n      })\n      .pipe(capture())\n      .pipe(through.obj(\n        function (result, _ , cb) { \n          t.equals(result.entries.length, totalDirs + totalFiles, 'returned everything');\n          t.ok(result.ended, 'ends stream');\n          t.end();\n          cb();\n        }\n      ))\n  })\n\n  t.test('\\n# directory filter with directories only', function (t) {\n    t.plan(2);\n\n    readdirp(opts( { entryType: 'directories', directoryFilter: [ 'root_dir1', '*dir1_subdir1' ] } ))\n      .on('error', function (err) {\n        t.fail('should not throw error', err);\n      })\n      .pipe(capture())\n      .pipe(through.obj(\n        function (result, _ , cb) {\n          t.equals(result.entries.length, 2, 'two directories');\n          t.ok(result.ended, 'ends stream');\n          t.end();\n          cb();\n        }\n      ))\n  })\n\n  t.test('\\n# directory and file filters with both entries', function (t) {\n    t.plan(2);\n\n    readdirp(opts( { entryType: 'both', directoryFilter: [ 'root_dir1', '*dir1_subdir1' ], fileFilter: [ '!*.ext1' ] } ))\n      .on('error', function (err) {\n        t.fail('should not throw error', err);\n      })\n      .pipe(capture())\n      .pipe(through.obj(\n        function (result, _ , cb) {\n          t.equals(result.entries.length, 6, '2 directories and 4 files');\n          t.ok(result.ended, 'ends stream');\n          t.end();\n          cb();\n        }\n      ))\n  })\n\n  t.test('\\n# negated: [\"!*.ext1\", \"!*.ext3\"]', function (t) {\n    t.plan(2);\n\n    readdirp(opts( { fileFilter: [ '!*.ext1', '!*.ext3' ] } ))\n      .on('error', function (err) {\n        t.fail('should not throw error', err);\n      })\n      .pipe(capture())\n      .pipe(through.obj(\n        function (result, _ , cb) { \n          t.equals(result.entries.length, totalFiles - ext1Files - ext3Files, 'all but ext1 and ext3 files');\n          t.ok(result.ended, 'ends stream');\n          t.end();\n        }\n      ))\n  })\n\n  t.test('\\n# no options given', function (t) {\n    t.plan(1);\n    readdirp()\n      .on('error', function (err) {\n        t.similar(err.toString() , /Need to pass at least one argument/ , 'emits meaningful error');\n        t.end();\n      })\n  })\n\n  t.test('\\n# mixed: [\"*.ext1\", \"!*.ext3\"]', function (t) {\n    t.plan(1);\n\n    readdirp(opts( { fileFilter: [ '*.ext1', '!*.ext3' ] } ))\n      .on('error', function (err) {\n        t.similar(err.toString() , /Cannot mix negated with non negated glob filters/ , 'emits meaningful error');\n        t.end();\n      })\n  })\n})\n\n\ntest('\\napi separately', function (t) {\n\n\n  t.test('\\n# handleError', function (t) {\n    t.plan(1);\n\n    var api = streamapi()\n      , warning = new Error('some file caused problems');\n\n    api.stream\n      .on('warn', function (err) {\n        t.equals(err, warning, 'warns with the handled error');\n      })\n    api.handleError(warning);\n  })\n\n  t.test('\\n# when stream is paused and then resumed', function (t) {\n    t.plan(6);\n    var api = streamapi()\n      , resumed = false\n      , fatalError = new Error('fatal!')\n      , nonfatalError = new Error('nonfatal!')\n      , processedData = 'some data'\n      ;\n\n    api.stream\n      .on('warn', function (err) {\n        t.equals(err, nonfatalError, 'emits the buffered warning');\n        t.ok(resumed, 'emits warning only after it was resumed');\n      })\n      .on('error', function (err) {\n        t.equals(err, fatalError, 'emits the buffered fatal error');\n        t.ok(resumed, 'emits errors only after it was resumed');\n      })\n      .on('data', function (data) {\n        t.equals(data, processedData, 'emits the buffered data');\n        t.ok(resumed, 'emits data only after it was resumed');\n      })\n      .pause()\n    \n    api.processEntry(processedData);\n    api.handleError(nonfatalError);\n    api.handleFatalError(fatalError);\n  \n    setTimeout(function () {\n      resumed = true;\n      api.stream.resume();\n    }, 1)\n  })\n\n\n  t.test('\\n# when a stream is destroyed, it emits \"closed\", but no longer emits \"data\", \"warn\" and \"error\"', function (t) {\n    var api = streamapi()\n      , fatalError = new Error('fatal!')\n      , nonfatalError = new Error('nonfatal!')\n      , processedData = 'some data'\n      , plan = 0;\n\n    t.plan(6)\n    var stream = api.stream\n      .on('warn', function (err) {\n        t.ok(!stream._destroyed, 'emits warning until destroyed');\n      })\n      .on('error', function (err) {\n        t.ok(!stream._destroyed, 'emits errors until destroyed');\n      })\n      .on('data', function (data) {\n        t.ok(!stream._destroyed, 'emits data until destroyed');\n      })\n      .on('close', function () {\n        t.ok(stream._destroyed, 'emits close when stream is destroyed');\n      })\n    \n\n    api.processEntry(processedData);\n    api.handleError(nonfatalError);\n    api.handleFatalError(fatalError);\n\n    setTimeout(function () {\n      stream.destroy()\n\n      t.notOk(stream.readable, 'stream is no longer readable after it is destroyed')\n\n      api.processEntry(processedData);\n      api.handleError(nonfatalError);\n      api.handleFatalError(fatalError);\n\n      process.nextTick(function () {\n        t.pass('emits no more data, warn or error events after it was destroyed')  \n        t.end();\n      })\n    }, 10)\n  })\n})\n"]}