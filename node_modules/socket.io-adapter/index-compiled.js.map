{"version":3,"sources":["index.js"],"names":[],"mappings":"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","file":"index-compiled.js","sourcesContent":["\n/**\n * Module dependencies.\n */\n\nvar keys = require('object-keys');\nvar Emitter = require('events').EventEmitter;\nvar parser = require('socket.io-parser');\n\n/**\n * Module exports.\n */\n\nmodule.exports = Adapter;\n\n/**\n * Memory adapter constructor.\n *\n * @param {Namespace} nsp\n * @api public\n */\n\nfunction Adapter(nsp){\n  this.nsp = nsp;\n  this.rooms = {};\n  this.sids = {};\n  this.encoder = new parser.Encoder();\n}\n\n/**\n * Inherits from `EventEmitter`.\n */\n\nAdapter.prototype.__proto__ = Emitter.prototype;\n\n/**\n * Adds a socket from a room.\n *\n * @param {String} socket id\n * @param {String} room name\n * @param {Function} callback\n * @api public\n */\n\nAdapter.prototype.add = function(id, room, fn){\n  this.sids[id] = this.sids[id] || {};\n  this.sids[id][room] = true;\n  this.rooms[room] = this.rooms[room] || {};\n  this.rooms[room][id] = true;\n  if (fn) process.nextTick(fn.bind(null, null));\n};\n\n/**\n * Removes a socket from a room.\n *\n * @param {String} socket id\n * @param {String} room name\n * @param {Function} callback\n * @api public\n */\n\nAdapter.prototype.del = function(id, room, fn){\n  this.sids[id] = this.sids[id] || {};\n  this.rooms[room] = this.rooms[room] || {};\n  delete this.sids[id][room];\n  delete this.rooms[room][id];\n  if (this.rooms.hasOwnProperty(room) && !keys(this.rooms[room]).length) {\n    delete this.rooms[room];\n  }\n\n  if (fn) process.nextTick(fn.bind(null, null));\n};\n\n/**\n * Removes a socket from all rooms it's joined.\n *\n * @param {String} socket id\n * @api public\n */\n\nAdapter.prototype.delAll = function(id, fn){\n  var rooms = this.sids[id];\n  if (rooms) {\n    for (var room in rooms) {\n      if (rooms.hasOwnProperty(room)) {\n        delete this.rooms[room][id];\n      }\n\n      if (this.rooms.hasOwnProperty(room) && !keys(this.rooms[room]).length) {\n        delete this.rooms[room];\n      }\n    }\n  }\n  delete this.sids[id];\n};\n\n/**\n * Broadcasts a packet.\n *\n * Options:\n *  - `flags` {Object} flags for this packet\n *  - `except` {Array} sids that should be excluded\n *  - `rooms` {Array} list of rooms to broadcast to\n *\n * @param {Object} packet object\n * @api public\n */\n\nAdapter.prototype.broadcast = function(packet, opts){\n  var rooms = opts.rooms || [];\n  var except = opts.except || [];\n  var flags = opts.flags || {};\n  var ids = {};\n  var self = this;\n  var socket;\n\n  packet.nsp = this.nsp.name;\n  this.encoder.encode(packet, function(encodedPackets) {\n    if (rooms.length) {\n      for (var i = 0; i < rooms.length; i++) {\n        var room = self.rooms[rooms[i]];\n        if (!room) continue;\n        for (var id in room) {\n          if (room.hasOwnProperty(id)) {\n            if (ids[id] || ~except.indexOf(id)) continue;\n            socket = self.nsp.connected[id];\n            if (socket) {\n              socket.packet(encodedPackets, true, flags.volatile);\n              ids[id] = true;\n            }\n          }\n        }\n      }\n    } else {\n      for (var id in self.sids) {\n        if (self.sids.hasOwnProperty(id)) {\n          if (~except.indexOf(id)) continue;\n          socket = self.nsp.connected[id];\n          if (socket) socket.packet(encodedPackets, true, flags.volatile);\n        }\n      }\n    }\n  });\n};\n"]}