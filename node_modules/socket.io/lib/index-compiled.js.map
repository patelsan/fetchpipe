{"version":3,"sources":["index.js"],"names":[],"mappings":";;;;;;;AAKA,IAAI,IAAI,GAAG,OAAO,CAAC,MAAM,CAAC,CAAC;AAC3B,IAAI,IAAI,GAAG,OAAO,CAAC,IAAI,CAAC,CAAC,YAAY,CAAC;AACtC,IAAI,KAAK,GAAG,OAAO,CAAC,KAAK,CAAC,CAAC,KAAK,CAAC;AACjC,IAAI,MAAM,GAAG,OAAO,CAAC,WAAW,CAAC,CAAC;AAClC,IAAI,MAAM,GAAG,OAAO,CAAC,kBAAkB,CAAC,CAAC;AACzC,IAAI,aAAa,GAAG,OAAO,CAAC,0BAA0B,CAAC,CAAC,OAAO,CAAC;AAChE,IAAI,MAAM,GAAG,OAAO,CAAC,UAAU,CAAC,CAAC;AACjC,IAAI,SAAS,GAAG,OAAO,CAAC,aAAa,CAAC,CAAC;AACvC,IAAI,OAAO,GAAG,OAAO,CAAC,mBAAmB,CAAC,CAAC;AAC3C,IAAI,KAAK,GAAG,OAAO,CAAC,OAAO,CAAC,CAAC,kBAAkB,CAAC,CAAC;AACjD,IAAI,GAAG,GAAG,OAAO,CAAC,KAAK,CAAC,CAAC;;;;;;AAMzB,MAAM,CAAC,OAAO,GAAG,MAAM,CAAC;;;;;;AAMxB,IAAI,YAAY,GAAG,IAAI,CAAC,OAAO,CAAC,OAAO,CAAC,+BAA+B,CAAC,EAAE,OAAO,CAAC,CAAC;;;;;;;;;;AAUnF,SAAS,MAAM,CAAC,GAAG,EAAE,IAAI,EAAC;AACxB,MAAI,EAAE,IAAI,YAAY,MAAM,CAAA,AAAC,EAAE,OAAO,IAAI,MAAM,CAAC,GAAG,EAAE,IAAI,CAAC,CAAC;AAC5D,MAAI,QAAQ,IAAI,OAAO,GAAG,IAAI,CAAC,GAAG,CAAC,MAAM,EAAE;AACzC,QAAI,GAAG,GAAG,CAAC;AACX,OAAG,GAAG,IAAI,CAAC;GACZ;AACD,MAAI,GAAG,IAAI,IAAI,EAAE,CAAC;AAClB,MAAI,CAAC,IAAI,GAAG,EAAE,CAAC;AACf,MAAI,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,IAAI,YAAY,CAAC,CAAC;AACrC,MAAI,CAAC,WAAW,CAAC,KAAK,KAAK,IAAI,CAAC,WAAW,CAAC,CAAC;AAC7C,MAAI,CAAC,OAAO,CAAC,IAAI,CAAC,OAAO,IAAI,OAAO,CAAC,CAAC;AACtC,MAAI,CAAC,OAAO,CAAC,IAAI,CAAC,OAAO,IAAI,KAAK,CAAC,CAAC;AACpC,MAAI,CAAC,OAAO,GAAG,IAAI,CAAC,EAAE,CAAC,GAAG,CAAC,CAAC;AAC5B,MAAI,GAAG,EAAE,IAAI,CAAC,MAAM,CAAC,GAAG,EAAE,IAAI,CAAC,CAAC;CACjC;;;;;;;;;AASD,MAAM,CAAC,SAAS,CAAC,YAAY,GAAG,UAAS,GAAG,EAAE,EAAE,EAAE;AAChD,MAAI,MAAM,GAAG,GAAG,CAAC,OAAO,CAAC,MAAM,IAAI,GAAG,CAAC,OAAO,CAAC,OAAO,CAAC;;;AAGvD,MAAI,MAAM,IAAI,MAAM,IAAI,IAAI,IAAI,MAAM,EAAE,MAAM,GAAG,GAAG,CAAC;;AAErD,MAAI,CAAC,CAAC,MAAM,IAAI,OAAO,IAAI,CAAC,QAAQ,AAAC,IAAI,UAAU,EAAE,OAAO,IAAI,CAAC,QAAQ,CAAC,MAAM,EAAE,EAAE,CAAC,CAAC;AACtF,MAAI,IAAI,CAAC,QAAQ,CAAC,OAAO,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC,EAAE,OAAO,EAAE,CAAC,IAAI,EAAE,IAAI,CAAC,CAAC;AAC/D,MAAI,MAAM,EAAE;AACV,QAAI;AACF,UAAI,KAAK,GAAG,GAAG,CAAC,KAAK,CAAC,MAAM,CAAC,CAAC;AAC9B,WAAK,CAAC,IAAI,GAAG,KAAK,CAAC,IAAI,IAAI,EAAE,CAAC;AAC9B,UAAI,EAAE,GACJ,CAAC,IAAI,CAAC,QAAQ,CAAC,OAAO,CAAC,KAAK,CAAC,QAAQ,GAAG,GAAG,GAAG,KAAK,CAAC,IAAI,CAAC,IACzD,CAAC,IAAI,CAAC,QAAQ,CAAC,OAAO,CAAC,KAAK,CAAC,QAAQ,GAAG,IAAI,CAAC,IAC7C,CAAC,IAAI,CAAC,QAAQ,CAAC,OAAO,CAAC,IAAI,GAAG,KAAK,CAAC,IAAI,CAAC,CAAC;AAC5C,aAAO,EAAE,CAAC,IAAI,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC;KACvB,CAAC,OAAO,EAAE,EAAE,EACZ;GACF;AACD,IAAE,CAAC,IAAI,EAAE,KAAK,CAAC,CAAC;CACjB,CAAC;;;;;;;;;;AAUF,MAAM,CAAC,SAAS,CAAC,WAAW,GAAG,UAAS,CAAC,EAAC;AACxC,MAAI,CAAC,SAAS,CAAC,MAAM,EAAE,OAAO,IAAI,CAAC,YAAY,CAAC;AAChD,MAAI,CAAC,YAAY,GAAG,CAAC,CAAC;AACtB,SAAO,IAAI,CAAC;CACb,CAAC;;;;;;AAMF,IAAI,WAAW,GAAG;AAChB,cAAY,EAAE,YAAY;AAC1B,qBAAmB,EAAE,aAAa;AAClC,sBAAoB,EAAE,cAAc;AACpC,uBAAqB,EAAE,mBAAmB;CAC3C,CAAC;;;;;;;;AAQF,MAAM,CAAC,SAAS,CAAC,GAAG,GAAG,UAAS,GAAG,EAAE,GAAG,EAAC;AACvC,MAAI,eAAe,IAAI,GAAG,IAAI,GAAG,EAAE;AACjC,QAAI,CAAC,GAAG,CAAC,UAAS,MAAM,EAAE,IAAI,EAAE;AAC9B,SAAG,CAAC,MAAM,CAAC,OAAO,EAAE,UAAS,GAAG,EAAE,UAAU,EAAE;AAC5C,YAAI,GAAG,EAAE,OAAO,IAAI,CAAC,IAAI,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC;AACrC,YAAI,CAAC,UAAU,EAAE,OAAO,IAAI,CAAC,IAAI,KAAK,CAAC,gBAAgB,CAAC,CAAC,CAAC;AAC1D,YAAI,EAAE,CAAC;OACR,CAAC,CAAC;KACJ,CAAC,CAAC;GACJ,MAAM,IAAI,SAAS,IAAI,GAAG,IAAI,GAAG,EAAE;AAClC,QAAI,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC;GACnB,MAAM,IAAI,UAAU,IAAI,GAAG,EAAE;AAC5B,QAAI,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;GAChB,MAAM,IAAI,WAAW,CAAC,GAAG,CAAC,IAAI,IAAI,CAAC,GAAG,CAAC,WAAW,CAAC,GAAG,CAAC,CAAC,EAAE;AACzD,QAAI,CAAC,GAAG,CAAC,WAAW,CAAC,GAAG,CAAC,CAAC,GAAG,GAAG,CAAC;GAClC,MAAM;AACL,WAAO,CAAC,KAAK,CAAC,qDAAqD,EAAE,GAAG,CAAC,CAAC;GAC3E;;AAED,SAAO,IAAI,CAAC;CACb,CAAC;;;;;;;;;;AAUF,MAAM,CAAC,SAAS,CAAC,IAAI,GAAG,UAAS,CAAC,EAAC;AACjC,MAAI,CAAC,SAAS,CAAC,MAAM,EAAE,OAAO,IAAI,CAAC,KAAK,CAAC;AACzC,MAAI,CAAC,KAAK,GAAG,CAAC,CAAC,OAAO,CAAC,KAAK,EAAE,EAAE,CAAC,CAAC;AAClC,SAAO,IAAI,CAAC;CACb,CAAC;;;;;;;;;;AAUF,MAAM,CAAC,SAAS,CAAC,OAAO,GAAG,UAAS,CAAC,EAAC;AACpC,MAAI,CAAC,SAAS,CAAC,MAAM,EAAE,OAAO,IAAI,CAAC,QAAQ,CAAC;AAC5C,MAAI,CAAC,QAAQ,GAAG,CAAC,CAAC;AAClB,OAAK,IAAI,CAAC,IAAI,IAAI,CAAC,IAAI,EAAE;AACvB,QAAI,IAAI,CAAC,IAAI,CAAC,cAAc,CAAC,CAAC,CAAC,EAAE;AAC/B,UAAI,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,WAAW,EAAE,CAAC;KAC5B;GACF;AACD,SAAO,IAAI,CAAC;CACb,CAAC;;;;;;;;;;AAUF,MAAM,CAAC,SAAS,CAAC,OAAO,GAAG,UAAS,CAAC,EAAC;AACpC,MAAI,CAAC,SAAS,CAAC,MAAM,EAAE,OAAO,IAAI,CAAC,QAAQ,CAAC;;AAE5C,MAAI,CAAC,QAAQ,GAAG,CAAC,CAAC;AAClB,SAAO,IAAI,CAAC;CACb,CAAC;;;;;;;;;;;AAWF,MAAM,CAAC,SAAS,CAAC,MAAM,GACvB,MAAM,CAAC,SAAS,CAAC,MAAM,GAAG,UAAS,GAAG,EAAE,IAAI,EAAC;AAC3C,MAAI,UAAU,IAAI,OAAO,GAAG,EAAE;AAC5B,QAAI,GAAG,GAAG,mDAAmD,GAC7D,+DAA+D,CAAC;AAChE,UAAM,IAAI,KAAK,CAAC,GAAG,CAAC,CAAC;GACtB;;;AAGD,MAAI,MAAM,CAAC,GAAG,CAAC,IAAI,GAAG,EAAE;AACtB,OAAG,GAAG,MAAM,CAAC,GAAG,CAAC,CAAC;GACnB;;AAED,MAAI,QAAQ,IAAI,OAAO,GAAG,EAAE;AAC1B,SAAK,CAAC,wCAAwC,EAAE,GAAG,CAAC,CAAC;AACrD,QAAI,IAAI,GAAG,GAAG,CAAC;AACf,OAAG,GAAG,IAAI,CAAC,MAAM,CAAC,UAAS,GAAG,EAAE,GAAG,EAAC;AAClC,SAAG,CAAC,SAAS,CAAC,GAAG,CAAC,CAAC;AACnB,SAAG,CAAC,GAAG,EAAE,CAAC;KACX,CAAC,CAAC;AACH,OAAG,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC;GAElB;;;AAGD,MAAI,GAAG,IAAI,IAAI,EAAE,CAAC;AAClB,MAAI,CAAC,IAAI,GAAG,IAAI,CAAC,IAAI,IAAI,IAAI,CAAC,IAAI,EAAE,CAAC;;AAErC,MAAI,CAAC,YAAY,GAAG,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;;;AAGjD,OAAK,CAAC,0CAA0C,EAAE,IAAI,CAAC,CAAC;AACxD,MAAI,CAAC,GAAG,GAAG,MAAM,CAAC,MAAM,CAAC,GAAG,EAAE,IAAI,CAAC,CAAC;;;AAGpC,MAAI,IAAI,CAAC,YAAY,EAAE,IAAI,CAAC,WAAW,CAAC,GAAG,CAAC,CAAC;;;AAG7C,MAAI,CAAC,UAAU,GAAG,GAAG,CAAC;;;AAGtB,MAAI,CAAC,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;;AAEpB,SAAO,IAAI,CAAC;CACb,CAAC;;;;;;;;;AASF,MAAM,CAAC,SAAS,CAAC,WAAW,GAAG,UAAS,GAAG,EAAC;AAC1C,OAAK,CAAC,sCAAsC,CAAC,CAAC;AAC9C,MAAI,GAAG,GAAG,IAAI,CAAC,KAAK,GAAG,eAAe,CAAC;AACvC,MAAI,GAAG,GAAG,GAAG,CAAC,SAAS,CAAC,SAAS,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC;AAC5C,MAAI,IAAI,GAAG,IAAI,CAAC;AAChB,KAAG,CAAC,kBAAkB,CAAC,SAAS,CAAC,CAAC;AAClC,KAAG,CAAC,EAAE,CAAC,SAAS,EAAE,UAAS,GAAG,EAAE,GAAG,EAAE;AACnC,QAAI,CAAC,IAAI,GAAG,CAAC,GAAG,CAAC,OAAO,CAAC,GAAG,CAAC,EAAE;AAC7B,UAAI,CAAC,KAAK,CAAC,GAAG,EAAE,GAAG,CAAC,CAAC;KACtB,MAAM;AACL,WAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,GAAG,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;AACnC,WAAG,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,GAAG,EAAE,GAAG,EAAE,GAAG,CAAC,CAAC;OAC5B;KACF;GACF,CAAC,CAAC;CACJ,CAAC;;;;;;;;;;AAUF,MAAM,CAAC,SAAS,CAAC,KAAK,GAAG,UAAS,GAAG,EAAE,GAAG,EAAC;AACzC,MAAI,IAAI,GAAG,GAAG,CAAC,OAAO,CAAC,eAAe,CAAC,CAAC;AACxC,MAAI,IAAI,EAAE;AACR,QAAI,aAAa,IAAI,IAAI,EAAE;AACzB,WAAK,CAAC,kBAAkB,CAAC,CAAC;AAC1B,SAAG,CAAC,SAAS,CAAC,GAAG,CAAC,CAAC;AACnB,SAAG,CAAC,GAAG,EAAE,CAAC;AACV,aAAO;KACR;GACF;;AAED,OAAK,CAAC,qBAAqB,CAAC,CAAC;AAC7B,KAAG,CAAC,SAAS,CAAC,cAAc,EAAE,wBAAwB,CAAC,CAAC;AACxD,KAAG,CAAC,SAAS,CAAC,MAAM,EAAE,aAAa,CAAC,CAAC;AACrC,KAAG,CAAC,SAAS,CAAC,GAAG,CAAC,CAAC;AACnB,KAAG,CAAC,GAAG,CAAC,YAAY,CAAC,CAAC;CACvB,CAAC;;;;;;;;;;AAUF,MAAM,CAAC,SAAS,CAAC,IAAI,GAAG,UAAS,MAAM,EAAC;AACtC,MAAI,CAAC,MAAM,GAAG,MAAM,CAAC;AACrB,MAAI,CAAC,MAAM,CAAC,EAAE,CAAC,YAAY,EAAE,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC;AAC3D,SAAO,IAAI,CAAC;CACb,CAAC;;;;;;;;;;AAUF,MAAM,CAAC,SAAS,CAAC,YAAY,GAAG,UAAS,IAAI,EAAC;AAC5C,OAAK,CAAC,gCAAgC,EAAE,IAAI,CAAC,EAAE,CAAC,CAAC;AACjD,MAAI,MAAM,GAAG,IAAI,MAAM,CAAC,IAAI,EAAE,IAAI,CAAC,CAAC;AACpC,QAAM,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC;AACpB,SAAO,IAAI,CAAC;CACb,CAAC;;;;;;;;;;AAUF,MAAM,CAAC,SAAS,CAAC,EAAE,GAAG,UAAS,IAAI,EAAE,EAAE,EAAC;AACtC,MAAI,MAAM,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,KAAK,GAAG,EAAE,IAAI,GAAG,GAAG,GAAG,IAAI,CAAC;;AAE/C,MAAI,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,EAAE;AACpB,SAAK,CAAC,2BAA2B,EAAE,IAAI,CAAC,CAAC;AACzC,QAAI,GAAG,GAAG,IAAI,SAAS,CAAC,IAAI,EAAE,IAAI,CAAC,CAAC;AACpC,QAAI,CAAC,IAAI,CAAC,IAAI,CAAC,GAAG,GAAG,CAAC;GACvB;AACD,MAAI,EAAE,EAAE,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,EAAE,CAAC,SAAS,EAAE,EAAE,CAAC,CAAC;AAC1C,SAAO,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;CACxB,CAAC;;;;;;;;AAQF,MAAM,CAAC,SAAS,CAAC,KAAK,GAAG,YAAU;AACjC,MAAI,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,OAAO,CAAC,OAAO,CAAC,UAAS,MAAM,EAAC;AAC7C,UAAM,CAAC,OAAO,EAAE,CAAC;GAClB,CAAC,CAAC;;AAEH,MAAI,CAAC,MAAM,CAAC,KAAK,EAAE,CAAC;;AAEpB,MAAG,IAAI,CAAC,UAAU,EAAC;AACjB,QAAI,CAAC,UAAU,CAAC,KAAK,EAAE,CAAC;GACzB;CACF,CAAC;;;;;;AAMF,CAAC,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,KAAK,EAAE,MAAM,EAAE,MAAM,EAAE,OAAO,CAAC,CAAC,OAAO,CAAC,UAAS,EAAE,EAAC;AACrE,QAAM,CAAC,SAAS,CAAC,EAAE,CAAC,GAAG,YAAU;AAC/B,QAAI,GAAG,GAAG,IAAI,CAAC,OAAO,CAAC,EAAE,CAAC,CAAC;AAC3B,WAAO,GAAG,CAAC,KAAK,CAAC,IAAI,CAAC,OAAO,EAAE,SAAS,CAAC,CAAC;GAC3C,CAAC;CACH,CAAC,CAAC;;AAEH,SAAS,CAAC,KAAK,CAAC,OAAO,CAAC,UAAS,IAAI,EAAC;AACpC,QAAM,CAAC,SAAS,CAAC,gBAAgB,CAAC,IAAI,EAAE,UAAS,IAAI,EAAC;AACpD,QAAI,CAAC,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;AACtB,WAAO,IAAI,CAAC;GACb,CAAC,CAAC;CACJ,CAAC,CAAC;;;;;;AAMH,MAAM,CAAC,MAAM,GAAG,MAAM,CAAC","file":"index-compiled.js","sourcesContent":["\n/**\n * Module dependencies.\n */\n\nvar http = require('http');\nvar read = require('fs').readFileSync;\nvar parse = require('url').parse;\nvar engine = require('engine.io');\nvar client = require('socket.io-client');\nvar clientVersion = require('socket.io-client/package').version;\nvar Client = require('./client');\nvar Namespace = require('./namespace');\nvar Adapter = require('socket.io-adapter');\nvar debug = require('debug')('socket.io:server');\nvar url = require('url');\n\n/**\n * Module exports.\n */\n\nmodule.exports = Server;\n\n/**\n * Socket.IO client source.\n */\n\nvar clientSource = read(require.resolve('socket.io-client/socket.io.js'), 'utf-8');\n\n/**\n * Server constructor.\n *\n * @param {http.Server|Number|Object} http server, port or options\n * @param {Object} options\n * @api public\n */\n\nfunction Server(srv, opts){\n  if (!(this instanceof Server)) return new Server(srv, opts);\n  if ('object' == typeof srv && !srv.listen) {\n    opts = srv;\n    srv = null;\n  }\n  opts = opts || {};\n  this.nsps = {};\n  this.path(opts.path || '/socket.io');\n  this.serveClient(false !== opts.serveClient);\n  this.adapter(opts.adapter || Adapter);\n  this.origins(opts.origins || '*:*');\n  this.sockets = this.of('/');\n  if (srv) this.attach(srv, opts);\n}\n\n/**\n * Server request verification function, that checks for allowed origins\n *\n * @param {http.IncomingMessage} request\n * @param {Function} callback to be called with the result: `fn(err, success)`\n */\n\nServer.prototype.checkRequest = function(req, fn) {\n  var origin = req.headers.origin || req.headers.referer;\n\n  // file:// URLs produce a null Origin which can't be authorized via echo-back\n  if ('null' == origin || null == origin) origin = '*';\n\n  if (!!origin && typeof(this._origins) == 'function') return this._origins(origin, fn);\n  if (this._origins.indexOf('*:*') !== -1) return fn(null, true);\n  if (origin) {\n    try {\n      var parts = url.parse(origin);\n      parts.port = parts.port || 80;\n      var ok =\n        ~this._origins.indexOf(parts.hostname + ':' + parts.port) ||\n        ~this._origins.indexOf(parts.hostname + ':*') ||\n        ~this._origins.indexOf('*:' + parts.port);\n      return fn(null, !!ok);\n    } catch (ex) {\n    }\n  }\n  fn(null, false);\n};\n\n/**\n * Sets/gets whether client code is being served.\n *\n * @param {Boolean} whether to serve client code\n * @return {Server|Boolean} self when setting or value when getting\n * @api public\n */\n\nServer.prototype.serveClient = function(v){\n  if (!arguments.length) return this._serveClient;\n  this._serveClient = v;\n  return this;\n};\n\n/**\n * Old settings for backwards compatibility\n */\n\nvar oldSettings = {\n  \"transports\": \"transports\",\n  \"heartbeat timeout\": \"pingTimeout\",\n  \"heartbeat interval\": \"pingInterval\",\n  \"destroy buffer size\": \"maxHttpBufferSize\"\n};\n\n/**\n * Backwards compatiblity.\n *\n * @api public\n */\n\nServer.prototype.set = function(key, val){\n  if ('authorization' == key && val) {\n    this.use(function(socket, next) {\n      val(socket.request, function(err, authorized) {\n        if (err) return next(new Error(err));\n        if (!authorized) return next(new Error('Not authorized'));\n        next();\n      });\n    });\n  } else if ('origins' == key && val) {\n    this.origins(val);\n  } else if ('resource' == key) {\n    this.path(val);\n  } else if (oldSettings[key] && this.eio[oldSettings[key]]) {\n    this.eio[oldSettings[key]] = val;\n  } else {\n    console.error('Option %s is not valid. Please refer to the README.', key);\n  }\n\n  return this;\n};\n\n/**\n * Sets the client serving path.\n *\n * @param {String} pathname\n * @return {Server|String} self when setting or value when getting\n * @api public\n */\n\nServer.prototype.path = function(v){\n  if (!arguments.length) return this._path;\n  this._path = v.replace(/\\/$/, '');\n  return this;\n};\n\n/**\n * Sets the adapter for rooms.\n *\n * @param {Adapter} pathname\n * @return {Server|Adapter} self when setting or value when getting\n * @api public\n */\n\nServer.prototype.adapter = function(v){\n  if (!arguments.length) return this._adapter;\n  this._adapter = v;\n  for (var i in this.nsps) {\n    if (this.nsps.hasOwnProperty(i)) {\n      this.nsps[i].initAdapter();\n    }\n  }\n  return this;\n};\n\n/**\n * Sets the allowed origins for requests.\n *\n * @param {String} origins\n * @return {Server|Adapter} self when setting or value when getting\n * @api public\n */\n\nServer.prototype.origins = function(v){\n  if (!arguments.length) return this._origins;\n\n  this._origins = v;\n  return this;\n};\n\n/**\n * Attaches socket.io to a server or port.\n *\n * @param {http.Server|Number} server or port\n * @param {Object} options passed to engine.io\n * @return {Server} self\n * @api public\n */\n\nServer.prototype.listen =\nServer.prototype.attach = function(srv, opts){\n  if ('function' == typeof srv) {\n    var msg = 'You are trying to attach socket.io to an express ' +\n    'request handler function. Please pass a http.Server instance.';\n    throw new Error(msg);\n  }\n\n  // handle a port as a string\n  if (Number(srv) == srv) {\n    srv = Number(srv);\n  }\n\n  if ('number' == typeof srv) {\n    debug('creating http server and binding to %d', srv);\n    var port = srv;\n    srv = http.Server(function(req, res){\n      res.writeHead(404);\n      res.end();\n    });\n    srv.listen(port);\n\n  }\n\n  // set engine.io path to `/socket.io`\n  opts = opts || {};\n  opts.path = opts.path || this.path();\n  // set origins verification\n  opts.allowRequest = this.checkRequest.bind(this);\n\n  // initialize engine\n  debug('creating engine.io instance with opts %j', opts);\n  this.eio = engine.attach(srv, opts);\n\n  // attach static file serving\n  if (this._serveClient) this.attachServe(srv);\n\n  // Export http server\n  this.httpServer = srv;\n\n  // bind to engine events\n  this.bind(this.eio);\n\n  return this;\n};\n\n/**\n * Attaches the static file serving.\n *\n * @param {Function|http.Server} http server\n * @api private\n */\n\nServer.prototype.attachServe = function(srv){\n  debug('attaching client serving req handler');\n  var url = this._path + '/socket.io.js';\n  var evs = srv.listeners('request').slice(0);\n  var self = this;\n  srv.removeAllListeners('request');\n  srv.on('request', function(req, res) {\n    if (0 == req.url.indexOf(url)) {\n      self.serve(req, res);\n    } else {\n      for (var i = 0; i < evs.length; i++) {\n        evs[i].call(srv, req, res);\n      }\n    }\n  });\n};\n\n/**\n * Handles a request serving `/socket.io.js`\n *\n * @param {http.Request} req\n * @param {http.Response} res\n * @api private\n */\n\nServer.prototype.serve = function(req, res){\n  var etag = req.headers['if-none-match'];\n  if (etag) {\n    if (clientVersion == etag) {\n      debug('serve client 304');\n      res.writeHead(304);\n      res.end();\n      return;\n    }\n  }\n\n  debug('serve client source');\n  res.setHeader('Content-Type', 'application/javascript');\n  res.setHeader('ETag', clientVersion);\n  res.writeHead(200);\n  res.end(clientSource);\n};\n\n/**\n * Binds socket.io to an engine.io instance.\n *\n * @param {engine.Server} engine.io (or compatible) server\n * @return {Server} self\n * @api public\n */\n\nServer.prototype.bind = function(engine){\n  this.engine = engine;\n  this.engine.on('connection', this.onconnection.bind(this));\n  return this;\n};\n\n/**\n * Called with each incoming transport connection.\n *\n * @param {engine.Socket} socket\n * @return {Server} self\n * @api public\n */\n\nServer.prototype.onconnection = function(conn){\n  debug('incoming connection with id %s', conn.id);\n  var client = new Client(this, conn);\n  client.connect('/');\n  return this;\n};\n\n/**\n * Looks up a namespace.\n *\n * @param {String} nsp name\n * @param {Function} optional, nsp `connection` ev handler\n * @api public\n */\n\nServer.prototype.of = function(name, fn){\n  if (String(name)[0] !== '/') name = '/' + name;\n  \n  if (!this.nsps[name]) {\n    debug('initializing namespace %s', name);\n    var nsp = new Namespace(this, name);\n    this.nsps[name] = nsp;\n  }\n  if (fn) this.nsps[name].on('connect', fn);\n  return this.nsps[name];\n};\n\n/**\n * Closes server connection\n *\n * @api public\n */\n\nServer.prototype.close = function(){\n  this.nsps['/'].sockets.forEach(function(socket){\n    socket.onclose();\n  });\n\n  this.engine.close();\n\n  if(this.httpServer){\n    this.httpServer.close();\n  }\n};\n\n/**\n * Expose main namespace (/).\n */\n\n['on', 'to', 'in', 'use', 'emit', 'send', 'write'].forEach(function(fn){\n  Server.prototype[fn] = function(){\n    var nsp = this.sockets[fn];\n    return nsp.apply(this.sockets, arguments);\n  };\n});\n\nNamespace.flags.forEach(function(flag){\n  Server.prototype.__defineGetter__(flag, function(name){\n    this.flags.push(name);\n    return this;\n  });\n});\n\n/**\n * BC with `io.listen`\n */\n\nServer.listen = Server;\n"]}