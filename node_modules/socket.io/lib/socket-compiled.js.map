{"version":3,"sources":["socket.js"],"names":[],"mappings":"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","file":"socket-compiled.js","sourcesContent":["\n/**\n * Module dependencies.\n */\n\nvar Emitter = require('events').EventEmitter;\nvar parser = require('socket.io-parser');\nvar url = require('url');\nvar debug = require('debug')('socket.io:socket');\nvar hasBin = require('has-binary-data');\n\n/**\n * Module exports.\n */\n\nmodule.exports = exports = Socket;\n\n/**\n * Blacklisted events.\n *\n * @api public\n */\n\nexports.events = [\n  'error',\n  'connect',\n  'disconnect',\n  'newListener',\n  'removeListener'\n];\n\n/**\n * Flags.\n *\n * @api private\n */\n\nvar flags = [\n  'json',\n  'volatile',\n  'broadcast'\n];\n\n/**\n * `EventEmitter#emit` reference.\n */\n\nvar emit = Emitter.prototype.emit;\n\n/**\n * Interface to a `Client` for a given `Namespace`.\n *\n * @param {Namespace} nsp\n * @param {Client} client\n * @api public\n */\n\nfunction Socket(nsp, client){\n  this.nsp = nsp;\n  this.server = nsp.server;\n  this.adapter = this.nsp.adapter;\n  this.id = client.id;\n  this.request = client.request;\n  this.client = client;\n  this.conn = client.conn;\n  this.rooms = [];\n  this.acks = {};\n  this.connected = true;\n  this.disconnected = false;\n  this.handshake = this.buildHandshake();\n}\n\n/**\n * Inherits from `EventEmitter`.\n */\n\nSocket.prototype.__proto__ = Emitter.prototype;\n\n/**\n * Apply flags from `Socket`.\n */\n\nflags.forEach(function(flag){\n  Socket.prototype.__defineGetter__(flag, function(){\n    this.flags = this.flags || {};\n    this.flags[flag] = true;\n    return this;\n  });\n});\n\n/**\n * `request` engine.io shorcut.\n *\n * @api public\n */\n\nSocket.prototype.__defineGetter__('request', function(){\n  return this.conn.request;\n});\n\n/**\n * Builds the `handshake` BC object\n *\n * @api private\n */\n\nSocket.prototype.buildHandshake = function(){\n  return {\n    headers: this.request.headers,\n    time: (new Date) + '',\n    address: this.conn.remoteAddress,\n    xdomain: !!this.request.headers.origin,\n    secure: !!this.request.connection.encrypted,\n    issued: +(new Date),\n    url: this.request.url,\n    query: url.parse(this.request.url, true).query || {}\n  };\n};\n\n/**\n * Emits to this client.\n *\n * @return {Socket} self\n * @api public\n */\n\nSocket.prototype.emit = function(ev){\n  if (~exports.events.indexOf(ev)) {\n    emit.apply(this, arguments);\n  } else {\n    var args = Array.prototype.slice.call(arguments);\n    var packet = {};\n    packet.type = hasBin(args) ? parser.BINARY_EVENT : parser.EVENT;\n    packet.data = args;\n\n    // access last argument to see if it's an ACK callback\n    if ('function' == typeof args[args.length - 1]) {\n      if (this._rooms || (this.flags && this.flags.broadcast)) {\n        throw new Error('Callbacks are not supported when broadcasting');\n      }\n\n      debug('emitting packet with ack id %d', this.nsp.ids);\n      this.acks[this.nsp.ids] = args.pop();\n      packet.id = this.nsp.ids++;\n    }\n\n    if (this._rooms || (this.flags && this.flags.broadcast)) {\n      this.adapter.broadcast(packet, {\n        except: [this.id],\n        rooms: this._rooms,\n        flags: this.flags\n      });\n    } else {\n      // dispatch packet\n      this.packet(packet);\n    }\n\n    // reset flags\n    delete this._rooms;\n    delete this.flags;\n  }\n  return this;\n};\n\n/**\n * Targets a room when broadcasting.\n *\n * @param {String} name\n * @return {Socket} self\n * @api public\n */\n\nSocket.prototype.to =\nSocket.prototype.in = function(name){\n  this._rooms = this._rooms || [];\n  if (!~this._rooms.indexOf(name)) this._rooms.push(name);\n  return this;\n};\n\n/**\n * Sends a `message` event.\n *\n * @return {Socket} self\n * @api public\n */\n\nSocket.prototype.send =\nSocket.prototype.write = function(){\n  var args = Array.prototype.slice.call(arguments);\n  args.unshift('message');\n  this.emit.apply(this, args);\n  return this;\n};\n\n/**\n * Writes a packet.\n *\n * @param {Object} packet object\n * @api private\n */\n\nSocket.prototype.packet = function(packet, preEncoded){\n  packet.nsp = this.nsp.name;\n  var volatile = this.flags && this.flags.volatile;\n  this.client.packet(packet, preEncoded, volatile);\n};\n\n/**\n * Joins a room.\n *\n * @param {String} room\n * @param {Function} optional, callback\n * @return {Socket} self\n * @api private\n */\n\nSocket.prototype.join = function(room, fn){\n  debug('joining room %s', room);\n  var self = this;\n  if (~this.rooms.indexOf(room)) return this;\n  this.adapter.add(this.id, room, function(err){\n    if (err) return fn && fn(err);\n    debug('joined room %s', room);\n    self.rooms.push(room);\n    fn && fn(null);\n  });\n  return this;\n};\n\n/**\n * Leaves a room.\n *\n * @param {String} room\n * @param {Function} optional, callback\n * @return {Socket} self\n * @api private\n */\n\nSocket.prototype.leave = function(room, fn){\n  debug('leave room %s', room);\n  var self = this;\n  this.adapter.del(this.id, room, function(err){\n    if (err) return fn && fn(err);\n    debug('left room %s', room);\n    var idx = self.rooms.indexOf(room);\n    if (idx >= 0) {\n      self.rooms.splice(idx, 1);\n    }\n    fn && fn(null);\n  });\n  return this;\n};\n\n/**\n * Leave all rooms.\n *\n * @api private\n */\n\nSocket.prototype.leaveAll = function(){\n  this.adapter.delAll(this.id);\n  this.rooms = [];\n};\n\n/**\n * Called by `Namespace` upon succesful\n * middleware execution (ie: authorization).\n *\n * @api private\n */\n\nSocket.prototype.onconnect = function(){\n  debug('socket connected - writing packet');\n  this.join(this.id);\n  this.packet({ type: parser.CONNECT });\n  this.nsp.connected[this.id] = this;\n};\n\n/**\n * Called with each packet. Called by `Client`.\n *\n * @param {Object} packet\n * @api private\n */\n\nSocket.prototype.onpacket = function(packet){\n  debug('got packet %j', packet);\n  switch (packet.type) {\n    case parser.EVENT:\n      this.onevent(packet);\n      break;\n\n    case parser.BINARY_EVENT:\n      this.onevent(packet);\n      break;\n\n    case parser.ACK:\n      this.onack(packet);\n      break;\n\n    case parser.BINARY_ACK:\n      this.onack(packet);\n      break;\n\n    case parser.DISCONNECT:\n      this.ondisconnect();\n      break;\n\n    case parser.ERROR:\n      this.emit('error', packet.data);\n  }\n};\n\n/**\n * Called upon event packet.\n *\n * @param {Object} packet object\n * @api private\n */\n\nSocket.prototype.onevent = function(packet){\n  var args = packet.data || [];\n  debug('emitting event %j', args);\n\n  if (null != packet.id) {\n    debug('attaching ack callback to event');\n    args.push(this.ack(packet.id));\n  }\n\n  emit.apply(this, args);\n};\n\n/**\n * Produces an ack callback to emit with an event.\n *\n * @param {Number} packet id\n * @api private\n */\n\nSocket.prototype.ack = function(id){\n  var self = this;\n  var sent = false;\n  return function(){\n    // prevent double callbacks\n    if (sent) return;\n    var args = Array.prototype.slice.call(arguments);\n    debug('sending ack %j', args);\n\n    var type = hasBin(args) ? parser.BINARY_ACK : parser.ACK;\n    self.packet({\n      id: id,\n      type: type,\n      data: args\n    });\n  };\n};\n\n/**\n * Called upon ack packet.\n *\n * @api private\n */\n\nSocket.prototype.onack = function(packet){\n  var ack = this.acks[packet.id];\n  if ('function' == typeof ack) {\n    debug('calling ack %s with %j', packet.id, packet.data);\n    ack.apply(this, packet.data);\n    delete this.acks[packet.id];\n  } else {\n    debug('bad ack %s', packet.id);\n  }\n};\n\n/**\n * Called upon client disconnect packet.\n *\n * @api private\n */\n\nSocket.prototype.ondisconnect = function(){\n  debug('got disconnect packet');\n  this.onclose('client namespace disconnect');\n};\n\n/**\n * Handles a client error.\n *\n * @api private\n */\n\nSocket.prototype.onerror = function(err){\n  if (this.listeners('error').length) {\n    this.emit('error', err);\n  } else {\n    console.error('Missing error handler on `socket`.');\n    console.error(err.stack);\n  }\n};\n\n/**\n * Called upon closing. Called by `Client`.\n *\n * @param {String} reason\n * @param {Error} optional error object\n * @api private\n */\n\nSocket.prototype.onclose = function(reason){\n  if (!this.connected) return this;\n  debug('closing socket - reason %s', reason);\n  this.leaveAll();\n  this.nsp.remove(this);\n  this.client.remove(this);\n  this.connected = false;\n  this.disconnected = true;\n  delete this.nsp.connected[this.id];\n  this.emit('disconnect', reason);\n};\n\n/**\n * Produces an `error` packet.\n *\n * @param {Object} error object\n * @api private\n */\n\nSocket.prototype.error = function(err){\n  this.packet({ type: parser.ERROR, data: err });\n};\n\n/**\n * Disconnects this client.\n *\n * @param {Boolean} if `true`, closes the underlying connection\n * @return {Socket} self\n * @api public\n */\n\nSocket.prototype.disconnect = function(close){\n  if (!this.connected) return this;\n  if (close) {\n    this.client.disconnect();\n  } else {\n    this.packet({ type: parser.DISCONNECT });\n    this.onclose('server namespace disconnect');\n  }\n  return this;\n};\n"]}