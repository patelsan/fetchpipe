{"version":3,"sources":["BufferPool.js"],"names":[],"mappings":"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","file":"BufferPool-compiled.js","sourcesContent":["/*!\n * ws: a node.js websocket client\n * Copyright(c) 2011 Einar Otto Stangvik <einaros@gmail.com>\n * MIT Licensed\n */\n\nvar util = require('util');\n\nfunction BufferPool(initialSize, growStrategy, shrinkStrategy) {\n  if (this instanceof BufferPool === false) {\n    throw new TypeError(\"Classes can't be function-called\");\n  }\n\n  if (typeof initialSize === 'function') {\n    shrinkStrategy = growStrategy;\n    growStrategy = initialSize;\n    initialSize = 0;\n  }\n  else if (typeof initialSize === 'undefined') {\n    initialSize = 0;\n  }\n  this._growStrategy = (growStrategy || function(db, size) {\n    return db.used + size;\n  }).bind(null, this);\n  this._shrinkStrategy = (shrinkStrategy || function(db) {\n    return initialSize;\n  }).bind(null, this);\n  this._buffer = initialSize ? new Buffer(initialSize) : null;\n  this._offset = 0;\n  this._used = 0;\n  this._changeFactor = 0;\n  this.__defineGetter__('size', function(){\n    return this._buffer == null ? 0 : this._buffer.length;\n  });\n  this.__defineGetter__('used', function(){\n    return this._used;\n  });\n}\n\nBufferPool.prototype.get = function(length) {\n  if (this._buffer == null || this._offset + length > this._buffer.length) {\n    var newBuf = new Buffer(this._growStrategy(length));\n    this._buffer = newBuf;\n    this._offset = 0;\n  }\n  this._used += length;\n  var buf = this._buffer.slice(this._offset, this._offset + length);\n  this._offset += length;\n  return buf;\n}\n\nBufferPool.prototype.reset = function(forceNewBuffer) {\n  var len = this._shrinkStrategy();\n  if (len < this.size) this._changeFactor -= 1;\n  if (forceNewBuffer || this._changeFactor < -2) {\n    this._changeFactor = 0;\n    this._buffer = len ? new Buffer(len) : null;\n  }\n  this._offset = 0;\n  this._used = 0;\n}\n\nmodule.exports = BufferPool;\n"]}