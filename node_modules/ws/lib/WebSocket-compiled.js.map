{"version":3,"sources":["WebSocket.js"],"names":[],"mappings":"AAAA,YAAY,CAAC;;;;;;;;AAQb,IAAI,GAAG,GAAG,OAAO,CAAC,KAAK,CAAC;IACpB,IAAI,GAAG,OAAO,CAAC,MAAM,CAAC;IACtB,IAAI,GAAG,OAAO,CAAC,MAAM,CAAC;IACtB,KAAK,GAAG,OAAO,CAAC,OAAO,CAAC;IACxB,MAAM,GAAG,OAAO,CAAC,QAAQ,CAAC;IAC1B,MAAM,GAAG,OAAO,CAAC,QAAQ,CAAC;IAC1B,MAAM,GAAG,OAAO,CAAC,QAAQ,CAAC;IAC1B,OAAO,GAAG,OAAO,CAAC,SAAS,CAAC;IAC5B,MAAM,GAAG,OAAO,CAAC,UAAU,CAAC;IAC5B,QAAQ,GAAG,OAAO,CAAC,YAAY,CAAC;IAChC,WAAW,GAAG,OAAO,CAAC,gBAAgB,CAAC;IACvC,aAAa,GAAG,OAAO,CAAC,kBAAkB,CAAC;IAC3C,UAAU,GAAG,OAAO,CAAC,cAAc,CAAC;IACpC,iBAAiB,GAAG,OAAO,CAAC,qBAAqB,CAAC;IAClD,YAAY,GAAG,OAAO,CAAC,QAAQ,CAAC,CAAC,YAAY,CAAC;;;;;;;;AAQlD,IAAI,eAAe,GAAG,EAAE,CAAC;;;;AAIzB,IAAI,YAAY,GAAG,EAAE,GAAG,IAAI,CAAC;;;;;;;;;;;AAW7B,SAAS,SAAS,CAAC,OAAO,EAAE,SAAS,EAAE,OAAO,EAAE;AAC9C,MAAI,IAAI,YAAY,SAAS,KAAK,KAAK,EAAE;AACvC,UAAM,IAAI,SAAS,CAAC,kCAAkC,CAAC,CAAC;GACzD;;AAED,cAAY,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;;AAExB,MAAI,SAAS,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,SAAS,CAAC,IAAI,QAAQ,KAAK,OAAO,SAAS,EAAE;;AAE3E,WAAO,GAAG,SAAS,CAAC;AACpB,aAAS,GAAG,IAAI,CAAC;GAClB;;AAED,MAAI,QAAQ,KAAK,OAAO,SAAS,EAAE;AACjC,aAAS,GAAG,CAAE,SAAS,CAAE,CAAC;GAC3B;;AAED,MAAI,CAAC,KAAK,CAAC,OAAO,CAAC,SAAS,CAAC,EAAE;AAC7B,aAAS,GAAG,EAAE,CAAC;GAChB;;AAED,MAAI,CAAC,OAAO,GAAG,IAAI,CAAC;AACpB,MAAI,CAAC,OAAO,GAAG,IAAI,CAAC;AACpB,MAAI,CAAC,cAAc,GAAG,KAAK,CAAC;AAC5B,MAAI,CAAC,aAAa,GAAG,CAAC,CAAC;AACvB,MAAI,CAAC,UAAU,GAAG,IAAI,CAAC;AACvB,MAAI,CAAC,QAAQ,GAAG,EAAE,CAAC;AACnB,MAAI,CAAC,UAAU,GAAG,EAAE,CAAC;;AAErB,MAAI,KAAK,CAAC,OAAO,CAAC,OAAO,CAAC,EAAE;AAC1B,sBAAkB,CAAC,KAAK,CAAC,IAAI,EAAE,OAAO,CAAC,MAAM,CAAC,OAAO,CAAC,CAAC,CAAC;GACzD,MAAM;AACL,gBAAY,CAAC,KAAK,CAAC,IAAI,EAAE,CAAC,OAAO,EAAE,SAAS,EAAE,OAAO,CAAC,CAAC,CAAC;GACzD;CACF;;;;;AAKD,IAAI,CAAC,QAAQ,CAAC,SAAS,EAAE,YAAY,CAAC,CAAC;;;;;AAKvC,CAAC,YAAY,EAAE,MAAM,EAAE,SAAS,EAAE,QAAQ,CAAC,CAAC,OAAO,CAAC,SAAS,IAAI,CAAC,KAAK,EAAE,KAAK,EAAE;AAC5E,WAAS,CAAC,SAAS,CAAC,KAAK,CAAC,GAAG,SAAS,CAAC,KAAK,CAAC,GAAG,KAAK,CAAC;CACzD,CAAC,CAAC;;;;;;;;AAQH,SAAS,CAAC,SAAS,CAAC,KAAK,GAAG,SAAS,KAAK,CAAC,IAAI,EAAE,IAAI,EAAE;AACrD,MAAI,IAAI,CAAC,UAAU,KAAK,SAAS,CAAC,MAAM,EAAE,OAAO;;AAEjD,MAAI,IAAI,CAAC,UAAU,KAAK,SAAS,CAAC,UAAU,EAAE;AAC5C,QAAI,CAAC,UAAU,GAAG,SAAS,CAAC,MAAM,CAAC;AACnC,WAAO;GACR;;AAED,MAAI,IAAI,CAAC,UAAU,KAAK,SAAS,CAAC,OAAO,EAAE;AACzC,QAAI,IAAI,CAAC,cAAc,IAAI,IAAI,CAAC,SAAS,EAAE;AACzC,UAAI,CAAC,SAAS,EAAE,CAAC;KAClB;AACD,WAAO;GACR;;AAED,MAAI,IAAI,GAAG,IAAI,CAAC;AAChB,MAAI;AACF,QAAI,CAAC,UAAU,GAAG,SAAS,CAAC,OAAO,CAAC;AACpC,QAAI,CAAC,UAAU,GAAG,IAAI,CAAC;AACvB,QAAI,CAAC,aAAa,GAAG,IAAI,CAAC;AAC1B,QAAI,IAAI,GAAG,CAAC,IAAI,CAAC,SAAS,CAAC;AAC3B,QAAI,CAAC,OAAO,CAAC,KAAK,CAAC,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,UAAS,GAAG,EAAE;AACjD,UAAI,GAAG,EAAE,IAAI,CAAC,IAAI,CAAC,OAAO,EAAE,GAAG,CAAC,CAAC;;AAEjC,UAAI,IAAI,CAAC,cAAc,IAAI,IAAI,CAAC,SAAS,EAAE;AACzC,YAAI,CAAC,SAAS,EAAE,CAAC;OAClB,MAAM;;AAEL,oBAAY,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC;AAC/B,YAAI,CAAC,WAAW,GAAG,UAAU,CAAC,yBAAyB,CAAC,IAAI,CAAC,IAAI,EAAE,IAAI,CAAC,EAAE,YAAY,CAAC,CAAC;OACzF;KACF,CAAC,CAAC;GACJ,CAAC,OAAO,CAAC,EAAE;AACV,QAAI,CAAC,IAAI,CAAC,OAAO,EAAE,CAAC,CAAC,CAAC;GACvB;CACF,CAAC;;;;;;;AAOF,SAAS,CAAC,SAAS,CAAC,KAAK,GAAG,SAAS,MAAM,GAAG;AAC5C,MAAI,IAAI,CAAC,UAAU,KAAK,SAAS,CAAC,IAAI,EAAE,MAAM,IAAI,KAAK,CAAC,YAAY,CAAC,CAAC;;AAEtE,SAAO,IAAI,CAAC,OAAO,CAAC,KAAK,EAAE,CAAC;CAC7B,CAAC;;;;;;;;;;AAUF,SAAS,CAAC,SAAS,CAAC,IAAI,GAAG,SAAS,IAAI,CAAC,IAAI,EAAE,OAAO,EAAE,kBAAkB,EAAE;AAC1E,MAAI,IAAI,CAAC,UAAU,KAAK,SAAS,CAAC,IAAI,EAAE;AACtC,QAAI,kBAAkB,KAAK,IAAI,EAAE,OAAO;AACxC,UAAM,IAAI,KAAK,CAAC,YAAY,CAAC,CAAC;GAC/B;;AAED,SAAO,GAAG,OAAO,IAAI,EAAE,CAAC;;AAExB,MAAI,OAAO,OAAO,CAAC,IAAI,KAAK,WAAW,EAAE,OAAO,CAAC,IAAI,GAAG,CAAC,IAAI,CAAC,SAAS,CAAC;;AAExE,MAAI,CAAC,OAAO,CAAC,IAAI,CAAC,IAAI,EAAE,OAAO,CAAC,CAAC;CAClC,CAAC;;;;;;;;;;AAUF,SAAS,CAAC,SAAS,CAAC,IAAI,GAAG,UAAS,IAAI,EAAE,OAAO,EAAE,kBAAkB,EAAE;AACrE,MAAI,IAAI,CAAC,UAAU,KAAK,SAAS,CAAC,IAAI,EAAE;AACtC,QAAI,kBAAkB,KAAK,IAAI,EAAE,OAAO;AACxC,UAAM,IAAI,KAAK,CAAC,YAAY,CAAC,CAAC;GAC/B;;AAED,SAAO,GAAG,OAAO,IAAI,EAAE,CAAC;;AAExB,MAAI,OAAO,OAAO,CAAC,IAAI,KAAK,WAAW,EAAE,OAAO,CAAC,IAAI,GAAG,CAAC,IAAI,CAAC,SAAS,CAAC;;AAExE,MAAI,CAAC,OAAO,CAAC,IAAI,CAAC,IAAI,EAAE,OAAO,CAAC,CAAC;CAClC,CAAC;;;;;;;AAOF,SAAS,CAAC,SAAS,CAAC,MAAM,GAAG,SAAS,MAAM,GAAG;AAC7C,MAAI,IAAI,CAAC,UAAU,KAAK,SAAS,CAAC,IAAI,EAAE,MAAM,IAAI,KAAK,CAAC,YAAY,CAAC,CAAC;;AAEtE,SAAO,IAAI,CAAC,OAAO,CAAC,MAAM,EAAE,CAAC;CAC9B,CAAC;;;;;;;;;;;AAWF,SAAS,CAAC,SAAS,CAAC,IAAI,GAAG,SAAS,IAAI,CAAC,IAAI,EAAE,OAAO,EAAE,EAAE,EAAE;AAC1D,MAAI,OAAO,OAAO,KAAK,UAAU,EAAE;AACjC,MAAE,GAAG,OAAO,CAAC;AACb,WAAO,GAAG,EAAE,CAAC;GACd;;AAED,MAAI,IAAI,CAAC,UAAU,KAAK,SAAS,CAAC,IAAI,EAAE;AACtC,QAAI,OAAO,EAAE,KAAK,UAAU,EAAE,EAAE,CAAC,IAAI,KAAK,CAAC,YAAY,CAAC,CAAC,CAAC,KACrD,MAAM,IAAI,KAAK,CAAC,YAAY,CAAC,CAAC;AACnC,WAAO;GACR;;AAED,MAAI,CAAC,IAAI,EAAE,IAAI,GAAG,EAAE,CAAC;AACrB,MAAI,IAAI,CAAC,MAAM,EAAE;AACf,QAAI,IAAI,GAAG,IAAI,CAAC;AAChB,QAAI,CAAC,MAAM,CAAC,IAAI,CAAC,YAAW;AAAE,UAAI,CAAC,IAAI,CAAC,IAAI,EAAE,OAAO,EAAE,EAAE,CAAC,CAAC;KAAE,CAAC,CAAC;AAC/D,WAAO;GACR;;AAED,SAAO,GAAG,OAAO,IAAI,EAAE,CAAC;AACxB,SAAO,CAAC,GAAG,GAAG,IAAI,CAAC;;AAEnB,MAAI,OAAO,OAAO,CAAC,MAAM,KAAK,WAAW,EAAE;AACzC,WAAO,CAAC,MAAM,GAAI,IAAI,YAAY,WAAW,IAAI,IAAI,YAAY,MAAM,IACrE,IAAI,YAAY,UAAU,IAC1B,IAAI,YAAY,WAAW,IAC3B,IAAI,YAAY,WAAW,IAC3B,IAAI,YAAY,SAAS,IACzB,IAAI,YAAY,UAAU,IAC1B,IAAI,YAAY,UAAU,IAC1B,IAAI,YAAY,YAAY,IAC5B,IAAI,YAAY,YAAY,AAAC,CAAC;GACjC;;AAED,MAAI,OAAO,OAAO,CAAC,IAAI,KAAK,WAAW,EAAE,OAAO,CAAC,IAAI,GAAG,CAAC,IAAI,CAAC,SAAS,CAAC;AACxE,MAAI,OAAO,OAAO,CAAC,QAAQ,KAAK,WAAW,EAAE,OAAO,CAAC,QAAQ,GAAG,IAAI,CAAC;AACrE,MAAI,CAAC,IAAI,CAAC,UAAU,CAAC,iBAAiB,CAAC,aAAa,CAAC,EAAE;AACrD,WAAO,CAAC,QAAQ,GAAG,KAAK,CAAC;GAC1B;;AAED,MAAI,QAAQ,GAAG,OAAO,MAAM,CAAC,QAAQ,KAAK,UAAU,GAChD,MAAM,CAAC,QAAQ,GACf,MAAM,CAAC,MAAM,CAAC;;AAElB,MAAI,IAAI,YAAY,QAAQ,EAAE;AAC5B,cAAU,CAAC,IAAI,CAAC,CAAC;AACjB,QAAI,IAAI,GAAG,IAAI,CAAC;;AAEhB,cAAU,CAAC,IAAI,EAAE,IAAI,EAAE,OAAO,EAAE,SAAS,IAAI,CAAC,KAAK,EAAE;AACnD,aAAO,CAAC,QAAQ,CAAC,SAAS,IAAI,GAAG;AAC/B,yBAAiB,CAAC,IAAI,CAAC,CAAC;OACzB,CAAC,CAAC;;AAEH,UAAI,OAAO,EAAE,KAAK,UAAU,EAAE,EAAE,CAAC,KAAK,CAAC,CAAC;KACzC,CAAC,CAAC;GACJ,MAAM;AACL,QAAI,CAAC,OAAO,CAAC,IAAI,CAAC,IAAI,EAAE,OAAO,EAAE,EAAE,CAAC,CAAC;GACtC;CACF,CAAC;;;;;;;;;AASF,SAAS,CAAC,SAAS,CAAC,MAAM,GAAG,SAAS,MAAM,CAAC,OAAO,EAAE,EAAE,EAAE;AACxD,MAAI,OAAO,OAAO,KAAK,UAAU,EAAE;AACjC,MAAE,GAAG,OAAO,CAAC;AACb,WAAO,GAAG,EAAE,CAAC;GACd;;AAED,MAAI,IAAI,GAAG,IAAI,CAAC;;AAEhB,MAAI,OAAO,EAAE,KAAK,UAAU,EAAE,MAAM,IAAI,KAAK,CAAC,2BAA2B,CAAC,CAAC;;AAE3E,MAAI,IAAI,CAAC,UAAU,KAAK,SAAS,CAAC,IAAI,EAAE;AACtC,QAAI,OAAO,EAAE,KAAK,UAAU,EAAE,EAAE,CAAC,IAAI,KAAK,CAAC,YAAY,CAAC,CAAC,CAAC,KACrD,MAAM,IAAI,KAAK,CAAC,YAAY,CAAC,CAAC;AACnC,WAAO;GACR;;AAED,MAAI,IAAI,CAAC,MAAM,EAAE;AACf,QAAI,CAAC,MAAM,CAAC,IAAI,CAAC,YAAY;AAAE,UAAI,CAAC,MAAM,CAAC,OAAO,EAAE,EAAE,CAAC,CAAC;KAAE,CAAC,CAAC;AAC5D,WAAO;GACR;;AAED,SAAO,GAAG,OAAO,IAAI,EAAE,CAAC;;AAExB,MAAI,OAAO,OAAO,CAAC,IAAI,KAAK,WAAW,EAAE,OAAO,CAAC,IAAI,GAAG,CAAC,IAAI,CAAC,SAAS,CAAC;AACxE,MAAI,OAAO,OAAO,CAAC,QAAQ,KAAK,WAAW,EAAE,OAAO,CAAC,QAAQ,GAAG,IAAI,CAAC;AACrE,MAAI,CAAC,IAAI,CAAC,UAAU,CAAC,iBAAiB,CAAC,aAAa,CAAC,EAAE;AACrD,WAAO,CAAC,QAAQ,GAAG,KAAK,CAAC;GAC1B;;AAED,YAAU,CAAC,IAAI,CAAC,CAAC;;AAEjB,WAAS,IAAI,CAAC,IAAI,EAAE,KAAK,EAAE;AACzB,QAAI;AACF,UAAI,IAAI,CAAC,UAAU,KAAK,SAAS,CAAC,IAAI,EAAE,MAAM,IAAI,KAAK,CAAC,YAAY,CAAC,CAAC;AACtE,aAAO,CAAC,GAAG,GAAG,KAAK,KAAK,IAAI,CAAC;AAC7B,UAAI,CAAC,OAAO,CAAC,IAAI,CAAC,IAAI,EAAE,OAAO,CAAC,CAAC;AACjC,UAAI,CAAC,KAAK,EAAE,OAAO,CAAC,QAAQ,CAAC,EAAE,CAAC,IAAI,CAAC,IAAI,EAAE,IAAI,EAAE,IAAI,CAAC,CAAC,CAAC,KACnD,iBAAiB,CAAC,IAAI,CAAC,CAAC;KAC9B,CAAC,OAAO,CAAC,EAAE;AACV,UAAI,OAAO,EAAE,KAAK,UAAU,EAAE,EAAE,CAAC,CAAC,CAAC,CAAC,KAC/B;AACH,eAAO,IAAI,CAAC,MAAM,CAAC;AACnB,YAAI,CAAC,IAAI,CAAC,OAAO,EAAE,CAAC,CAAC,CAAC;OACvB;KACF;GACF;;AAED,SAAO,CAAC,QAAQ,CAAC,EAAE,CAAC,IAAI,CAAC,IAAI,EAAE,IAAI,EAAE,IAAI,CAAC,CAAC,CAAC;CAC7C,CAAC;;;;;;;AAOF,SAAS,CAAC,SAAS,CAAC,SAAS,GAAG,SAAS,SAAS,GAAG;AACnD,MAAI,IAAI,CAAC,UAAU,KAAK,SAAS,CAAC,MAAM,EAAE,OAAO;;AAEjD,MAAI,IAAI,CAAC,OAAO,EAAE;AAChB,QAAI,CAAC,UAAU,GAAG,SAAS,CAAC,OAAO,CAAC;;;AAGpC,QAAI;AAAE,UAAI,CAAC,OAAO,CAAC,GAAG,EAAE,CAAC;KAAE,CAC3B,OAAO,CAAC,EAAE;;AAER,+BAAyB,CAAC,IAAI,CAAC,IAAI,EAAE,IAAI,CAAC,CAAC;AAC3C,aAAO;KACR;;;;;;;;AAQD,QAAI,IAAI,CAAC,WAAW,EAAE;AAAE,kBAAY,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC;KAAE;AACzD,QAAI,CAAC,WAAW,GAAG,UAAU,CAAC,yBAAyB,CAAC,IAAI,CAAC,IAAI,EAAE,IAAI,CAAC,EAAE,YAAY,CAAC,CAAC;GACzF,MAAM,IAAI,IAAI,CAAC,UAAU,KAAK,SAAS,CAAC,UAAU,EAAE;AACnD,6BAAyB,CAAC,IAAI,CAAC,IAAI,EAAE,IAAI,CAAC,CAAC;GAC5C;CACF,CAAC;;;;;;;AAOF,MAAM,CAAC,cAAc,CAAC,SAAS,CAAC,SAAS,EAAE,gBAAgB,EAAE;AAC3D,KAAG,EAAE,SAAS,GAAG,GAAG;AAClB,QAAI,MAAM,GAAG,CAAC,CAAC;AACf,QAAI,IAAI,CAAC,OAAO,EAAE;AAChB,YAAM,GAAG,IAAI,CAAC,OAAO,CAAC,UAAU,IAAI,CAAC,CAAC;KACvC;AACD,WAAO,MAAM,CAAC;GACf;CACF,CAAC,CAAC;;;;;;;;AAQH,CAAC,MAAM,EAAE,OAAO,EAAE,OAAO,EAAE,SAAS,CAAC,CAAC,OAAO,CAAC,UAAS,MAAM,EAAE;AAC7D,QAAM,CAAC,cAAc,CAAC,SAAS,CAAC,SAAS,EAAE,IAAI,GAAG,MAAM,EAAE;;;;;;;AAOxD,OAAG,EAAE,SAAS,GAAG,GAAG;AAClB,UAAI,QAAQ,GAAG,IAAI,CAAC,SAAS,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC;AACzC,aAAO,QAAQ,GAAI,QAAQ,CAAC,SAAS,GAAG,QAAQ,CAAC,SAAS,GAAG,QAAQ,GAAI,SAAS,CAAC;KACpF;;;;;;;;;AASD,OAAG,EAAE,SAAS,GAAG,CAAC,QAAQ,EAAE;AAC1B,UAAI,CAAC,kBAAkB,CAAC,MAAM,CAAC,CAAC;AAChC,UAAI,CAAC,gBAAgB,CAAC,MAAM,EAAE,QAAQ,CAAC,CAAC;KACzC;GACF,CAAC,CAAC;CACJ,CAAC,CAAC;;;;;;;;;AASH,SAAS,CAAC,SAAS,CAAC,gBAAgB,GAAG,UAAS,MAAM,EAAE,QAAQ,EAAE;AAChE,MAAI,MAAM,GAAG,IAAI,CAAC;;AAElB,WAAS,SAAS,CAAE,IAAI,EAAE,KAAK,EAAE;AAC/B,YAAQ,CAAC,IAAI,CAAC,MAAM,EAAE,IAAI,YAAY,CAAC,IAAI,EAAE,CAAC,CAAC,KAAK,CAAC,MAAM,EAAE,MAAM,CAAC,CAAC,CAAC;GACvE;;AAED,WAAS,OAAO,CAAE,IAAI,EAAE,OAAO,EAAE;AAC/B,YAAQ,CAAC,IAAI,CAAC,MAAM,EAAE,IAAI,UAAU,CAAC,IAAI,EAAE,OAAO,EAAE,MAAM,CAAC,CAAC,CAAC;GAC9D;;AAED,WAAS,OAAO,CAAE,KAAK,EAAE;AACvB,SAAK,CAAC,IAAI,GAAG,OAAO,CAAC;AACrB,SAAK,CAAC,MAAM,GAAG,MAAM,CAAC;AACtB,YAAQ,CAAC,IAAI,CAAC,MAAM,EAAE,KAAK,CAAC,CAAC;GAC9B;;AAED,WAAS,MAAM,GAAI;AACjB,YAAQ,CAAC,IAAI,CAAC,MAAM,EAAE,IAAI,SAAS,CAAC,MAAM,CAAC,CAAC,CAAC;GAC9C;;AAED,MAAI,OAAO,QAAQ,KAAK,UAAU,EAAE;AAClC,QAAI,MAAM,KAAK,SAAS,EAAE;;;AAGxB,eAAS,CAAC,SAAS,GAAG,QAAQ,CAAC;AAC/B,UAAI,CAAC,EAAE,CAAC,MAAM,EAAE,SAAS,CAAC,CAAC;KAC5B,MAAM,IAAI,MAAM,KAAK,OAAO,EAAE;;;AAG7B,aAAO,CAAC,SAAS,GAAG,QAAQ,CAAC;AAC7B,UAAI,CAAC,EAAE,CAAC,MAAM,EAAE,OAAO,CAAC,CAAC;KAC1B,MAAM,IAAI,MAAM,KAAK,OAAO,EAAE;;;AAG7B,aAAO,CAAC,SAAS,GAAG,QAAQ,CAAC;AAC7B,UAAI,CAAC,EAAE,CAAC,MAAM,EAAE,OAAO,CAAC,CAAC;KAC1B,MAAM,IAAI,MAAM,KAAK,MAAM,EAAE;;;AAG5B,YAAM,CAAC,SAAS,GAAG,QAAQ,CAAC;AAC5B,UAAI,CAAC,EAAE,CAAC,MAAM,EAAE,MAAM,CAAC,CAAC;KACzB,MAAM;AACL,UAAI,CAAC,EAAE,CAAC,MAAM,EAAE,QAAQ,CAAC,CAAC;KAC3B;GACF;CACF,CAAC;;AAEF,MAAM,CAAC,OAAO,GAAG,SAAS,CAAC;AAC3B,MAAM,CAAC,OAAO,CAAC,eAAe,GAAG,eAAe,CAAA;;;;;;;;;AAShD,SAAS,YAAY,CAAC,OAAO,EAAE,QAAQ,EAAE,MAAM,EAAE;AAC/C,MAAI,CAAC,IAAI,GAAG,SAAS,CAAC;AACtB,MAAI,CAAC,IAAI,GAAG,OAAO,CAAC;AACpB,MAAI,CAAC,MAAM,GAAG,MAAM,CAAC;AACrB,MAAI,CAAC,MAAM,GAAG,QAAQ,CAAC;CACxB;;;;;;;;;AASD,SAAS,UAAU,CAAC,IAAI,EAAE,MAAM,EAAE,MAAM,EAAE;AACxC,MAAI,CAAC,IAAI,GAAG,OAAO,CAAC;AACpB,MAAI,CAAC,QAAQ,GAAI,OAAO,IAAI,KAAK,WAAW,IAAI,IAAI,KAAK,IAAI,AAAC,CAAC;AAC/D,MAAI,CAAC,IAAI,GAAG,IAAI,CAAC;AACjB,MAAI,CAAC,MAAM,GAAG,MAAM,CAAC;AACrB,MAAI,CAAC,MAAM,GAAG,MAAM,CAAC;CACtB;;;;;;;;;AASD,SAAS,SAAS,CAAC,MAAM,EAAE;AACzB,MAAI,CAAC,IAAI,GAAG,MAAM,CAAC;AACnB,MAAI,CAAC,MAAM,GAAG,MAAM,CAAC;CACtB;;;;AAID,SAAS,eAAe,CAAC,QAAQ,EAAE,QAAQ,EAAE,IAAI,EAAE;AACjD,MAAI,UAAU,GAAG,QAAQ,CAAC;AAC1B,MAAI,QAAQ,EAAE;AACZ,QAAI,AAAC,QAAQ,IAAK,IAAI,IAAI,GAAG,AAAC,IAAM,CAAC,QAAQ,IAAK,IAAI,IAAI,EAAE,AAAC,AAAC,EAAC;AAC7D,gBAAU,GAAG,UAAU,GAAG,GAAG,GAAG,IAAI,CAAC;KACtC;GACF;AACD,SAAO,UAAU,CAAC;CACnB;;;;;;AAMD,SAAS,kBAAkB,CAAC,GAAG,EAAE,MAAM,EAAE,WAAW,EAAE,OAAO,EAAE;AAC7D,SAAO,GAAG,IAAI,OAAO,CAAC;AACpB,mBAAe,EAAE,eAAe;AAChC,YAAQ,EAAE,IAAI;AACd,cAAU,EAAE,EAAE;GACf,CAAC,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC;;;AAGlB,MAAI,CAAC,QAAQ,GAAG,OAAO,CAAC,KAAK,CAAC,QAAQ,CAAC;AACvC,MAAI,CAAC,eAAe,GAAG,OAAO,CAAC,KAAK,CAAC,eAAe,CAAC;AACrD,MAAI,CAAC,UAAU,GAAG,OAAO,CAAC,KAAK,CAAC,UAAU,CAAC;AAC3C,MAAI,CAAC,QAAQ,CAAC,MAAM,GAAI,IAAI,CAAC,eAAe,KAAK,UAAU,AAAC,CAAC;AAC7D,MAAI,CAAC,UAAU,GAAG,GAAG,CAAC;AACtB,MAAI,CAAC,UAAU,GAAG,SAAS,CAAC,UAAU,CAAC;AACvC,MAAI,CAAC,SAAS,GAAG,IAAI,CAAC;;;AAGtB,MAAI,OAAO,CAAC,KAAK,CAAC,eAAe,KAAK,UAAU,EAAE;AAChD,uBAAmB,CAAC,IAAI,CAAC,IAAI,EAAE,aAAa,EAAE,WAAW,EAAE,MAAM,EAAE,WAAW,CAAC,CAAC;GACjF,MAAM;AACL,uBAAmB,CAAC,IAAI,CAAC,IAAI,EAAE,QAAQ,EAAE,MAAM,EAAE,MAAM,EAAE,WAAW,CAAC,CAAC;GACvE;CACF;;AAED,SAAS,YAAY,CAAC,OAAO,EAAE,SAAS,EAAE,OAAO,EAAE;AACjD,SAAO,GAAG,IAAI,OAAO,CAAC;AACpB,UAAM,EAAE,IAAI;AACZ,mBAAe,EAAE,eAAe;AAChC,QAAI,EAAE,IAAI;AACV,WAAO,EAAE,IAAI;AACb,YAAQ,EAAE,SAAS,CAAC,IAAI,CAAC,GAAG,CAAC;AAC7B,SAAK,EAAE,IAAI;;;AAGX,OAAG,EAAE,IAAI;AACT,OAAG,EAAE,IAAI;AACT,cAAU,EAAE,IAAI;AAChB,QAAI,EAAE,IAAI;AACV,MAAE,EAAE,IAAI;AACR,WAAO,EAAE,IAAI;AACb,sBAAkB,EAAE,IAAI;AACxB,qBAAiB,EAAE,IAAI;AACvB,gBAAY,EAAE,IAAI;GACnB,CAAC,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC;;AAElB,MAAI,OAAO,CAAC,KAAK,CAAC,eAAe,KAAK,CAAC,IAAI,OAAO,CAAC,KAAK,CAAC,eAAe,KAAK,EAAE,EAAE;AAC/E,UAAM,IAAI,KAAK,CAAC,8BAA8B,CAAC,CAAC;GACjD;;;AAGD,MAAI,SAAS,GAAG,GAAG,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC;AACnC,MAAI,YAAY,GAAG,SAAS,CAAC,QAAQ,KAAK,UAAU,CAAC;AACrD,MAAI,CAAC,SAAS,CAAC,IAAI,IAAI,CAAC,YAAY,EAAE,MAAM,IAAI,KAAK,CAAC,aAAa,CAAC,CAAC;AACrE,MAAI,QAAQ,GAAG,SAAS,CAAC,QAAQ,KAAK,MAAM,IAAI,SAAS,CAAC,QAAQ,KAAK,QAAQ,CAAC;AAChF,MAAI,OAAO,GAAG,QAAQ,GAAG,KAAK,GAAG,IAAI,CAAC;AACtC,MAAI,IAAI,GAAG,SAAS,CAAC,IAAI,KAAK,QAAQ,GAAG,GAAG,GAAG,EAAE,CAAA,AAAC,CAAC;AACnD,MAAI,IAAI,GAAG,SAAS,CAAC,IAAI,CAAC;;;AAG1B,MAAI,eAAe,GAAG,EAAE,CAAC;AACzB,MAAI,iBAAiB,CAAC;AACtB,MAAI,OAAO,CAAC,KAAK,CAAC,iBAAiB,EAAE;AACnC,qBAAiB,GAAG,IAAI,iBAAiB,CAAC,OAAO,OAAO,CAAC,KAAK,CAAC,iBAAiB,KAAK,IAAI,GAAG,OAAO,CAAC,KAAK,CAAC,iBAAiB,GAAG,EAAE,EAAE,KAAK,CAAC,CAAC;AACzI,mBAAe,CAAC,iBAAiB,CAAC,aAAa,CAAC,GAAG,iBAAiB,CAAC,KAAK,EAAE,CAAC;GAC9E;;;AAGD,MAAI,CAAC,SAAS,GAAG,KAAK,CAAC;AACvB,MAAI,CAAC,GAAG,GAAG,OAAO,CAAC;AACnB,MAAI,CAAC,eAAe,GAAG,OAAO,CAAC,KAAK,CAAC,eAAe,CAAC;AACrD,MAAI,CAAC,QAAQ,CAAC,MAAM,GAAI,IAAI,CAAC,eAAe,KAAK,UAAU,AAAC,CAAC;;;AAG7D,MAAI,GAAG,GAAG,IAAI,MAAM,CAAC,OAAO,CAAC,KAAK,CAAC,eAAe,GAAG,GAAG,GAAG,IAAI,CAAC,GAAG,EAAE,CAAC,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAC;AAC1F,MAAI,MAAM,GAAG,MAAM,CAAC,UAAU,CAAC,MAAM,CAAC,CAAC;AACvC,QAAM,CAAC,MAAM,CAAC,GAAG,GAAG,sCAAsC,CAAC,CAAC;AAC5D,MAAI,iBAAiB,GAAG,MAAM,CAAC,MAAM,CAAC,QAAQ,CAAC,CAAC;;AAEhD,MAAI,KAAK,GAAG,OAAO,CAAC,KAAK,CAAC,KAAK,CAAC;;AAEhC,MAAI,UAAU,GAAG,eAAe,CAAC,QAAQ,EAAE,SAAS,CAAC,QAAQ,EAAE,IAAI,CAAC,CAAA;;AAEpE,MAAI,cAAc,GAAG;AACnB,QAAI,EAAE,IAAI;AACV,QAAI,EAAE,SAAS,CAAC,QAAQ;AACxB,WAAO,EAAE;AACP,kBAAY,EAAE,SAAS;AACvB,eAAS,EAAE,WAAW;AACtB,YAAM,EAAE,UAAU;AAClB,6BAAuB,EAAE,OAAO,CAAC,KAAK,CAAC,eAAe;AACtD,yBAAmB,EAAE,GAAG;KACzB;GACF,CAAC;;;AAGF,MAAI,IAAI,EAAE;AACR,kBAAc,CAAC,OAAO,CAAC,aAAa,GAAG,QAAQ,GAAG,IAAI,MAAM,CAAC,IAAI,CAAC,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAC;GACvF;;AAED,MAAI,OAAO,CAAC,KAAK,CAAC,QAAQ,EAAE;AAC1B,kBAAc,CAAC,OAAO,CAAC,wBAAwB,CAAC,GAAG,OAAO,CAAC,KAAK,CAAC,QAAQ,CAAC;GAC3E;;AAED,MAAI,OAAO,CAAC,KAAK,CAAC,IAAI,EAAE;AACtB,kBAAc,CAAC,OAAO,CAAC,IAAI,GAAG,OAAO,CAAC,KAAK,CAAC,IAAI,CAAC;GAClD;;AAED,MAAI,OAAO,CAAC,KAAK,CAAC,OAAO,EAAE;AACzB,SAAK,IAAI,MAAM,IAAI,OAAO,CAAC,KAAK,CAAC,OAAO,EAAE;AACvC,UAAI,OAAO,CAAC,KAAK,CAAC,OAAO,CAAC,cAAc,CAAC,MAAM,CAAC,EAAE;AACjD,sBAAc,CAAC,OAAO,CAAC,MAAM,CAAC,GAAG,OAAO,CAAC,KAAK,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC;OAC/D;KACH;GACF;;AAED,MAAI,MAAM,CAAC,IAAI,CAAC,eAAe,CAAC,CAAC,MAAM,EAAE;AACvC,kBAAc,CAAC,OAAO,CAAC,0BAA0B,CAAC,GAAG,UAAU,CAAC,MAAM,CAAC,eAAe,CAAC,CAAC;GACzF;;AAED,MAAI,OAAO,CAAC,mBAAmB,CAAC,KAAK,CAAC,IAClC,OAAO,CAAC,mBAAmB,CAAC,KAAK,CAAC,IAClC,OAAO,CAAC,mBAAmB,CAAC,YAAY,CAAC,IACzC,OAAO,CAAC,mBAAmB,CAAC,MAAM,CAAC,IACnC,OAAO,CAAC,mBAAmB,CAAC,IAAI,CAAC,IACjC,OAAO,CAAC,mBAAmB,CAAC,SAAS,CAAC,IACtC,OAAO,CAAC,mBAAmB,CAAC,oBAAoB,CAAC,EAAE;;AAErD,QAAI,OAAO,CAAC,mBAAmB,CAAC,KAAK,CAAC,EAAE,cAAc,CAAC,GAAG,GAAG,OAAO,CAAC,KAAK,CAAC,GAAG,CAAC;AAC/E,QAAI,OAAO,CAAC,mBAAmB,CAAC,KAAK,CAAC,EAAE,cAAc,CAAC,GAAG,GAAG,OAAO,CAAC,KAAK,CAAC,GAAG,CAAC;AAC/E,QAAI,OAAO,CAAC,mBAAmB,CAAC,YAAY,CAAC,EAAE,cAAc,CAAC,UAAU,GAAG,OAAO,CAAC,KAAK,CAAC,UAAU,CAAC;AACpG,QAAI,OAAO,CAAC,mBAAmB,CAAC,MAAM,CAAC,EAAE,cAAc,CAAC,IAAI,GAAG,OAAO,CAAC,KAAK,CAAC,IAAI,CAAC;AAClF,QAAI,OAAO,CAAC,mBAAmB,CAAC,IAAI,CAAC,EAAE,cAAc,CAAC,EAAE,GAAG,OAAO,CAAC,KAAK,CAAC,EAAE,CAAC;AAC5E,QAAI,OAAO,CAAC,mBAAmB,CAAC,SAAS,CAAC,EAAE,cAAc,CAAC,OAAO,GAAG,OAAO,CAAC,KAAK,CAAC,OAAO,CAAC;AAC3F,QAAI,OAAO,CAAC,mBAAmB,CAAC,oBAAoB,CAAC,EAAE,cAAc,CAAC,kBAAkB,GAAG,OAAO,CAAC,KAAK,CAAC,kBAAkB,CAAC;;AAE5H,QAAI,CAAC,KAAK,EAAE;;AAER,WAAK,GAAG,IAAI,OAAO,CAAC,KAAK,CAAC,cAAc,CAAC,CAAC;KAC7C;GACF;;AAED,gBAAc,CAAC,IAAI,GAAG,SAAS,CAAC,IAAI,IAAI,GAAG,CAAC;;AAE5C,MAAI,KAAK,EAAE;AACT,kBAAc,CAAC,KAAK,GAAG,KAAK,CAAC;GAC9B;;AAED,MAAI,YAAY,EAAE;AAChB,kBAAc,CAAC,UAAU,GAAG,SAAS,CAAC,QAAQ,CAAC;GAChD;;AAED,MAAI,OAAO,CAAC,KAAK,CAAC,YAAY,EAAE;AAC9B,kBAAc,CAAC,YAAY,GAAG,OAAO,CAAC,KAAK,CAAC,YAAY,CAAC;GAC1D;;AAED,MAAI,OAAO,CAAC,KAAK,CAAC,MAAM,EAAE;AACxB,QAAI,OAAO,CAAC,KAAK,CAAC,eAAe,GAAG,EAAE,EAAE,cAAc,CAAC,OAAO,CAAC,sBAAsB,CAAC,GAAG,OAAO,CAAC,KAAK,CAAC,MAAM,CAAC,KACzG,cAAc,CAAC,OAAO,CAAC,MAAM,GAAG,OAAO,CAAC,KAAK,CAAC,MAAM,CAAC;GAC3D;;AAED,MAAI,IAAI,GAAG,IAAI,CAAC;AAChB,MAAI,GAAG,GAAG,OAAO,CAAC,OAAO,CAAC,cAAc,CAAC,CAAC;;AAE1C,KAAG,CAAC,EAAE,CAAC,OAAO,EAAE,SAAS,OAAO,CAAC,KAAK,EAAE;AACtC,QAAI,CAAC,IAAI,CAAC,OAAO,EAAE,KAAK,CAAC,CAAC;AAC1B,6BAAyB,CAAC,IAAI,CAAC,IAAI,EAAE,KAAK,CAAC,CAAC;GAC7C,CAAC,CAAC;;AAEH,KAAG,CAAC,IAAI,CAAC,UAAU,EAAE,SAAS,QAAQ,CAAC,GAAG,EAAE;AAC1C,QAAI,KAAK,CAAC;;AAEV,QAAI,CAAC,IAAI,CAAC,IAAI,CAAC,qBAAqB,EAAE,GAAG,EAAE,GAAG,CAAC,EAAE;AAC/C,WAAK,GAAG,IAAI,KAAK,CAAC,8BAA8B,GAAG,GAAG,CAAC,UAAU,GAAG,GAAG,CAAC,CAAC;AACzE,SAAG,CAAC,KAAK,EAAE,CAAC;AACZ,UAAI,CAAC,IAAI,CAAC,OAAO,EAAE,KAAK,CAAC,CAAC;KAC3B;;AAED,6BAAyB,CAAC,IAAI,CAAC,IAAI,EAAE,KAAK,CAAC,CAAC;GAC7C,CAAC,CAAC;;AAEH,KAAG,CAAC,IAAI,CAAC,SAAS,EAAE,SAAS,OAAO,CAAC,GAAG,EAAE,MAAM,EAAE,WAAW,EAAE;AAC7D,QAAI,IAAI,CAAC,UAAU,KAAK,SAAS,CAAC,MAAM,EAAE;;AAExC,UAAI,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;AACnB,UAAI,CAAC,kBAAkB,EAAE,CAAC;AAC1B,YAAM,CAAC,GAAG,EAAE,CAAC;AACb,aAAO;KACR;;AAED,QAAI,SAAS,GAAG,GAAG,CAAC,OAAO,CAAC,sBAAsB,CAAC,CAAC;AACpD,QAAI,OAAO,SAAS,KAAK,WAAW,IAAI,SAAS,KAAK,iBAAiB,EAAE;AACvE,UAAI,CAAC,IAAI,CAAC,OAAO,EAAE,oBAAoB,CAAC,CAAC;AACzC,UAAI,CAAC,kBAAkB,EAAE,CAAC;AAC1B,YAAM,CAAC,GAAG,EAAE,CAAC;AACb,aAAO;KACR;;AAED,QAAI,UAAU,GAAG,GAAG,CAAC,OAAO,CAAC,wBAAwB,CAAC,CAAC;AACvD,QAAI,QAAQ,GAAG,CAAC,OAAO,CAAC,KAAK,CAAC,QAAQ,IAAI,EAAE,CAAA,CAAE,KAAK,CAAC,KAAK,CAAC,CAAC;AAC3D,QAAI,SAAS,GAAG,IAAI,CAAC;;AAErB,QAAI,CAAC,OAAO,CAAC,KAAK,CAAC,QAAQ,IAAI,UAAU,EAAE;AACzC,eAAS,GAAG,sDAAsD,CAAC;KACpE,MAAM,IAAI,OAAO,CAAC,KAAK,CAAC,QAAQ,IAAI,CAAC,UAAU,EAAE;AAChD,eAAS,GAAG,kDAAkD,CAAC;KAChE,MAAM,IAAI,UAAU,IAAI,QAAQ,CAAC,OAAO,CAAC,UAAU,CAAC,KAAK,CAAC,CAAC,EAAE;AAC5D,eAAS,GAAG,2CAA2C,CAAC;KACzD;;AAED,QAAI,SAAS,EAAE;AACb,UAAI,CAAC,IAAI,CAAC,OAAO,EAAE,SAAS,CAAC,CAAC;AAC9B,UAAI,CAAC,kBAAkB,EAAE,CAAC;AAC1B,YAAM,CAAC,GAAG,EAAE,CAAC;AACb,aAAO;KACR,MAAM,IAAI,UAAU,EAAE;AACrB,UAAI,CAAC,QAAQ,GAAG,UAAU,CAAC;KAC5B;;AAED,QAAI,gBAAgB,GAAG,UAAU,CAAC,KAAK,CAAC,GAAG,CAAC,OAAO,CAAC,0BAA0B,CAAC,CAAC,CAAC;AACjF,QAAI,iBAAiB,IAAI,gBAAgB,CAAC,iBAAiB,CAAC,aAAa,CAAC,EAAE;AAC1E,UAAI;AACF,yBAAiB,CAAC,MAAM,CAAC,gBAAgB,CAAC,iBAAiB,CAAC,aAAa,CAAC,CAAC,CAAC;OAC7E,CAAC,OAAO,GAAG,EAAE;AACZ,YAAI,CAAC,IAAI,CAAC,OAAO,EAAE,6BAA6B,CAAC,CAAC;AAClD,YAAI,CAAC,kBAAkB,EAAE,CAAC;AAC1B,cAAM,CAAC,GAAG,EAAE,CAAC;AACb,eAAO;OACR;AACD,UAAI,CAAC,UAAU,CAAC,iBAAiB,CAAC,aAAa,CAAC,GAAG,iBAAiB,CAAC;KACtE;;AAED,uBAAmB,CAAC,IAAI,CAAC,IAAI,EAAE,QAAQ,EAAE,MAAM,EAAE,MAAM,EAAE,WAAW,CAAC,CAAC;;;AAGtE,OAAG,CAAC,kBAAkB,EAAE,CAAC;AACzB,OAAG,GAAG,IAAI,CAAC;AACX,SAAK,GAAG,IAAI,CAAC;GACd,CAAC,CAAC;;AAEH,KAAG,CAAC,GAAG,EAAE,CAAC;AACV,MAAI,CAAC,UAAU,GAAG,SAAS,CAAC,UAAU,CAAC;CACxC;;AAED,SAAS,mBAAmB,CAAC,aAAa,EAAE,WAAW,EAAE,MAAM,EAAE,WAAW,EAAE;AAC5E,MAAI,MAAM,GAAG,IAAI,CAAC,OAAO,GAAG,IAAI,MAAM,CAAC,MAAM,CAAC;MAC1C,MAAM,GAAG,KAAK;MACd,IAAI,GAAG,IAAI,CAAC;;AAEhB,QAAM,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC;AACrB,QAAM,CAAC,UAAU,CAAC,IAAI,CAAC,CAAC;;AAExB,MAAI,CAAC,SAAS,GAAG,IAAI,aAAa,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;AACpD,MAAI,CAAC,OAAO,GAAG,MAAM,CAAC;;;AAGtB,QAAM,CAAC,EAAE,CAAC,KAAK,EAAE,yBAAyB,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC;AACvD,QAAM,CAAC,EAAE,CAAC,OAAO,EAAE,yBAAyB,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC;AACzD,QAAM,CAAC,EAAE,CAAC,OAAO,EAAE,yBAAyB,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC;;;AAGzD,WAAS,YAAY,CAAC,IAAI,EAAE;AAC1B,QAAI,MAAM,IAAI,IAAI,CAAC,UAAU,KAAK,SAAS,CAAC,MAAM,EAAE,OAAO;;AAE3D,UAAM,GAAG,IAAI,CAAC;AACd,UAAM,CAAC,cAAc,CAAC,MAAM,EAAE,YAAY,CAAC,CAAC;AAC5C,UAAM,CAAC,EAAE,CAAC,MAAM,EAAE,WAAW,CAAC,CAAC;;AAE/B,QAAI,WAAW,IAAI,WAAW,CAAC,MAAM,GAAG,CAAC,EAAE;AACzC,iBAAW,CAAC,WAAW,CAAC,CAAC;AACzB,iBAAW,GAAG,IAAI,CAAC;KACpB;;AAED,QAAI,IAAI,EAAE,WAAW,CAAC,IAAI,CAAC,CAAC;GAC7B;;;AAGD,WAAS,WAAW,CAAC,IAAI,EAAE;AACzB,QAAI,CAAC,aAAa,IAAI,IAAI,CAAC,MAAM,CAAC;AAClC,QAAI,CAAC,SAAS,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC;GAC1B;;AAED,QAAM,CAAC,EAAE,CAAC,MAAM,EAAE,YAAY,CAAC,CAAC;;;;;;;AAOhC,SAAO,CAAC,QAAQ,CAAC,YAAY,CAAC,CAAC;;;AAG/B,MAAI,CAAC,SAAS,CAAC,MAAM,GAAG,SAAS,MAAM,CAAC,IAAI,EAAE,KAAK,EAAE;AACnD,SAAK,GAAG,KAAK,IAAI,EAAE,CAAC;;AAEpB,QAAI,CAAC,IAAI,CAAC,SAAS,EAAE,IAAI,EAAE,KAAK,CAAC,CAAC;GACnC,CAAC;;AAEF,MAAI,CAAC,SAAS,CAAC,QAAQ,GAAG,SAAS,QAAQ,CAAC,IAAI,EAAE,KAAK,EAAE;AACvD,SAAK,GAAG,KAAK,IAAI,EAAE,CAAC;;AAEpB,SAAK,CAAC,MAAM,GAAG,IAAI,CAAC;AACpB,QAAI,CAAC,IAAI,CAAC,SAAS,EAAE,IAAI,EAAE,KAAK,CAAC,CAAC;GACnC,CAAC;;AAEF,MAAI,CAAC,SAAS,CAAC,MAAM,GAAG,SAAS,MAAM,CAAC,IAAI,EAAE,KAAK,EAAE;AACnD,SAAK,GAAG,KAAK,IAAI,EAAE,CAAC;;AAEpB,QAAI,CAAC,IAAI,CAAC,IAAI,EAAE;AACd,UAAI,EAAE,CAAC,IAAI,CAAC,SAAS;AACrB,YAAM,EAAE,KAAK,CAAC,MAAM,KAAK,IAAI;KAC9B,EAAE,IAAI,CAAC,CAAC;;AAET,QAAI,CAAC,IAAI,CAAC,MAAM,EAAE,IAAI,EAAE,KAAK,CAAC,CAAC;GAChC,CAAC;;AAEF,MAAI,CAAC,SAAS,CAAC,MAAM,GAAG,SAAS,MAAM,CAAC,IAAI,EAAE,KAAK,EAAE;AACnD,QAAI,CAAC,IAAI,CAAC,MAAM,EAAE,IAAI,EAAE,KAAK,IAAI,EAAE,CAAC,CAAC;GACtC,CAAC;;AAEF,MAAI,CAAC,SAAS,CAAC,OAAO,GAAG,SAAS,OAAO,CAAC,IAAI,EAAE,IAAI,EAAE,KAAK,EAAE;AAC3D,SAAK,GAAG,KAAK,IAAI,EAAE,CAAC;;AAEpB,QAAI,CAAC,cAAc,GAAG,IAAI,CAAC;AAC3B,QAAI,CAAC,KAAK,CAAC,IAAI,EAAE,IAAI,CAAC,CAAC;GACxB,CAAC;;AAEF,MAAI,CAAC,SAAS,CAAC,OAAO,GAAG,SAAS,OAAO,CAAC,MAAM,EAAE,SAAS,EAAE;;AAE3D,QAAI,CAAC,KAAK,CAAC,OAAO,SAAS,KAAK,WAAW,GAAG,SAAS,GAAG,IAAI,EAAE,EAAE,CAAC,CAAC;AACpE,QAAI,CAAC,IAAI,CAAC,OAAO,EAAE,MAAM,EAAE,SAAS,CAAC,CAAC;GACvC,CAAC;;;AAGF,MAAI,CAAC,OAAO,GAAG,IAAI,WAAW,CAAC,MAAM,EAAE,IAAI,CAAC,UAAU,CAAC,CAAC;AACxD,MAAI,CAAC,OAAO,CAAC,EAAE,CAAC,OAAO,EAAE,SAAS,OAAO,CAAC,KAAK,EAAE;AAC/C,QAAI,CAAC,KAAK,CAAC,IAAI,EAAE,EAAE,CAAC,CAAC;AACrB,QAAI,CAAC,IAAI,CAAC,OAAO,EAAE,KAAK,CAAC,CAAC;GAC3B,CAAC,CAAC;;AAEH,MAAI,CAAC,UAAU,GAAG,SAAS,CAAC,IAAI,CAAC;AACjC,MAAI,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;CACnB;;AAED,SAAS,UAAU,CAAC,QAAQ,EAAE;AAC5B,UAAQ,CAAC,MAAM,GAAG,QAAQ,CAAC,MAAM,IAAI,EAAE,CAAC;CACzC;;AAED,SAAS,iBAAiB,CAAC,QAAQ,EAAE;AACnC,MAAI,KAAK,GAAG,QAAQ,CAAC,MAAM,CAAC;AAC5B,MAAI,OAAO,KAAK,KAAK,WAAW,EAAE,OAAO;;AAEzC,SAAO,QAAQ,CAAC,MAAM,CAAC;AACvB,OAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,KAAK,CAAC,MAAM,EAAE,CAAC,GAAG,CAAC,EAAE,EAAE,CAAC,EAAE;AAC5C,SAAK,CAAC,CAAC,CAAC,EAAE,CAAC;GACZ;CACF;;AAED,SAAS,UAAU,CAAC,QAAQ,EAAE,MAAM,EAAE,OAAO,EAAE,EAAE,EAAE;AACjD,QAAM,CAAC,EAAE,CAAC,MAAM,EAAE,SAAS,QAAQ,CAAC,IAAI,EAAE;AACxC,QAAI,QAAQ,CAAC,UAAU,KAAK,SAAS,CAAC,IAAI,EAAE;AAC1C,UAAI,OAAO,EAAE,KAAK,UAAU,EAAE,EAAE,CAAC,IAAI,KAAK,CAAC,YAAY,CAAC,CAAC,CAAC,KACrD;AACH,eAAO,QAAQ,CAAC,MAAM,CAAC;AACvB,gBAAQ,CAAC,IAAI,CAAC,OAAO,EAAE,IAAI,KAAK,CAAC,YAAY,CAAC,CAAC,CAAC;OACjD;AACD,aAAO;KACR;;AAED,WAAO,CAAC,GAAG,GAAG,KAAK,CAAC;AACpB,YAAQ,CAAC,OAAO,CAAC,IAAI,CAAC,IAAI,EAAE,OAAO,CAAC,CAAC;GACtC,CAAC,CAAC;;AAEH,QAAM,CAAC,EAAE,CAAC,KAAK,EAAE,SAAS,GAAG,GAAG;AAC9B,QAAI,QAAQ,CAAC,UAAU,KAAK,SAAS,CAAC,IAAI,EAAE;AAC1C,UAAI,OAAO,EAAE,KAAK,UAAU,EAAE,EAAE,CAAC,IAAI,KAAK,CAAC,YAAY,CAAC,CAAC,CAAC,KACrD;AACH,eAAO,QAAQ,CAAC,MAAM,CAAC;AACvB,gBAAQ,CAAC,IAAI,CAAC,OAAO,EAAE,IAAI,KAAK,CAAC,YAAY,CAAC,CAAC,CAAC;OACjD;AACD,aAAO;KACR;;AAED,WAAO,CAAC,GAAG,GAAG,IAAI,CAAC;AACnB,YAAQ,CAAC,OAAO,CAAC,IAAI,CAAC,IAAI,EAAE,OAAO,CAAC,CAAC;;AAErC,QAAI,OAAO,EAAE,KAAK,UAAU,EAAE,EAAE,CAAC,IAAI,CAAC,CAAC;GACxC,CAAC,CAAC;CACJ;;AAED,SAAS,yBAAyB,CAAC,KAAK,EAAE;AACxC,MAAI,IAAI,CAAC,UAAU,KAAK,SAAS,CAAC,MAAM,EAAE,OAAO;;AAEjD,MAAI,SAAS,GAAG,IAAI,CAAC,UAAU,KAAK,SAAS,CAAC,UAAU,CAAC;AACzD,MAAI,CAAC,UAAU,GAAG,SAAS,CAAC,MAAM,CAAC;;AAEnC,cAAY,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC;AAC/B,MAAI,CAAC,WAAW,GAAG,IAAI,CAAC;;AAExB,MAAI,SAAS,EAAE;;;AAGb,QAAI,KAAK,EAAE;AACT,UAAI,CAAC,UAAU,GAAG,IAAI,CAAC;KACxB;AACD,QAAI,CAAC,IAAI,CAAC,OAAO,EAAE,IAAI,CAAC,UAAU,IAAI,IAAI,EAAE,IAAI,CAAC,aAAa,IAAI,EAAE,CAAC,CAAC;GACvE;;AAED,MAAI,IAAI,CAAC,OAAO,EAAE;AAChB,QAAI,IAAI,CAAC,OAAO,EAAE,IAAI,CAAC,OAAO,CAAC,OAAO,EAAE,CAAC;AACzC,QAAI,CAAC,OAAO,CAAC,EAAE,CAAC,OAAO,EAAE,SAAS,OAAO,GAAG;AAC1C,UAAI;AAAE,YAAI,CAAC,OAAO,EAAE,CAAC;OAAE,CACvB,OAAO,CAAC,EAAE,EAAE;KACb,CAAC,CAAC;;AAEH,QAAI;AACF,UAAI,CAAC,KAAK,EAAE,IAAI,CAAC,OAAO,CAAC,GAAG,EAAE,CAAC,KAC1B,IAAI,CAAC,OAAO,CAAC,OAAO,EAAE,CAAC;KAC7B,CAAC,OAAO,CAAC,EAAE,iCAAmC;;AAE/C,QAAI,CAAC,OAAO,GAAG,IAAI,CAAC;AACpB,QAAI,CAAC,OAAO,GAAG,IAAI,CAAC;GACrB;;AAED,MAAI,IAAI,CAAC,OAAO,EAAE;AAChB,QAAI,CAAC,OAAO,CAAC,kBAAkB,EAAE,CAAC;AAClC,QAAI,CAAC,OAAO,GAAG,IAAI,CAAC;GACrB;;AAED,MAAI,IAAI,CAAC,SAAS,EAAE;AAClB,QAAI,CAAC,SAAS,CAAC,OAAO,EAAE,CAAC;AACzB,QAAI,CAAC,SAAS,GAAG,IAAI,CAAC;GACvB;;AAED,MAAI,CAAC,kBAAkB,EAAE,CAAC;AAC1B,MAAI,CAAC,EAAE,CAAC,OAAO,EAAE,SAAS,OAAO,GAAG,EAAE,CAAC,CAAC;AACxC,SAAO,IAAI,CAAC,MAAM,CAAC;CACpB","file":"WebSocket-compiled.js","sourcesContent":["'use strict';\n\n/*!\n * ws: a node.js websocket client\n * Copyright(c) 2011 Einar Otto Stangvik <einaros@gmail.com>\n * MIT Licensed\n */\n\nvar url = require('url')\n  , util = require('util')\n  , http = require('http')\n  , https = require('https')\n  , crypto = require('crypto')\n  , stream = require('stream')\n  , Ultron = require('ultron')\n  , Options = require('options')\n  , Sender = require('./Sender')\n  , Receiver = require('./Receiver')\n  , SenderHixie = require('./Sender.hixie')\n  , ReceiverHixie = require('./Receiver.hixie')\n  , Extensions = require('./Extensions')\n  , PerMessageDeflate = require('./PerMessageDeflate')\n  , EventEmitter = require('events').EventEmitter;\n\n/**\n * Constants\n */\n\n// Default protocol version\n\nvar protocolVersion = 13;\n\n// Close timeout\n\nvar closeTimeout = 30 * 1000; // Allow 30 seconds to terminate the connection cleanly\n\n/**\n * WebSocket implementation\n *\n * @constructor\n * @param {String} address Connection address.\n * @param {String|Array} protocols WebSocket protocols.\n * @param {Object} options Additional connection options.\n * @api public\n */\nfunction WebSocket(address, protocols, options) {\n  if (this instanceof WebSocket === false) {\n    throw new TypeError(\"Classes can't be function-called\");\n  }\n\n  EventEmitter.call(this);\n\n  if (protocols && !Array.isArray(protocols) && 'object' === typeof protocols) {\n    // accept the \"options\" Object as the 2nd argument\n    options = protocols;\n    protocols = null;\n  }\n\n  if ('string' === typeof protocols) {\n    protocols = [ protocols ];\n  }\n\n  if (!Array.isArray(protocols)) {\n    protocols = [];\n  }\n\n  this._socket = null;\n  this._ultron = null;\n  this._closeReceived = false;\n  this.bytesReceived = 0;\n  this.readyState = null;\n  this.supports = {};\n  this.extensions = {};\n\n  if (Array.isArray(address)) {\n    initAsServerClient.apply(this, address.concat(options));\n  } else {\n    initAsClient.apply(this, [address, protocols, options]);\n  }\n}\n\n/**\n * Inherits from EventEmitter.\n */\nutil.inherits(WebSocket, EventEmitter);\n\n/**\n * Ready States\n */\n[\"CONNECTING\", \"OPEN\", \"CLOSING\", \"CLOSED\"].forEach(function each(state, index) {\n    WebSocket.prototype[state] = WebSocket[state] = index;\n});\n\n/**\n * Gracefully closes the connection, after sending a description message to the server\n *\n * @param {Object} data to be sent to the server\n * @api public\n */\nWebSocket.prototype.close = function close(code, data) {\n  if (this.readyState === WebSocket.CLOSED) return;\n\n  if (this.readyState === WebSocket.CONNECTING) {\n    this.readyState = WebSocket.CLOSED;\n    return;\n  }\n\n  if (this.readyState === WebSocket.CLOSING) {\n    if (this._closeReceived && this._isServer) {\n      this.terminate();\n    }\n    return;\n  }\n\n  var self = this;\n  try {\n    this.readyState = WebSocket.CLOSING;\n    this._closeCode = code;\n    this._closeMessage = data;\n    var mask = !this._isServer;\n    this._sender.close(code, data, mask, function(err) {\n      if (err) self.emit('error', err);\n\n      if (self._closeReceived && self._isServer) {\n        self.terminate();\n      } else {\n        // ensure that the connection is cleaned up even when no response of closing handshake.\n        clearTimeout(self._closeTimer);\n        self._closeTimer = setTimeout(cleanupWebsocketResources.bind(self, true), closeTimeout);\n      }\n    });\n  } catch (e) {\n    this.emit('error', e);\n  }\n};\n\n/**\n * Pause the client stream\n *\n * @api public\n */\nWebSocket.prototype.pause = function pauser() {\n  if (this.readyState !== WebSocket.OPEN) throw new Error('not opened');\n\n  return this._socket.pause();\n};\n\n/**\n * Sends a ping\n *\n * @param {Object} data to be sent to the server\n * @param {Object} Members - mask: boolean, binary: boolean\n * @param {boolean} dontFailWhenClosed indicates whether or not to throw if the connection isnt open\n * @api public\n */\nWebSocket.prototype.ping = function ping(data, options, dontFailWhenClosed) {\n  if (this.readyState !== WebSocket.OPEN) {\n    if (dontFailWhenClosed === true) return;\n    throw new Error('not opened');\n  }\n\n  options = options || {};\n\n  if (typeof options.mask === 'undefined') options.mask = !this._isServer;\n\n  this._sender.ping(data, options);\n};\n\n/**\n * Sends a pong\n *\n * @param {Object} data to be sent to the server\n * @param {Object} Members - mask: boolean, binary: boolean\n * @param {boolean} dontFailWhenClosed indicates whether or not to throw if the connection isnt open\n * @api public\n */\nWebSocket.prototype.pong = function(data, options, dontFailWhenClosed) {\n  if (this.readyState !== WebSocket.OPEN) {\n    if (dontFailWhenClosed === true) return;\n    throw new Error('not opened');\n  }\n\n  options = options || {};\n\n  if (typeof options.mask === 'undefined') options.mask = !this._isServer;\n\n  this._sender.pong(data, options);\n};\n\n/**\n * Resume the client stream\n *\n * @api public\n */\nWebSocket.prototype.resume = function resume() {\n  if (this.readyState !== WebSocket.OPEN) throw new Error('not opened');\n\n  return this._socket.resume();\n};\n\n/**\n * Sends a piece of data\n *\n * @param {Object} data to be sent to the server\n * @param {Object} Members - mask: boolean, binary: boolean, compress: boolean\n * @param {function} Optional callback which is executed after the send completes\n * @api public\n */\n\nWebSocket.prototype.send = function send(data, options, cb) {\n  if (typeof options === 'function') {\n    cb = options;\n    options = {};\n  }\n\n  if (this.readyState !== WebSocket.OPEN) {\n    if (typeof cb === 'function') cb(new Error('not opened'));\n    else throw new Error('not opened');\n    return;\n  }\n\n  if (!data) data = '';\n  if (this._queue) {\n    var self = this;\n    this._queue.push(function() { self.send(data, options, cb); });\n    return;\n  }\n\n  options = options || {};\n  options.fin = true;\n\n  if (typeof options.binary === 'undefined') {\n    options.binary = (data instanceof ArrayBuffer || data instanceof Buffer ||\n      data instanceof Uint8Array ||\n      data instanceof Uint16Array ||\n      data instanceof Uint32Array ||\n      data instanceof Int8Array ||\n      data instanceof Int16Array ||\n      data instanceof Int32Array ||\n      data instanceof Float32Array ||\n      data instanceof Float64Array);\n  }\n\n  if (typeof options.mask === 'undefined') options.mask = !this._isServer;\n  if (typeof options.compress === 'undefined') options.compress = true;\n  if (!this.extensions[PerMessageDeflate.extensionName]) {\n    options.compress = false;\n  }\n\n  var readable = typeof stream.Readable === 'function'\n    ? stream.Readable\n    : stream.Stream;\n\n  if (data instanceof readable) {\n    startQueue(this);\n    var self = this;\n\n    sendStream(this, data, options, function send(error) {\n      process.nextTick(function tock() {\n        executeQueueSends(self);\n      });\n\n      if (typeof cb === 'function') cb(error);\n    });\n  } else {\n    this._sender.send(data, options, cb);\n  }\n};\n\n/**\n * Streams data through calls to a user supplied function\n *\n * @param {Object} Members - mask: boolean, binary: boolean, compress: boolean\n * @param {function} 'function (error, send)' which is executed on successive ticks of which send is 'function (data, final)'.\n * @api public\n */\nWebSocket.prototype.stream = function stream(options, cb) {\n  if (typeof options === 'function') {\n    cb = options;\n    options = {};\n  }\n\n  var self = this;\n\n  if (typeof cb !== 'function') throw new Error('callback must be provided');\n\n  if (this.readyState !== WebSocket.OPEN) {\n    if (typeof cb === 'function') cb(new Error('not opened'));\n    else throw new Error('not opened');\n    return;\n  }\n\n  if (this._queue) {\n    this._queue.push(function () { self.stream(options, cb); });\n    return;\n  }\n\n  options = options || {};\n\n  if (typeof options.mask === 'undefined') options.mask = !this._isServer;\n  if (typeof options.compress === 'undefined') options.compress = true;\n  if (!this.extensions[PerMessageDeflate.extensionName]) {\n    options.compress = false;\n  }\n\n  startQueue(this);\n\n  function send(data, final) {\n    try {\n      if (self.readyState !== WebSocket.OPEN) throw new Error('not opened');\n      options.fin = final === true;\n      self._sender.send(data, options);\n      if (!final) process.nextTick(cb.bind(null, null, send));\n      else executeQueueSends(self);\n    } catch (e) {\n      if (typeof cb === 'function') cb(e);\n      else {\n        delete self._queue;\n        self.emit('error', e);\n      }\n    }\n  }\n\n  process.nextTick(cb.bind(null, null, send));\n};\n\n/**\n * Immediately shuts down the connection\n *\n * @api public\n */\nWebSocket.prototype.terminate = function terminate() {\n  if (this.readyState === WebSocket.CLOSED) return;\n\n  if (this._socket) {\n    this.readyState = WebSocket.CLOSING;\n\n    // End the connection\n    try { this._socket.end(); }\n    catch (e) {\n      // Socket error during end() call, so just destroy it right now\n      cleanupWebsocketResources.call(this, true);\n      return;\n    }\n\n    // Add a timeout to ensure that the connection is completely\n    // cleaned up within 30 seconds, even if the clean close procedure\n    // fails for whatever reason\n    // First cleanup any pre-existing timeout from an earlier \"terminate\" call,\n    // if one exists.  Otherwise terminate calls in quick succession will leak timeouts\n    // and hold the program open for `closeTimout` time.\n    if (this._closeTimer) { clearTimeout(this._closeTimer); }\n    this._closeTimer = setTimeout(cleanupWebsocketResources.bind(this, true), closeTimeout);\n  } else if (this.readyState === WebSocket.CONNECTING) {\n    cleanupWebsocketResources.call(this, true);\n  }\n};\n\n/**\n * Expose bufferedAmount\n *\n * @api public\n */\nObject.defineProperty(WebSocket.prototype, 'bufferedAmount', {\n  get: function get() {\n    var amount = 0;\n    if (this._socket) {\n      amount = this._socket.bufferSize || 0;\n    }\n    return amount;\n  }\n});\n\n/**\n * Emulates the W3C Browser based WebSocket interface using function members.\n *\n * @see http://dev.w3.org/html5/websockets/#the-websocket-interface\n * @api public\n */\n['open', 'error', 'close', 'message'].forEach(function(method) {\n  Object.defineProperty(WebSocket.prototype, 'on' + method, {\n    /**\n     * Returns the current listener\n     *\n     * @returns {Mixed} the set function or undefined\n     * @api public\n     */\n    get: function get() {\n      var listener = this.listeners(method)[0];\n      return listener ? (listener._listener ? listener._listener : listener) : undefined;\n    },\n\n    /**\n     * Start listening for events\n     *\n     * @param {Function} listener the listener\n     * @returns {Mixed} the set function or undefined\n     * @api public\n     */\n    set: function set(listener) {\n      this.removeAllListeners(method);\n      this.addEventListener(method, listener);\n    }\n  });\n});\n\n/**\n * Emulates the W3C Browser based WebSocket interface using addEventListener.\n *\n * @see https://developer.mozilla.org/en/DOM/element.addEventListener\n * @see http://dev.w3.org/html5/websockets/#the-websocket-interface\n * @api public\n */\nWebSocket.prototype.addEventListener = function(method, listener) {\n  var target = this;\n\n  function onMessage (data, flags) {\n    listener.call(target, new MessageEvent(data, !!flags.binary, target));\n  }\n\n  function onClose (code, message) {\n    listener.call(target, new CloseEvent(code, message, target));\n  }\n\n  function onError (event) {\n    event.type = 'error';\n    event.target = target;\n    listener.call(target, event);\n  }\n\n  function onOpen () {\n    listener.call(target, new OpenEvent(target));\n  }\n\n  if (typeof listener === 'function') {\n    if (method === 'message') {\n      // store a reference so we can return the original function from the\n      // addEventListener hook\n      onMessage._listener = listener;\n      this.on(method, onMessage);\n    } else if (method === 'close') {\n      // store a reference so we can return the original function from the\n      // addEventListener hook\n      onClose._listener = listener;\n      this.on(method, onClose);\n    } else if (method === 'error') {\n      // store a reference so we can return the original function from the\n      // addEventListener hook\n      onError._listener = listener;\n      this.on(method, onError);\n    } else if (method === 'open') {\n      // store a reference so we can return the original function from the\n      // addEventListener hook\n      onOpen._listener = listener;\n      this.on(method, onOpen);\n    } else {\n      this.on(method, listener);\n    }\n  }\n};\n\nmodule.exports = WebSocket;\nmodule.exports.buildHostHeader = buildHostHeader\n\n/**\n * W3C MessageEvent\n *\n * @see http://www.w3.org/TR/html5/comms.html\n * @constructor\n * @api private\n */\nfunction MessageEvent(dataArg, isBinary, target) {\n  this.type = 'message';\n  this.data = dataArg;\n  this.target = target;\n  this.binary = isBinary; // non-standard.\n}\n\n/**\n * W3C CloseEvent\n *\n * @see http://www.w3.org/TR/html5/comms.html\n * @constructor\n * @api private\n */\nfunction CloseEvent(code, reason, target) {\n  this.type = 'close';\n  this.wasClean = (typeof code === 'undefined' || code === 1000);\n  this.code = code;\n  this.reason = reason;\n  this.target = target;\n}\n\n/**\n * W3C OpenEvent\n *\n * @see http://www.w3.org/TR/html5/comms.html\n * @constructor\n * @api private\n */\nfunction OpenEvent(target) {\n  this.type = 'open';\n  this.target = target;\n}\n\n// Append port number to Host header, only if specified in the url\n// and non-default\nfunction buildHostHeader(isSecure, hostname, port) {\n  var headerHost = hostname;\n  if (hostname) {\n    if ((isSecure && (port != 443)) || (!isSecure && (port != 80))){\n      headerHost = headerHost + ':' + port;\n    }\n  }\n  return headerHost;\n}\n\n/**\n * Entirely private apis,\n * which may or may not be bound to a sepcific WebSocket instance.\n */\nfunction initAsServerClient(req, socket, upgradeHead, options) {\n  options = new Options({\n    protocolVersion: protocolVersion,\n    protocol: null,\n    extensions: {}\n  }).merge(options);\n\n  // expose state properties\n  this.protocol = options.value.protocol;\n  this.protocolVersion = options.value.protocolVersion;\n  this.extensions = options.value.extensions;\n  this.supports.binary = (this.protocolVersion !== 'hixie-76');\n  this.upgradeReq = req;\n  this.readyState = WebSocket.CONNECTING;\n  this._isServer = true;\n\n  // establish connection\n  if (options.value.protocolVersion === 'hixie-76') {\n    establishConnection.call(this, ReceiverHixie, SenderHixie, socket, upgradeHead);\n  } else {\n    establishConnection.call(this, Receiver, Sender, socket, upgradeHead);\n  }\n}\n\nfunction initAsClient(address, protocols, options) {\n  options = new Options({\n    origin: null,\n    protocolVersion: protocolVersion,\n    host: null,\n    headers: null,\n    protocol: protocols.join(','),\n    agent: null,\n\n    // ssl-related options\n    pfx: null,\n    key: null,\n    passphrase: null,\n    cert: null,\n    ca: null,\n    ciphers: null,\n    rejectUnauthorized: null,\n    perMessageDeflate: true,\n    localAddress: null\n  }).merge(options);\n\n  if (options.value.protocolVersion !== 8 && options.value.protocolVersion !== 13) {\n    throw new Error('unsupported protocol version');\n  }\n\n  // verify URL and establish http class\n  var serverUrl = url.parse(address);\n  var isUnixSocket = serverUrl.protocol === 'ws+unix:';\n  if (!serverUrl.host && !isUnixSocket) throw new Error('invalid url');\n  var isSecure = serverUrl.protocol === 'wss:' || serverUrl.protocol === 'https:';\n  var httpObj = isSecure ? https : http;\n  var port = serverUrl.port || (isSecure ? 443 : 80);\n  var auth = serverUrl.auth;\n\n  // prepare extensions\n  var extensionsOffer = {};\n  var perMessageDeflate;\n  if (options.value.perMessageDeflate) {\n    perMessageDeflate = new PerMessageDeflate(typeof options.value.perMessageDeflate !== true ? options.value.perMessageDeflate : {}, false);\n    extensionsOffer[PerMessageDeflate.extensionName] = perMessageDeflate.offer();\n  }\n\n  // expose state properties\n  this._isServer = false;\n  this.url = address;\n  this.protocolVersion = options.value.protocolVersion;\n  this.supports.binary = (this.protocolVersion !== 'hixie-76');\n\n  // begin handshake\n  var key = new Buffer(options.value.protocolVersion + '-' + Date.now()).toString('base64');\n  var shasum = crypto.createHash('sha1');\n  shasum.update(key + '258EAFA5-E914-47DA-95CA-C5AB0DC85B11');\n  var expectedServerKey = shasum.digest('base64');\n\n  var agent = options.value.agent;\n\n  var headerHost = buildHostHeader(isSecure, serverUrl.hostname, port)\n\n  var requestOptions = {\n    port: port,\n    host: serverUrl.hostname,\n    headers: {\n      'Connection': 'Upgrade',\n      'Upgrade': 'websocket',\n      'Host': headerHost,\n      'Sec-WebSocket-Version': options.value.protocolVersion,\n      'Sec-WebSocket-Key': key\n    }\n  };\n\n  // If we have basic auth.\n  if (auth) {\n    requestOptions.headers.Authorization = 'Basic ' + new Buffer(auth).toString('base64');\n  }\n\n  if (options.value.protocol) {\n    requestOptions.headers['Sec-WebSocket-Protocol'] = options.value.protocol;\n  }\n\n  if (options.value.host) {\n    requestOptions.headers.Host = options.value.host;\n  }\n\n  if (options.value.headers) {\n    for (var header in options.value.headers) {\n       if (options.value.headers.hasOwnProperty(header)) {\n        requestOptions.headers[header] = options.value.headers[header];\n       }\n    }\n  }\n\n  if (Object.keys(extensionsOffer).length) {\n    requestOptions.headers['Sec-WebSocket-Extensions'] = Extensions.format(extensionsOffer);\n  }\n\n  if (options.isDefinedAndNonNull('pfx')\n   || options.isDefinedAndNonNull('key')\n   || options.isDefinedAndNonNull('passphrase')\n   || options.isDefinedAndNonNull('cert')\n   || options.isDefinedAndNonNull('ca')\n   || options.isDefinedAndNonNull('ciphers')\n   || options.isDefinedAndNonNull('rejectUnauthorized')) {\n\n    if (options.isDefinedAndNonNull('pfx')) requestOptions.pfx = options.value.pfx;\n    if (options.isDefinedAndNonNull('key')) requestOptions.key = options.value.key;\n    if (options.isDefinedAndNonNull('passphrase')) requestOptions.passphrase = options.value.passphrase;\n    if (options.isDefinedAndNonNull('cert')) requestOptions.cert = options.value.cert;\n    if (options.isDefinedAndNonNull('ca')) requestOptions.ca = options.value.ca;\n    if (options.isDefinedAndNonNull('ciphers')) requestOptions.ciphers = options.value.ciphers;\n    if (options.isDefinedAndNonNull('rejectUnauthorized')) requestOptions.rejectUnauthorized = options.value.rejectUnauthorized;\n\n    if (!agent) {\n        // global agent ignores client side certificates\n        agent = new httpObj.Agent(requestOptions);\n    }\n  }\n\n  requestOptions.path = serverUrl.path || '/';\n\n  if (agent) {\n    requestOptions.agent = agent;\n  }\n\n  if (isUnixSocket) {\n    requestOptions.socketPath = serverUrl.pathname;\n  }\n\n  if (options.value.localAddress) {\n    requestOptions.localAddress = options.value.localAddress;\n  }\n\n  if (options.value.origin) {\n    if (options.value.protocolVersion < 13) requestOptions.headers['Sec-WebSocket-Origin'] = options.value.origin;\n    else requestOptions.headers.Origin = options.value.origin;\n  }\n\n  var self = this;\n  var req = httpObj.request(requestOptions);\n\n  req.on('error', function onerror(error) {\n    self.emit('error', error);\n    cleanupWebsocketResources.call(self, error);\n  });\n\n  req.once('response', function response(res) {\n    var error;\n\n    if (!self.emit('unexpected-response', req, res)) {\n      error = new Error('unexpected server response (' + res.statusCode + ')');\n      req.abort();\n      self.emit('error', error);\n    }\n\n    cleanupWebsocketResources.call(self, error);\n  });\n\n  req.once('upgrade', function upgrade(res, socket, upgradeHead) {\n    if (self.readyState === WebSocket.CLOSED) {\n      // client closed before server accepted connection\n      self.emit('close');\n      self.removeAllListeners();\n      socket.end();\n      return;\n    }\n\n    var serverKey = res.headers['sec-websocket-accept'];\n    if (typeof serverKey === 'undefined' || serverKey !== expectedServerKey) {\n      self.emit('error', 'invalid server key');\n      self.removeAllListeners();\n      socket.end();\n      return;\n    }\n\n    var serverProt = res.headers['sec-websocket-protocol'];\n    var protList = (options.value.protocol || \"\").split(/, */);\n    var protError = null;\n\n    if (!options.value.protocol && serverProt) {\n      protError = 'server sent a subprotocol even though none requested';\n    } else if (options.value.protocol && !serverProt) {\n      protError = 'server sent no subprotocol even though requested';\n    } else if (serverProt && protList.indexOf(serverProt) === -1) {\n      protError = 'server responded with an invalid protocol';\n    }\n\n    if (protError) {\n      self.emit('error', protError);\n      self.removeAllListeners();\n      socket.end();\n      return;\n    } else if (serverProt) {\n      self.protocol = serverProt;\n    }\n\n    var serverExtensions = Extensions.parse(res.headers['sec-websocket-extensions']);\n    if (perMessageDeflate && serverExtensions[PerMessageDeflate.extensionName]) {\n      try {\n        perMessageDeflate.accept(serverExtensions[PerMessageDeflate.extensionName]);\n      } catch (err) {\n        self.emit('error', 'invalid extension parameter');\n        self.removeAllListeners();\n        socket.end();\n        return;\n      }\n      self.extensions[PerMessageDeflate.extensionName] = perMessageDeflate;\n    }\n\n    establishConnection.call(self, Receiver, Sender, socket, upgradeHead);\n\n    // perform cleanup on http resources\n    req.removeAllListeners();\n    req = null;\n    agent = null;\n  });\n\n  req.end();\n  this.readyState = WebSocket.CONNECTING;\n}\n\nfunction establishConnection(ReceiverClass, SenderClass, socket, upgradeHead) {\n  var ultron = this._ultron = new Ultron(socket)\n    , called = false\n    , self = this;\n\n  socket.setTimeout(0);\n  socket.setNoDelay(true);\n\n  this._receiver = new ReceiverClass(this.extensions);\n  this._socket = socket;\n\n  // socket cleanup handlers\n  ultron.on('end', cleanupWebsocketResources.bind(this));\n  ultron.on('close', cleanupWebsocketResources.bind(this));\n  ultron.on('error', cleanupWebsocketResources.bind(this));\n\n  // ensure that the upgradeHead is added to the receiver\n  function firstHandler(data) {\n    if (called || self.readyState === WebSocket.CLOSED) return;\n\n    called = true;\n    socket.removeListener('data', firstHandler);\n    ultron.on('data', realHandler);\n\n    if (upgradeHead && upgradeHead.length > 0) {\n      realHandler(upgradeHead);\n      upgradeHead = null;\n    }\n\n    if (data) realHandler(data);\n  }\n\n  // subsequent packets are pushed straight to the receiver\n  function realHandler(data) {\n    self.bytesReceived += data.length;\n    self._receiver.add(data);\n  }\n\n  ultron.on('data', firstHandler);\n\n  // if data was passed along with the http upgrade,\n  // this will schedule a push of that on to the receiver.\n  // this has to be done on next tick, since the caller\n  // hasn't had a chance to set event handlers on this client\n  // object yet.\n  process.nextTick(firstHandler);\n\n  // receiver event handlers\n  self._receiver.ontext = function ontext(data, flags) {\n    flags = flags || {};\n\n    self.emit('message', data, flags);\n  };\n\n  self._receiver.onbinary = function onbinary(data, flags) {\n    flags = flags || {};\n\n    flags.binary = true;\n    self.emit('message', data, flags);\n  };\n\n  self._receiver.onping = function onping(data, flags) {\n    flags = flags || {};\n\n    self.pong(data, {\n      mask: !self._isServer,\n      binary: flags.binary === true\n    }, true);\n\n    self.emit('ping', data, flags);\n  };\n\n  self._receiver.onpong = function onpong(data, flags) {\n    self.emit('pong', data, flags || {});\n  };\n\n  self._receiver.onclose = function onclose(code, data, flags) {\n    flags = flags || {};\n\n    self._closeReceived = true;\n    self.close(code, data);\n  };\n\n  self._receiver.onerror = function onerror(reason, errorCode) {\n    // close the connection when the receiver reports a HyBi error code\n    self.close(typeof errorCode !== 'undefined' ? errorCode : 1002, '');\n    self.emit('error', reason, errorCode);\n  };\n\n  // finalize the client\n  this._sender = new SenderClass(socket, this.extensions);\n  this._sender.on('error', function onerror(error) {\n    self.close(1002, '');\n    self.emit('error', error);\n  });\n\n  this.readyState = WebSocket.OPEN;\n  this.emit('open');\n}\n\nfunction startQueue(instance) {\n  instance._queue = instance._queue || [];\n}\n\nfunction executeQueueSends(instance) {\n  var queue = instance._queue;\n  if (typeof queue === 'undefined') return;\n\n  delete instance._queue;\n  for (var i = 0, l = queue.length; i < l; ++i) {\n    queue[i]();\n  }\n}\n\nfunction sendStream(instance, stream, options, cb) {\n  stream.on('data', function incoming(data) {\n    if (instance.readyState !== WebSocket.OPEN) {\n      if (typeof cb === 'function') cb(new Error('not opened'));\n      else {\n        delete instance._queue;\n        instance.emit('error', new Error('not opened'));\n      }\n      return;\n    }\n\n    options.fin = false;\n    instance._sender.send(data, options);\n  });\n\n  stream.on('end', function end() {\n    if (instance.readyState !== WebSocket.OPEN) {\n      if (typeof cb === 'function') cb(new Error('not opened'));\n      else {\n        delete instance._queue;\n        instance.emit('error', new Error('not opened'));\n      }\n      return;\n    }\n\n    options.fin = true;\n    instance._sender.send(null, options);\n\n    if (typeof cb === 'function') cb(null);\n  });\n}\n\nfunction cleanupWebsocketResources(error) {\n  if (this.readyState === WebSocket.CLOSED) return;\n\n  var emitClose = this.readyState !== WebSocket.CONNECTING;\n  this.readyState = WebSocket.CLOSED;\n\n  clearTimeout(this._closeTimer);\n  this._closeTimer = null;\n\n  if (emitClose) {\n    // If the connection was closed abnormally (with an error), \n    // then the close code must default to 1006.\n    if (error) {\n      this._closeCode = 1006;\n    }\n    this.emit('close', this._closeCode || 1000, this._closeMessage || '');\n  }\n\n  if (this._socket) {\n    if (this._ultron) this._ultron.destroy();\n    this._socket.on('error', function onerror() {\n      try { this.destroy(); }\n      catch (e) {}\n    });\n\n    try {\n      if (!error) this._socket.end();\n      else this._socket.destroy();\n    } catch (e) { /* Ignore termination errors */ }\n\n    this._socket = null;\n    this._ultron = null;\n  }\n\n  if (this._sender) {\n    this._sender.removeAllListeners();\n    this._sender = null;\n  }\n\n  if (this._receiver) {\n    this._receiver.cleanup();\n    this._receiver = null;\n  }\n\n  this.removeAllListeners();\n  this.on('error', function onerror() {}); // catch all errors after this\n  delete this._queue;\n}\n"]}